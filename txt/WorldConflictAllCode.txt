
===== ./dashboard.js =====

// dashboard.js — client lobby logic (refactoré)
// - Préfère window.WC.apiFetch si disponible
// - Normalise toutes les réponses { ok, status, data, error }
// - Documente / nettoie les fallbacks temporaires (TODO)
(() => {
  const menuLeft = document.getElementById('menuBtnLeft');
  const menuRight = document.getElementById('menuBtnRight');
  const leftPanel = document.getElementById('leftPanel');
  const rightPanel = document.getElementById('rightPanel');
  const closeButtons = document.querySelectorAll('.close-panel');
  const welcomeEl = document.getElementById('welcome');
  const subtitleEl = document.getElementById('subtitle');
  const qiRole = document.getElementById('qiRole');
  const qiCountry = document.getElementById('qiCountry');
  const qiMembers = document.getElementById('qiMembers');
  const actionsList = document.getElementById('actionsList');
  const feedList = document.getElementById('feedList');
  const leftPanelFoot = document.getElementById('leftPanelFoot');
  const logoutBtn = document.getElementById('logoutBtn');

  // --- Helpers: API wrapper & response normalization (shared pattern) ---
  async function localFetchWrapper(url, opts = {}) {
    opts = Object.assign({}, opts);
    opts.credentials = opts.credentials || 'same-origin';
    opts.headers = opts.headers || {};
    if (!opts.headers['Content-Type'] && !(opts.body instanceof FormData)) {
      opts.headers['Content-Type'] = 'application/json';
    }
    try {
      // stringify plain object body when appropriate
      if (opts.body && typeof opts.body === 'object' && !(opts.body instanceof FormData)) {
        const ct = (opts.headers['Content-Type'] || opts.headers['content-type'] || '').toLowerCase();
        if (ct.includes('application/json')) opts.body = JSON.stringify(opts.body);
      }

      const r = await fetch(url, opts);
      const ct = (r.headers.get && r.headers.get('content-type')) || '';
      const data = ct.includes('application/json') ? await r.json() : await r.text();

      if (!r.ok) {
        return { ok: false, status: r.status, data, error: (data && data.error) || `HTTP ${r.status}` };
      }

      // try to normalize common shapes: { ok, data, error } or raw data
      if (data && typeof data === 'object') {
        if ('ok' in data && ('data' in data || 'error' in data)) {
          return { ok: !!data.ok, status: r.status, data: data.data === undefined ? null : data.data, error: data.error || null };
        }
      }

      return { ok: true, status: r.status, data, error: null };
    } catch (err) {
      return { ok: false, status: 0, data: null, error: err && err.message ? err.message : 'Network error' };
    }
  }

  async function apiFetch(url, opts = {}) {
    if (window.WC && typeof window.WC.apiFetch === 'function') {
      try {
        // WC.apiFetch is expected to return a normalized object; if not, adapt
        const r = await window.WC.apiFetch(url, opts);
        if (r && typeof r === 'object' && ('ok' in r)) return r;
        // if WC.apiFetch returned raw response object (legacy), try to normalize
        if (r && typeof r === 'object') return { ok: true, status: r.status || 200, data: r.data || r, error: null };
        return { ok: false, status: 0, data: null, error: 'Invalid response from WC.apiFetch' };
      } catch (e) {
        return { ok: false, status: 0, data: null, error: e && e.message ? e.message : 'WC.apiFetch error' };
      }
    }
    return await localFetchWrapper(url, opts);
  }

  function normalizeSessionResponse(resp) {
    // Accept: resp (normalized) or resp.data wrapper or direct session object
    if (!resp) return null;
    if (typeof resp === 'object' && ('ok' in resp)) {
      if (!resp.ok) return null;
      // condition: resp.data might itself be wrapper { ok, data }
      const payload = resp.data && resp.data.ok && resp.data.data ? resp.data.data : resp.data;
      return payload || null;
    }
    // legacy: resp is session object
    return resp;
  }

  // Helper for user messages (use WC.showMessage or fallback toast/console)
  function showMessage(el, msg, type = 'info', duration = 3000) {
    if (window.WC && typeof window.WC.showMessage === 'function') {
      try { window.WC.showMessage(el, msg, type); return; } catch (e) { /* ignore */ }
    }
    // fallbacks: if a toast element exists use it
    const toastEl = document.getElementById('toast');
    if (toastEl) {
      toastEl.textContent = msg;
      toastEl.classList.remove('visually-hidden');
      setTimeout(() => toastEl.classList.add('visually-hidden'), duration);
      return;
    }
    // last resort
    if (type === 'error') console.error('[WC]', msg);
    else console.warn('[WC]', msg);
  }

  // --- UI utilities ---
  function togglePanel(panel) {
    if (!panel) return;
    panel.classList.toggle('open');
    panel.setAttribute('aria-hidden', !panel.classList.contains('open'));
  }

  menuLeft?.addEventListener('click', () => togglePanel(leftPanel));
  menuRight?.addEventListener('click', () => togglePanel(rightPanel));
  closeButtons?.forEach(b => b.addEventListener('click', (e) => {
    const t = e.currentTarget.dataset.target;
    const el = document.getElementById(t);
    if (el) el.classList.remove('open');
  }));

  // panel nav handlers (left)
  document.querySelectorAll('.panel-nav button').forEach(btn => {
    btn.addEventListener('click', () => {
      const action = btn.dataset.action;
      // navigation stubs (TODO: convert to proper routes / API-driven actions)
      if (action === 'open-map') window.location.href = 'map/index.html';
      else if (action === 'recent-wars') showMessage(null, 'Fonction "guerres récentes" non implémentée.', 'info');
      else if (action === 'rules') window.open('rules.html', '_blank');
      else if (action === 'server-status') showMessage(null, 'Statut serveur : OK (placeholder)', 'info');
    });
  });

  // populate actions depending on role
  function setActionsForRole(role, user) {
    actionsList.innerHTML = '';
    const addBtn = (label, handler) => {
      const b = document.createElement('button');
      b.textContent = label;
      b.addEventListener('click', handler);
      actionsList.appendChild(b);
    };

    function showNotImpl(label) {
      return () => showMessage(null, `${label} — fonctionnalité non implémentée (TODO).`, 'info');
    }

    if (!role || role === 'pending') {
      addBtn('Choisir rôle', () => { window.location.href = 'choose-role.html'; });
      addBtn('Voir profil', () => { window.location.href = 'profile.html'; });
      return;
    }

    if (role === 'leader') {
      addBtn('Gérer le pays', showNotImpl('Gérer le pays'));
      addBtn('Nommer un ministre', showNotImpl('Nommer un ministre'));
      addBtn('Déclarer un état d\'alerte / guerre', showNotImpl('Déclarer un état d\'alerte / guerre'));
      addBtn('Inviter à la réunion', showNotImpl('Inviter à la réunion'));
    } else if (role === 'official') {
      addBtn('Proposer une loi', showNotImpl('Proposer une loi'));
      addBtn('Gérer le ministère', showNotImpl('Gérer le ministère'));
      addBtn('Consulter demandes citoyennes', showNotImpl('Consulter demandes citoyennes'));
    } else if (role === 'citizen') {
      addBtn('Choisir un métier', showNotImpl('Choisir un métier'));
      addBtn('Participer au forum local', showNotImpl('Participer au forum local'));
      addBtn('Postuler pour un poste officiel', showNotImpl('Postuler pour un poste officiel'));
    } else {
      addBtn('Actions disponibles', () => showMessage(null, 'Aucune action spéciale.', 'info'));
    }

    // every role has quick access to map/chat/profile
    addBtn('Accès au tchat', () => window.location.href = 'chat.html');
    addBtn('Voir profil', () => window.location.href = 'profile.html');
  }

  // --- Session & counts ---
  async function fetchSession() {
    const resp = await apiFetch('/api/session', { method: 'GET' });
    // resp may be normalized { ok, status, data, error } or raw
    if (!resp || !resp.ok) return resp || null;
    return resp.data;
  }

  async function countMembersInCountry(countryId) {
    // Attempt an API call if possible; fallback to placeholder.
    if (!countryId) return '—';
    try {
      // TODO: confirm backend endpoint. Candidate endpoints:
      // - GET /api/countries/:id/members  -> returns array
      // - GET /api/countries/:id/members/count -> returns { count: N }
      // We'll attempt both shapes gracefully.
      const resp1 = await apiFetch(`/api/countries/${encodeURIComponent(countryId)}/members`, { method: 'GET' });
      if (resp1 && resp1.ok && Array.isArray(resp1.data)) return resp1.data.length.toString();

      const resp2 = await apiFetch(`/api/countries/${encodeURIComponent(countryId)}/members/count`, { method: 'GET' });
      if (resp2 && resp2.ok) {
        if (typeof resp2.data === 'number') return String(resp2.data);
        if (resp2.data && typeof resp2.data.count === 'number') return String(resp2.data.count);
      }
      // fallback: check /api/countries (global) for members property
      const resp3 = await apiFetch('/api/countries', { method: 'GET' });
      if (resp3 && resp3.ok && Array.isArray(resp3.data)) {
        const c = resp3.data.find(cc => cc.id === countryId || cc.country_id === countryId);
        if (c && (typeof c.members === 'number')) return String(c.members);
      }
      // TODO: replace placeholder with authoritative endpoint when backend is available
      return '—';
    } catch (e) {
      return '—';
    }
  }

  // --- Initialization ---
  async function init() {
    if (welcomeEl) welcomeEl.textContent = 'Vérification de la session...';
    if (subtitleEl) subtitleEl.textContent = 'Chargement de vos informations';

    const resp = await fetchSession();
    // If fetchSession returned normalized error object like { ok:false } return earlier
    if (!resp) {
      if (welcomeEl) welcomeEl.textContent = 'Non connecté';
      if (subtitleEl) subtitleEl.textContent = 'Redirection vers la page de connexion...';
      setTimeout(() => window.location.href = 'index.html', 800);
      return;
    }

    // normalize: resp may be the session object already, or wrapper { data: session }
    const session = normalizeSessionResponse(resp) || resp;

    if (!session || !session.rp || !session.rp.joined) {
      if (welcomeEl) welcomeEl.textContent = `Salut ${session && session.username ? session.username : 'invité'} — rejoins le RP`;
      if (subtitleEl) subtitleEl.textContent = 'Redirection vers la page pour choisir un pays...';
      setTimeout(() => window.location.href = 'join-rp.html', 600);
      return;
    }

    const rp = session.rp || {};
    if (welcomeEl) welcomeEl.textContent = `Bienvenue ${session.username || 'Utilisateur'}`;
    if (subtitleEl) subtitleEl.textContent = `En tant que ${rp.role || '—'} — ${rp.country_name || rp.country_id || '—'}`;
    if (qiRole) qiRole.textContent = rp.role || '—';
    if (qiCountry) qiCountry.textContent = rp.country_name || rp.country_id || '—';
    if (qiMembers) qiMembers.textContent = await countMembersInCountry(rp.country_id);

    // feed sample (stub) — TODO: replace with real feed from /api/feed when backend exists
    if (feedList) feedList.innerHTML = `<div>Bienvenue dans le lobby RP. Rôle : <strong>${rp.role || '—'}</strong>. Actions disponibles dans le menu de droite.</div>`;

    // actions
    setActionsForRole(rp.role, session);

    // left footer extra info
    if (leftPanelFoot) leftPanelFoot.textContent = `Utilisateur: ${session.username || '—'} • connecté.`;
  }

  // wire logout (use apiFetch)
  logoutBtn?.addEventListener('click', async () => {
    try {
      const r = await apiFetch('/api/logout', { method: 'POST' });
      // ignore server failure for now but log if exists
      if (r && !r.ok) console.warn('Logout warning:', r.error || r);
    } catch (e) {
      console.warn('Logout error', e);
    } finally {
      window.location.href = 'index.html';
    }
  });

  // bottom nav behaviour (simple)
  document.querySelectorAll('.nav-btn').forEach(b => {
    b.addEventListener('click', () => {
      const to = b.dataset.to;
      if (to) window.location.href = to;
    });
  });

  // start
  init();
})();

===== ./settings.js =====

// settings.js — modifications de profil (avatar local + endpoints)
(() => {
  const toastEl = document.getElementById('toast');
  const avatarPreview = document.getElementById('avatarPreview');
  const avatarFile = document.getElementById('avatarFile');
  const changeAvatar = document.getElementById('changeAvatar');
  const removeAvatar = document.getElementById('removeAvatar');

  const inputDisplayName = document.getElementById('inputDisplayName');
  const profileForm = document.getElementById('profileForm');
  const cancelProfile = document.getElementById('cancelProfile');
  const saveProfile = document.getElementById('saveProfile');

  const currentPwd = document.getElementById('currentPwd');
  const newPwd = document.getElementById('newPwd');
  const confirmPwd = document.getElementById('confirmPwd');
  const pwdForm = document.getElementById('pwdForm');
  const cancelPwd = document.getElementById('cancelPwd');
  const savePwd = document.getElementById('savePwd');

  document.getElementById('nav-chat')?.addEventListener('click', () => location.href = 'chat.html');
  document.getElementById('nav-lobby')?.addEventListener('click', () => location.href = 'dashboard.html');
  document.getElementById('nav-notifs')?.addEventListener('click', () => alert('Notifications à implémenter'));
  document.getElementById('nav-profile')?.addEventListener('click', () => location.href = 'profile.html');

  function toast(msg, t = 3200) {
    if (!toastEl) return;
    toastEl.textContent = msg;
    toastEl.classList.remove('visually-hidden');
    setTimeout(() => toastEl.classList.add('visually-hidden'), t);
  }

  // Lightweight local fallback if WC.apiFetch is not available (keeps compatibility).
  async function localFetchWrapper(url, opts = {}) {
    opts.credentials = opts.credentials || 'same-origin';
    opts.headers = opts.headers || {};
    if (!opts.headers['Content-Type'] && !(opts.body instanceof FormData)) opts.headers['Content-Type'] = 'application/json';
    try {
      // if body is a plain object and content-type JSON, stringify
      if (opts.body && typeof opts.body === 'object' && !(opts.body instanceof FormData)) {
        const ct = (opts.headers['Content-Type'] || opts.headers['content-type'] || '').toLowerCase();
        if (ct.includes('application/json')) opts.body = JSON.stringify(opts.body);
      }

      const r = await fetch(url, opts);
      const ct = r.headers.get('content-type') || '';
      const data = ct.includes('application/json') ? await r.json() : await r.text();
      if (!r.ok) return { ok: false, status: r.status, data, error: data && data.error ? data.error : (typeof data === 'string' ? data : 'Erreur') };
      return { ok: true, status: r.status, data };
    } catch (err) {
      return { ok: false, status: 0, error: err.message || 'Network error' };
    }
  }

  // unified apiFetch used by this module (prefers centralized WC.apiFetch)
  async function apiFetch(url, opts = {}) {
    if (window.WC && typeof WC.apiFetch === 'function') {
      return WC.apiFetch(url, opts);
    }
    return localFetchWrapper(url, opts);
  }

  // avatar local preview
  function loadAvatar() {
    try {
      const d = localStorage.getItem('wc_avatar');
      if (d) { avatarPreview.style.backgroundImage = `url(${d})`; avatarPreview.textContent = ''; }
      else { avatarPreview.style.backgroundImage = 'none'; avatarPreview.textContent = 'WC'; }
    } catch (e) { avatarPreview.textContent = 'WC'; }
  }

  changeAvatar?.addEventListener('click', () => avatarFile?.click());
  avatarFile?.addEventListener('change', (e) => {
    const f = e.target.files?.[0];
    if (!f) return;
    if (!f.type.startsWith('image/')) { toast('Fichier non supporté'); return; }
    const r = new FileReader();
    r.onload = () => {
      try { localStorage.setItem('wc_avatar', r.result); } catch (err) { console.warn(err); }
      loadAvatar();
      toast('Avatar mis à jour (local)');
    };
    r.readAsDataURL(f);
  });

  removeAvatar?.addEventListener('click', () => {
    localStorage.removeItem('wc_avatar');
    loadAvatar();
    toast('Avatar supprimé (local)');
  });

  // normalize session response from apiFetch (supports both wrapped and raw responses)
  function normalizeSessionResponse(resp) {
    // If apiFetch wrapper returned { ok, status, data }
    if (resp && typeof resp === 'object' && ('ok' in resp)) {
      if (!resp.ok) return null;
      // session may be in resp.data, or resp.data may itself be a wrapper with .ok/data
      const payload = resp.data && resp.data.ok && resp.data.data ? resp.data.data : resp.data;
      return payload || null;
    }
    // fallback: legacy direct fetch returned the session object
    return resp || null;
  }

  // load session into form
  async function populate() {
    const s = await apiFetch('/api/session', { method: 'GET' });
    const session = normalizeSessionResponse(s);
    if (!session || !session.rp) {
      location.href = 'index.html';
      return;
    }
    inputDisplayName.value = session.rp?.displayName || '';
    loadAvatar();
  }

  // profile save
  profileForm?.addEventListener('submit', async (e) => {
    e.preventDefault();
    saveProfile.disabled = true;
    const displayName = (inputDisplayName.value || '').trim();
    // pass plain object — WC.apiFetch handles JSON serialization
    const r = await apiFetch('/api/user/update-profile', { method: 'POST', body: { displayName } });
    if (!r || !r.ok) {
      toast('Impossible d’enregistrer côté serveur — sauvegarde locale uniquement');
      saveProfile.disabled = false;
      return;
    }
    toast('Profil enregistré');
    saveProfile.disabled = false;
  });

  cancelProfile?.addEventListener('click', async () => { await populate(); toast('Annulé'); });

  // pwd save
  pwdForm?.addEventListener('submit', async (e) => {
    e.preventDefault();
    savePwd.disabled = true;
    const cur = (currentPwd.value || '').trim();
    const np = (newPwd.value || '').trim();
    const cp = (confirmPwd.value || '').trim();
    if (!cur || !np || np.length < 6) { toast('Champs invalides'); savePwd.disabled = false; return; }
    if (np !== cp) { toast('Les mots de passe ne correspondent pas'); savePwd.disabled = false; return; }
    const r = await apiFetch('/api/user/change-password', { method: 'POST', body: { current: cur, password: np } });
    if (!r || !r.ok) { toast((r && r.error) || 'Échec'); savePwd.disabled = false; return; }
    toast('Mot de passe mis à jour');
    currentPwd.value = ''; newPwd.value = ''; confirmPwd.value = '';
    savePwd.disabled = false;
  });

  cancelPwd?.addEventListener('click', () => { currentPwd.value=''; newPwd.value=''; confirmPwd.value=''; toast('Annulé'); });

  (async () => { try { await populate(); } catch (e) { console.error(e); location.href='index.html'; } })();
})();

===== ./map.html =====

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WorldConflict — Carte interactive</title>

  <!-- Leaflet CSS (CDN) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-sA+4dGkvFv0vL1JQqg6V8n0aYf2L0a1f9v+7G6u0XQM=" crossorigin=""/>

  <!-- Project CSS -->
  <link rel="stylesheet" href="map.css">
</head>
<body>
  <div class="shell">
    <header class="map-header">
      <div>
        <div class="title">Carte — WorldConflict</div>
        <div class="muted">Visualise les pays, membres et actions RP</div>
      </div>

      <div class="header-right">
        <div class="mini">Mode : <strong id="modeLabel">Lecture</strong></div>
        <button id="refreshBtn" class="btn" title="Rafraîchir">⟳ Rafraîchir</button>
      </div>
    </header>

    <div class="map-wrapper">
      <div id="map" class="panel" aria-label="Carte du monde"></div>

      <aside class="panel" aria-label="Panneau latéral">
        <h3>Contrôles</h3>
        <div class="search">
          <input id="searchInput" placeholder="Rechercher un pays..." aria-label="Recherche pays">
          <button id="searchBtn" class="btn">Rechercher</button>
        </div>

        <div class="controls">
          <button id="zoomIn" class="btn" title="Zoomer">＋</button>
          <button id="zoomOut" class="btn" title="Dézoomer">−</button>
          <button id="fitAll" class="btn" title="Tout voir">Tout voir</button>
        </div>

        <h3 style="margin-top:12px">Pays</h3>
        <div id="countryList" class="country-list" role="list"></div>

        <h3 style="margin-top:12px">Détails</h3>
        <div id="countryDetails" class="mini">Sélectionne un pays sur la carte ou dans la liste.</div>

        <div class="action-row">
          <button id="joinBtn" class="btn primary" disabled>Rejoindre</button>
          <button id="actionsBtn" class="btn" disabled>Actions</button>
        </div>
      </aside>
    </div>
  </div>

  <nav class="bottom-nav" aria-hidden="true">
    <button id="navChat" class="nav-item">Chat</button>
    <button id="navLobby" class="nav-item">Lobby</button>
    <button id="navMap" class="nav-item active">Carte</button>
    <button id="navProfile" class="nav-item">Profil</button>
  </nav>

  <div id="toast" aria-live="polite" hidden></div>

  <!-- Leaflet JS (CDN) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-o9N1j8gGq7y+9g+0v0bS6m7jG3wQ1q6o2KpG8g8g4NU=" crossorigin="" defer></script>

  <!-- App JS -->
  <script src="map.js" defer></script>
</body>
</html>

===== ./notifications.js =====

// notifications.js — professional notifications page
(() => {
  const notifListEl = document.getElementById('notifList');
  const tabs = Array.from(document.querySelectorAll('.notif-tabs .tab'));
  const btnLoadMore = document.getElementById('btnLoadMore');
  const btnMarkAllRead = document.getElementById('btnMarkAllRead');
  const btnClear = document.getElementById('btnClear');
  const toastEl = document.getElementById('toast');

  // nav buttons
  document.getElementById('nav-chat')?.addEventListener('click', () => location.href = 'chat.html');
  document.getElementById('nav-lobby')?.addEventListener('click', () => location.href = 'dashboard.html');
  document.getElementById('nav-notifs')?.addEventListener('click', () => { /* noop */ });
  document.getElementById('nav-profile')?.addEventListener('click', () => location.href = 'profile.html');

  function toast(msg, t = 2800) {
    if (!toastEl) return;
    toastEl.textContent = msg;
    toastEl.classList.remove('visually-hidden');
    setTimeout(() => toastEl.classList.add('visually-hidden'), t);
  }

  // Lightweight local fallback if WC.apiFetch is not available (keeps compatibility).
  async function localFetchWrapper(url, opts = {}) {
    opts.credentials = opts.credentials || 'same-origin';
    opts.headers = opts.headers || {};
    if (!opts.headers['Content-Type'] && !(opts.body instanceof FormData)) opts.headers['Content-Type'] = 'application/json';
    try {
      // if body is a plain object and content-type JSON, stringify
      if (opts.body && typeof opts.body === 'object' && !(opts.body instanceof FormData)) {
        const ct = (opts.headers['Content-Type'] || opts.headers['content-type'] || '').toLowerCase();
        if (ct.includes('application/json')) opts.body = JSON.stringify(opts.body);
      }

      const r = await fetch(url, opts);
      const ct = r.headers.get('content-type') || '';
      const data = ct.includes('application/json') ? await r.json() : await r.text();
      if (!r.ok) return { ok: false, status: r.status, data, error: data && data.error ? data.error : (typeof data === 'string' ? data : 'Erreur') };
      return { ok: true, status: r.status, data };
    } catch (err) {
      return { ok: false, status: 0, error: err.message || 'Network error' };
    }
  }

  // unified apiFetch used by this module (prefers centralized WC.apiFetch)
  async function apiFetch(url, opts = {}) {
    if (window.WC && typeof WC.apiFetch === 'function') {
      return WC.apiFetch(url, opts);
    }
    return localFetchWrapper(url, opts);
  }

  // client state
  let notifications = []; // full list in memory
  let filtered = [];
  let page = 0;
  const PAGE_SIZE = 12;
  let activeFilter = 'all';
  let loading = false;

  // UI helpers
  function isoToNice(iso) {
    try {
      const d = new Date(iso);
      return d.toLocaleString();
    } catch (e) {
      return iso;
    }
  }

  function renderNotification(n) {
    const item = document.createElement('article');
    item.className = 'notif-item' + (n.read ? '' : ' unread');
    item.dataset.id = n.id;

    const avatar = document.createElement('div');
    avatar.className = 'notif-avatar';
    avatar.textContent = n.source ? n.source[0]?.toUpperCase() : 'WC';

    const body = document.createElement('div');
    body.className = 'notif-body';
    const title = document.createElement('h3');
    title.className = 'notif-title';
    title.textContent = n.title || (n.type || 'Notification');
    const text = document.createElement('p');
    text.className = 'notif-text';
    text.textContent = n.text || '';
    const meta = document.createElement('div');
    meta.className = 'notif-meta';
    meta.innerHTML = `<time datetime="${n.ts}">${isoToNice(n.ts)}</time><span>•</span><span>${n.type?.toUpperCase() || 'GEN'}</span>`;

    body.appendChild(title);
    body.appendChild(text);
    body.appendChild(meta);

    const controls = document.createElement('div');
    controls.className = 'notif-controls';
    const btnToggle = document.createElement('button');
    btnToggle.className = 'icon-btn';
    btnToggle.title = n.read ? 'Marquer non lu' : 'Marquer lu';
    btnToggle.textContent = n.read ? '●' : '○';
    btnToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleRead(n.id);
    });

    const btnOpen = document.createElement('button');
    btnOpen.className = 'icon-btn';
    btnOpen.title = 'Ouvrir';
    btnOpen.textContent = '→';
    btnOpen.addEventListener('click', (e) => {
      e.stopPropagation();
      openNotification(n);
    });

    controls.appendChild(btnToggle);
    controls.appendChild(btnOpen);

    item.appendChild(avatar);
    item.appendChild(body);
    item.appendChild(controls);

    // click opens
    item.addEventListener('click', () => openNotification(n));

    return item;
  }

  function renderPage() {
    if (!notifListEl) return;
    if (page === 0) notifListEl.innerHTML = '';
    const start = page * PAGE_SIZE;
    const chunk = filtered.slice(start, start + PAGE_SIZE);
    for (const n of chunk) {
      notifListEl.appendChild(renderNotification(n));
    }
    // update load more visibility
    if ((page + 1) * PAGE_SIZE >= filtered.length) {
      btnLoadMore?.setAttribute('disabled', 'disabled');
      btnLoadMore?.classList.add('visually-hidden');
    } else {
      btnLoadMore?.removeAttribute('disabled');
      btnLoadMore?.classList.remove('visually-hidden');
    }
  }

  function applyFilter() {
    if (activeFilter === 'all') filtered = notifications.slice().sort((a,b) => (b.ts||'').localeCompare(a.ts||''));
    else filtered = notifications.filter(n => {
      if (activeFilter === 'mentions') return !!n.mention;
      if (activeFilter === 'rp') return (n.category === 'rp' || n.type === 'rp' || n.type === 'announcement');
      if (activeFilter === 'hrp') return (n.category === 'hrp' || n.type === 'hrp');
      if (activeFilter === 'system') return (n.category === 'system' || n.type === 'system');
      return true;
    }).sort((a,b) => (b.ts||'').localeCompare(a.ts||''));
    page = 0;
    renderPage();
  }

  async function loadNotifications() {
    if (loading) return;
    loading = true;
    notifListEl.setAttribute('aria-busy', 'true');
    try {
      const r = await apiFetch('/api/notifications', { method: 'GET' });
      if (!r || !r.ok || !r.data) {
        // fallback demo data
        notifications = generateDemoNotifications();
        toast('Mode démo — notifications locales chargées');
      } else {
        // Try several shapes: { notifications: [...] } or array directly or { data: [...] }
        if (Array.isArray(r.data.notifications)) {
          notifications = r.data.notifications;
        } else if (Array.isArray(r.data)) {
          notifications = r.data;
        } else if (Array.isArray(r.data.data)) {
          notifications = r.data.data;
        } else {
          // last attempt: if r.data has keys and it's not array, try to extract notifications prop or default to empty
          notifications = Array.isArray(r.data.notifications) ? r.data.notifications : (r.data || []);
        }
      }
    } catch (e) {
      notifications = generateDemoNotifications();
      toast('Erreur réseau — mode démo');
    } finally {
      loading = false;
      notifListEl.setAttribute('aria-busy', 'false');
      applyFilter();
    }
  }

  function generateDemoNotifications() {
    const now = Date.now();
    return [
      { id: 'n1', title: 'Nouveau message dans #général', text: 'Salut — bienvenue sur WorldConflict!', ts: new Date(now - 1000*60*10).toISOString(), read: false, type: 'rp', category: 'rp', source: 'Salon' },
      { id: 'n2', title: 'Annonce système', text: 'Maintenance prévue demain 02:00 UTC.', ts: new Date(now - 1000*60*60).toISOString(), read: false, type: 'system', category: 'system', source: 'Sys' },
      { id: 'n3', title: 'Tu as été mentionné', text: '@tu dans #france', ts: new Date(now - 1000*60*60*5).toISOString(), read: true, type: 'mentions', category: 'rp', mention: true, source: 'UserA' },
      { id: 'n4', title: 'Annonce HRP', text: 'Événement communautaire vendredi.', ts: new Date(now - 1000*60*60*24).toISOString(), read: true, type: 'hrp', category: 'hrp', source: 'HRP' },
      { id: 'n5', title: 'Nouvelle politique', text: 'Règlement mis à jour.', ts: new Date(now - 1000*60*60*48).toISOString(), read: false, type: 'system', category: 'system', source: 'Sys' },
    ];
  }

  async function toggleRead(id) {
    const idx = notifications.findIndex(n => n.id === id);
    if (idx === -1) return;
    const current = notifications[idx];
    const newRead = !current.read;
    // optimistic UI
    notifications[idx].read = newRead;
    applyFilter();
    // try server
    try {
      const r = await apiFetch(`/api/notifications/${encodeURIComponent(id)}/read`, { method: 'POST', body: { read: newRead } });
      if (!r || !r.ok) {
        // revert
        notifications[idx].read = current.read;
        applyFilter();
        toast('Impossible de mettre à jour sur le serveur');
      } else {
        toast(newRead ? 'Marquée comme lue' : 'Marquée non lue', 1200);
      }
    } catch (e) {
      // revert
      notifications[idx].read = current.read;
      applyFilter();
      toast('Erreur réseau');
    }
  }

  function openNotification(n) {
    // Mark read locally if unread
    if (!n.read) {
      n.read = true;
      applyFilter();
      // fire server call but no need to await
      apiFetch(`/api/notifications/${encodeURIComponent(n.id)}/read`, { method: 'POST', body: { read: true } }).catch(()=>{});
    }
    // navigate depending on payload (if provided)
    if (n.url) {
      location.href = n.url;
    } else {
      // open a small modal fallback (alert)
      alert((n.title ? (n.title + '\n\n') : '') + (n.text || ''));
    }
  }

  btnLoadMore?.addEventListener('click', () => {
    page++;
    renderPage();
  });

  btnMarkAllRead?.addEventListener('click', async () => {
    if (!notifications.length) return;
    // optimistic
    notifications.forEach(n => n.read = true);
    applyFilter();
    try {
      const r = await apiFetch('/api/notifications/mark-all-read', { method: 'POST' });
      if (!r || !r.ok) toast('Impossible de marquer toutes côté serveur');
      else toast('Toutes marquées comme lues');
    } catch (e) {
      toast('Erreur réseau');
    }
  });

  btnClear?.addEventListener('click', async () => {
    if (!confirm('Supprimer toutes les notifications ?')) return;
    // optimistic clear
    notifications = [];
    applyFilter();
    try {
      const r = await apiFetch('/api/notifications/clear', { method: 'POST' });
      if (!r || !r.ok) toast('Impossible de vider côté serveur');
      else toast('Notifications supprimées');
    } catch (e) {
      toast('Erreur réseau');
    }
  });

  // tab switching
  tabs.forEach(t => t.addEventListener('click', (e) => {
    tabs.forEach(x => x.classList.remove('active'));
    e.currentTarget.classList.add('active');
    activeFilter = e.currentTarget.dataset.filter || 'all';
    applyFilter();
  }));

  // initial load
  (async () => {
    await loadNotifications();
  })();

})();

===== ./settings.html =====

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WorldConflict — Paramètres</title>

  <link rel="stylesheet" href="variables.css">
  <link rel="stylesheet" href="settings.css">
</head>
<body>
  <div class="settings-shell container">
    <header class="settings-header">
      <a href="profile.html" class="icon-btn">←</a>
      <div><h1>Paramètres</h1><div class="muted">Modifier ton profil et ta sécurité</div></div>
      <div></div>
    </header>

    <main class="settings-main">
      <section class="panel">
        <h2>Profil</h2>
        <div class="profile-ctrls">
          <div id="avatarPreview" class="avatar avatar-xl">WC</div>
          <div class="profile-ctrls-right">
            <input id="avatarFile" type="file" accept="image/*" class="visually-hidden">
            <button id="changeAvatar" class="btn btn-ghost small">Changer l'avatar</button>
            <button id="removeAvatar" class="btn btn-ghost small">Supprimer</button>
          </div>
        </div>

        <form id="profileForm">
          <label class="field">
            <span class="label">Nom d'affichage</span>
            <input id="inputDisplayName" class="text-input" autocomplete="name" placeholder="Pseudo affiché">
          </label>

          <div class="actions-row">
            <button id="cancelProfile" type="button" class="btn btn-ghost">Annuler</button>
            <button id="saveProfile" type="submit" class="btn btn-primary">Enregistrer</button>
          </div>
        </form>
      </section>

      <section class="panel" style="margin-top:12px">
        <h2>Sécurité</h2>
        <form id="pwdForm">
          <label class="field">
            <span class="label">Mot de passe actuel</span>
            <input id="currentPwd" class="text-input" type="password" autocomplete="current-password">
          </label>
          <label class="field">
            <span class="label">Nouveau mot de passe</span>
            <input id="newPwd" class="text-input" type="password" autocomplete="new-password">
          </label>
          <label class="field">
            <span class="label">Confirmer</span>
            <input id="confirmPwd" class="text-input" type="password">
          </label>

          <div class="actions-row">
            <button id="cancelPwd" type="button" class="btn btn-ghost">Annuler</button>
            <button id="savePwd" type="submit" class="btn btn-primary">Mettre à jour</button>
          </div>
        </form>
      </section>
    </main>

    <nav class="bottom-nav" aria-label="Navigation">
      <button id="nav-chat" class="nav-btn" title="Chat">Chat</button>
      <button id="nav-lobby" class="nav-btn" title="Lobby">Lobby</button>
      <button id="nav-notifs" class="nav-btn" title="Notifications">Notif</button>
      <button id="nav-profile" class="nav-btn" title="Profil">Profil</button>
    </nav>

    <div id="toast" class="wc-toast visually-hidden" role="status" aria-live="polite"></div>
  </div>

  <script src="utils.js" defer></script>
  <script src="settings.js" defer></script>
</body>
</html>

===== ./index.js =====

// index.js — login (refactoré)
// - Utilise WC.apiFetch (utils.js)
// - Normalise les réponses API { ok, status, data, error }
// - Gestion uniforme des erreurs et fallback d'affichage
(() => {
  // éléments du DOM
  const form = document.getElementById('loginForm');
  const togglePassword = document.getElementById('togglePassword');
  const createAccount = document.getElementById('createAccount');
  const yearEl = document.getElementById('year');
  const userInput = document.getElementById('userInput');
  const passwordInput = document.getElementById('passwordInput');

  // afficher année
  if (yearEl) yearEl.textContent = new Date().getFullYear();

  // pré-remplir si "se souvenir" a été utilisé
  try {
    const remembered = localStorage.getItem('wc_remember_user');
    if (remembered && userInput) userInput.value = remembered;
  } catch (e) {
    console.warn('localStorage inaccessible', e);
  }

  // toggle mot de passe (safe)
  if (togglePassword && passwordInput) {
    togglePassword.addEventListener('click', () => {
      passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password';
      togglePassword.setAttribute('aria-pressed', passwordInput.type === 'text');
    });
  }

  // ouvrir la page d'inscription
  if (createAccount) {
    createAccount.addEventListener('click', () => {
      location.href = 'register.html';
    });
  }

  // --- Helpers: affichage messages et normalisation réponse ---
  function showMessage(el, msg, type = 'info') {
    // Prefer WC.showMessage if available
    if (window.WC && typeof window.WC.showMessage === 'function') {
      try { window.WC.showMessage(el, msg, type); return; } catch (e) { /* ignore and fallback */ }
    }
    // Fallback: element with id 'loginMsg' or generic toast
    if (el) {
      el.textContent = msg;
      el.className = `msg msg-${type}`;
      return;
    }
    const toast = document.getElementById('toast');
    if (toast) {
      toast.textContent = msg;
      toast.classList.remove('visually-hidden');
      setTimeout(() => toast.classList.add('visually-hidden'), 3200);
      return;
    }
    // Last resort: console
    if (type === 'error') console.error(msg);
    else console.warn(msg);
  }

  /**
   * Normalize API call response into { ok, status, data, error }
   * Accepts:
   *  - Already-normalized object: { ok, status, data, error }
   *  - Wrapper: { ok: true, data: { ...session... } }
   *  - Raw data (assume success): session object
   *  - null/undefined -> null
   */
  function normalizeResponse(resp) {
    if (!resp) return null;
    if (typeof resp === 'object' && ('ok' in resp)) {
      // already normalized
      return {
        ok: !!resp.ok,
        status: resp.status || 0,
        data: resp.data === undefined ? null : resp.data,
        error: resp.error || null
      };
    }
    // possible shape: { ok:true, data: { ok:true, data: {...} } }
    if (resp && resp.data && typeof resp.data === 'object' && ('ok' in resp.data)) {
      return {
        ok: !!resp.data.ok,
        status: resp.status || 0,
        data: resp.data.data === undefined ? null : resp.data.data,
        error: resp.data.error || null
      };
    }
    // fallback: treat as successful raw payload
    return { ok: true, status: 200, data: resp, error: null };
  }

  // --- NOUVELLE LOGIQUE DE SUBMIT (utilise WC.apiFetch) ---
  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const user = (form.user?.value || '').trim();
      const password = form.password?.value || '';
      const remember = !!form.querySelector('input[name="remember"]')?.checked;
      const btn = form.querySelector('.btn.primary');

      // créer / récupérer l'élément message
      const msgEl = document.getElementById('loginMsg') || (() => {
        const d = document.createElement('div');
        d.id = 'loginMsg';
        d.className = 'msg';
        form.appendChild(d);
        return d;
      })();

      // validations simples
      if (!user) return showMessage(msgEl, "Renseigne ton email ou nom d'utilisateur.", 'error');
      if (!password || password.length < 6) return showMessage(msgEl, 'Le mot de passe doit contenir au moins 6 caractères.', 'error');

      // set loading
      if (window.WC && typeof window.WC.setBtnLoading === 'function') {
        try { window.WC.setBtnLoading(btn, true, 'Connexion...'); } catch (e) { /* ignore */ }
      } else if (btn) {
        btn.setAttribute('disabled', 'disabled');
      }

      try {
        // appel centralisé — WC.apiFetch est dans utils.js
        const rawResp = await (window.WC && typeof window.WC.apiFetch === 'function'
          ? window.WC.apiFetch('/api/login', { method: 'POST', body: { user, password } })
          : fetch('/api/login', { method: 'POST', credentials: 'same-origin', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ user, password }) }).then(async r => {
              const ct = r.headers.get && r.headers.get('content-type') || '';
              const data = ct.includes('application/json') ? await r.json() : await r.text();
              return r.ok ? data : { ok: false, status: r.status, error: (data && data.error) || `HTTP ${r.status}` };
            }));

        const resp = normalizeResponse(rawResp);

        if (!resp || !resp.ok) {
          // stop loading
          if (window.WC && typeof window.WC.setBtnLoading === 'function') {
            try { window.WC.setBtnLoading(btn, false); } catch (e) { /* noop */ }
          } else if (btn) {
            btn.removeAttribute('disabled');
          }

          const errMsg = resp && resp.error ? resp.error : 'Identifiants invalides';
          showMessage(msgEl, 'Échec de la connexion — ' + errMsg, 'error');
          return;
        }

        // Optionnel : vérifier resp.data.ok si backend wraps responses
        if (resp.data && typeof resp.data === 'object' && ('ok' in resp.data) && !resp.data.ok) {
          // backend signale une erreur métier
          const businessError = resp.data.error || 'Identifiants invalides';
          showMessage(msgEl, 'Échec de la connexion — ' + businessError, 'error');
          if (window.WC && typeof window.WC.setBtnLoading === 'function') try { window.WC.setBtnLoading(btn, false); } catch(e){}
          else if (btn) btn.removeAttribute('disabled');
          return;
        }

        // gérer "se souvenir"
        try {
          if (remember) localStorage.setItem('wc_remember_user', user);
          else localStorage.removeItem('wc_remember_user');
        } catch (err) { /* noop */ }

        // succès → redirection
        window.location.href = 'dashboard.html';
      } catch (err) {
        // Erreur réseau / inattendue
        if (window.WC && typeof window.WC.setBtnLoading === 'function') {
          try { window.WC.setBtnLoading(btn, false); } catch (e) { /* noop */ }
        } else if (btn) {
          btn.removeAttribute('disabled');
        }
        console.error('Login error', err);
        showMessage(msgEl, 'Erreur réseau — impossible de joindre le serveur.', 'error');
      }
    });
  }
})();

===== ./file.env =====

NODE_ENV=production
PORT=3000
SESSION_SECRET=je_suis_da_best
TRUST_PROXY=1

===== ./register.js =====

// register.js — formulaire d'inscription (refactoré)
// - Utilise WC.apiFetch (utils.js) avec fallback minimal
// - Normalise les réponses { ok, status, data, error }
// - Remplace alert() par WC.showMessage / toast fallback
// - TODO: nettoyer fallback (force register) quand backend stable
(() => {
  const form = document.getElementById('registerForm');
  const togglePassword = document.getElementById('togglePassword');
  const year = document.getElementById('year');
  const acceptCheckbox = document.getElementById('acceptCheckbox');
  const rulesLink = document.getElementById('rulesLink');
  const submitBtn = document.getElementById('submitBtn');
  const emailInput = document.getElementById('email');
  const usernameInput = document.getElementById('username');

  // create email status element if missing
  let emailStatusEl = document.getElementById('emailStatus');
  if (!emailStatusEl && emailInput) {
    emailStatusEl = document.createElement('div');
    emailStatusEl.id = 'emailStatus';
    emailStatusEl.style.marginTop = '8px';
    emailStatusEl.style.fontSize = '13px';
    emailStatusEl.className = 'muted';
    emailInput.insertAdjacentElement('afterend', emailStatusEl);
  }

  if (year) year.textContent = new Date().getFullYear();
  if (submitBtn) submitBtn.disabled = true;

  // local state
  let emailAvailable = null; // true | false | null
  let checkAttempts = 0;
  const MAX_ATTEMPTS = 3;
  let checking = false;
  let checkTimer = null;

  function setEmailStatus(text = '', type = 'info') {
    if (!emailStatusEl) return;
    emailStatusEl.textContent = text;
    emailStatusEl.classList.remove('msg-error', 'msg-success', 'msg-info');
    emailStatusEl.classList.add(type === 'success' ? 'msg-success' : type === 'error' ? 'msg-error' : 'msg-info');
  }

  function showMessage(elOrId, text, type = 'error', timeout = 4000) {
    // prefer WC.showMessage if available
    if (window.WC && typeof window.WC.showMessage === 'function') {
      try { window.WC.showMessage(elOrId, text, type, timeout); return; } catch (e) { /* fallback */ }
    }
    // if elOrId is element, use it
    let el = typeof elOrId === 'string' ? document.getElementById(elOrId) : elOrId;
    if (el) {
      el.textContent = text;
      el.className = `msg msg-${type}`;
      if (timeout) setTimeout(() => { if (el) el.textContent = ''; }, timeout);
      return;
    }
    const toast = document.getElementById('toast');
    if (toast) {
      toast.textContent = text;
      toast.classList.remove('visually-hidden');
      setTimeout(() => toast.classList.add('visually-hidden'), timeout || 3200);
      return;
    }
    // last resort
    if (type === 'error') console.error(text);
    else console.warn(text);
  }

  function normalizeResponse(resp) {
    if (!resp) return null;
    if (typeof resp === 'object' && ('ok' in resp)) {
      return { ok: !!resp.ok, status: resp.status || 0, data: resp.data === undefined ? null : resp.data, error: resp.error || null };
    }
    // wrapper shape { data: { ok: true, data: {...} } }
    if (resp && resp.data && typeof resp.data === 'object' && ('ok' in resp.data)) {
      return { ok: !!resp.data.ok, status: resp.status || 0, data: resp.data.data === undefined ? null : resp.data.data, error: resp.data.error || null };
    }
    // raw payload
    return { ok: true, status: 200, data: resp, error: null };
  }

  // apiFetch helper: prefers WC.apiFetch (utils.js) else minimal fetch fallback
  async function apiFetch(url, opts = {}) {
    if (window.WC && typeof window.WC.apiFetch === 'function') {
      try {
        return await window.WC.apiFetch(url, opts);
      } catch (e) {
        return { ok: false, status: 0, error: e && e.message ? e.message : 'WC.apiFetch error' };
      }
    }
    // minimal fallback (shouldn't be used if utils.js is loaded)
    try {
      const final = Object.assign({}, opts);
      final.credentials = final.credentials || 'same-origin';
      final.headers = Object.assign({}, final.headers || {});
      if (final.body && typeof final.body === 'object' && !(final.body instanceof FormData)) {
        if (!final.headers['Content-Type'] && !final.headers['content-type']) final.headers['Content-Type'] = 'application/json';
        const ct = (final.headers['Content-Type'] || final.headers['content-type'] || '').toLowerCase();
        if (ct.includes('application/json')) final.body = JSON.stringify(final.body);
      }
      const r = await fetch(url, final);
      const ct = r.headers.get('content-type') || '';
      const data = ct.includes('application/json') ? await r.json() : await r.text();
      if (!r.ok) return { ok: false, status: r.status, data, error: (data && data.error) || (typeof data === 'string' ? data : 'Erreur') };
      return { ok: true, status: r.status, data };
    } catch (e) {
      return { ok: false, status: 0, error: e && e.message ? e.message : 'Network error' };
    }
  }

  function updateSubmitState() {
    const accepted = !!(acceptCheckbox && acceptCheckbox.checked);
    const allowFallback = (emailAvailable === null && checkAttempts >= MAX_ATTEMPTS);
    const ok = accepted && (emailAvailable === true || allowFallback);
    if (submitBtn) submitBtn.disabled = !ok;
  }

  // toggle password visibility
  if (togglePassword) {
    togglePassword.addEventListener('click', () => {
      const pass = document.getElementById('password');
      if (!pass) return;
      pass.type = pass.type === 'password' ? 'text' : 'password';
      togglePassword.setAttribute('aria-pressed', pass.type === 'text');
    });
  }

  if (rulesLink) rulesLink.addEventListener('click', (e) => { e.preventDefault(); /* intentionally noop */ });

  // Email check (debounced)
  async function doCheckEmail(email) {
    if (!email || email.indexOf('@') === -1) {
      emailAvailable = null;
      setEmailStatus('', 'info');
      updateSubmitState();
      return;
    }

    checking = true;
    checkAttempts++;
    setEmailStatus('Vérification de l’adresse…', 'info');

    try {
      const raw = await apiFetch('/api/check-email', { method: 'POST', body: { email } });
      const resp = normalizeResponse(raw);

      if (!resp || !resp.ok || resp.data === null || resp.data === undefined) {
        emailAvailable = null;
        setEmailStatus('Impossible de vérifier l’e-mail (erreur serveur).', 'error');
      } else {
        // possible shapes: resp.data = { available: true } OR resp.data.available, OR resp.data.data.available
        const payload = (typeof resp.data === 'object') ? resp.data : {};
        const available = ('available' in payload) ? payload.available : (payload.data && typeof payload.data === 'object' && 'available' in payload.data ? payload.data.available : undefined);

        if (available === undefined) {
          emailAvailable = null;
          setEmailStatus('Vérification indisponible actuellement.', 'error');
        } else {
          emailAvailable = !!available;
          if (emailAvailable) setEmailStatus('Adresse disponible ✅', 'success');
          else setEmailStatus('Cette adresse est déjà utilisée.', 'error');
        }
      }
    } catch (err) {
      console.warn('checkEmail error', err);
      emailAvailable = null;
      setEmailStatus('Erreur réseau — impossible de vérifier l’e-mail.', 'error');
    } finally {
      checking = false;
      updateSubmitState();
    }
  }

  if (emailInput) {
    emailInput.addEventListener('input', () => {
      emailAvailable = null;
      setEmailStatus('', 'info');
      updateSubmitState();
      if (checkTimer) clearTimeout(checkTimer);
      checkTimer = setTimeout(() => doCheckEmail(emailInput.value.trim()), 500);
    });
  }

  // Form submit (register)
  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const username = form.username?.value?.trim();
      const email = form.email?.value?.trim();
      const password = form.password?.value;
      const confirm = form.confirm?.value;
      const accepted = !!(acceptCheckbox && acceptCheckbox.checked);

      // client validation
      if (!username || username.length < 3) return showMessage(null, "Nom d'utilisateur : au moins 3 caractères.", 'error');
      if (!email || email.indexOf('@') === -1) return showMessage(null, 'Adresse e-mail invalide.', 'error');
      if (!password || password.length < 6) return showMessage(null, 'Mot de passe : au moins 6 caractères.', 'error');
      if (password !== confirm) return showMessage(null, 'Les mots de passe ne correspondent pas.', 'error');
      if (!accepted) return showMessage(null, 'Tu dois accepter la politique et les règlements.', 'error');
      if (emailAvailable === false) return showMessage(null, "Cette adresse e-mail est déjà utilisée. Utilise une autre adresse.", 'error');

      // if check not possible and attempts low, force confirmation
      if (emailAvailable === null && checkAttempts < MAX_ATTEMPTS) {
        // TODO: once backend is reliable, remove this forced path and require server verification
        const cont = window.confirm("La vérification de l'email n'a pas abouti — veux-tu attendre la vérification (recommandé) ?\n\nAnnuler = attendre, OK = forcer l'inscription.");
        if (!cont) return;
      }

      // loading state
      if (window.WC && typeof window.WC.setBtnLoading === 'function') {
        try { window.WC.setBtnLoading(submitBtn, true, 'Création du compte...'); } catch (e) { submitBtn.disabled = true; }
      } else if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = 'Création du compte...';
      }

      try {
        const raw = await apiFetch('/api/register', { method: 'POST', body: { username, email, password } });
        const resp = normalizeResponse(raw);

        if (!resp || !resp.ok) {
          const err = resp && resp.error ? resp.error : 'Impossible de créer le compte';
          showMessage(null, 'Erreur : ' + err, 'error');
          if (window.WC && typeof window.WC.setBtnLoading === 'function') try { window.WC.setBtnLoading(submitBtn, false); } catch(e) {}
          else if (submitBtn) { submitBtn.disabled = false; submitBtn.textContent = 'Créer un compte'; }
          return;
        }

        // Backend may return { ok: true } inside resp.data
        const payload = (resp.data && typeof resp.data === 'object') ? resp.data : {};
        if ('ok' in payload && !payload.ok) {
          showMessage(null, 'Erreur : ' + (payload.error || 'Impossible de créer le compte'), 'error');
          if (window.WC && typeof window.WC.setBtnLoading === 'function') try { window.WC.setBtnLoading(submitBtn, false); } catch(e) {}
          else if (submitBtn) { submitBtn.disabled = false; submitBtn.textContent = 'Créer un compte'; }
          return;
        }

        // success
        showMessage(null, 'Compte créé ✅ — tu peux maintenant te connecter.', 'success', 5000);

        // small delay to show message then redirect
        setTimeout(() => { location.href = 'index.html'; }, 900);
      } catch (err) {
        console.error('Register error', err);
        showMessage(null, 'Erreur réseau — impossible de joindre le serveur.', 'error');
        if (window.WC && typeof window.WC.setBtnLoading === 'function') try { window.WC.setBtnLoading(submitBtn, false); } catch(e) {}
        else if (submitBtn) { submitBtn.disabled = false; submitBtn.textContent = 'Créer un compte'; }
      }
    });
  }

  // re-enable submit button when terms checkbox toggled (manual)
  if (acceptCheckbox) acceptCheckbox.addEventListener('change', updateSubmitState);

})();

===== ./market.js =====

// market.js — Front (strict) : PAS de demo fallback, PAS de génération d'items.
// Doit être utilisé avec une API backend exposant:
//   GET  /api/market/catalog
//   GET  /api/market/snapshot
//   POST /api/market/quote   { itemId, qty, countryId }
//   POST /api/market/trade   { actor, itemId, qty, countryId, side }
// Si l'API est absente, l'UI sera désactivée et affichera un message clair.

const D = document;
const $ = sel => D.querySelector(sel);

// DOM refs (assume market.html structure unchanged)
const itemListEl = $('#itemList');
const searchInput = $('#searchInput');
const searchBtn = $('#searchBtn');
const viewAllBtn = $('#viewAllBtn');

const selectedItemEl = $('#selectedItem');
const itemIdInput = $('#itemId');
const qtyInput = $('#qty');
const countryIdInput = $('#countryId');
const getQuoteBtn = $('#getQuoteBtn');
const quoteResultEl = $('#quoteResult');
const tradeControlsEl = $('#tradeControls');
const buyBtn = $('#buyBtn');
const sellBtn = $('#sellBtn');
const tradeMsgEl = $('#tradeMsg');
const breakdownPre = $('#breakdownPre');

const marketSnapshotEl = $('#marketSnapshot');
const recentTradesEl = $('#recentTrades');
const refreshBtn = $('#refreshBtn');
const viewLedgerBtn = $('#viewLedgerBtn');
const toastEl = $('#toast');

let MODE = { apiAvailable: null }; // null = unchecked, true/false

/* ---------------------------
   Helpers: apiFetch (uses WC.apiFetch if present)
   --------------------------- */
async function apiFetch(url, opts = {}) {
  const final = Object.assign({}, opts);
  final.credentials = final.credentials || 'same-origin';
  final.headers = Object.assign({}, final.headers || {});

  // JSON body auto-stringify
  if (final.body && typeof final.body === 'object' && !(final.body instanceof FormData)) {
    if (!final.headers['Content-Type'] && !final.headers['content-type']) final.headers['Content-Type'] = 'application/json';
    const ct = (final.headers['Content-Type'] || final.headers['content-type'] || '').toLowerCase();
    if (ct.includes('application/json')) final.body = JSON.stringify(final.body);
  }

  if (window.WC && typeof window.WC.apiFetch === 'function') {
    try {
      return await window.WC.apiFetch(url, final);
    } catch (e) {
      return { ok: false, status: 0, error: e && e.message ? e.message : 'WC.apiFetch error' };
    }
  }

  try {
    const r = await fetch(url, final);
    const ct = r.headers.get && r.headers.get('content-type') || '';
    const data = ct.includes('application/json') ? await r.json() : await r.text();
    if (!r.ok) return { ok: false, status: r.status, data, error: (data && data.error) || `HTTP ${r.status}` };
    return { ok: true, status: r.status, data };
  } catch (e) {
    return { ok: false, status: 0, error: e && e.message ? e.message : 'Network error' };
  }
}

/* ---------------------------
   UI utilities
   --------------------------- */
function showToast(msg, type = 'info', dur = 2800) {
  if (window.WC && typeof window.WC.showMessage === 'function') {
    try { window.WC.showMessage(null, msg, type, dur); return; } catch (e) {}
  }
  if (!toastEl) { console[type === 'error' ? 'error' : 'log']('[market]', msg); return; }
  toastEl.textContent = msg;
  toastEl.classList.remove('visually-hidden');
  setTimeout(() => toastEl.classList.add('visually-hidden'), dur);
}

function setLoading(el, loading = true, label = null) {
  if (!el) return;
  if (loading) {
    el.setAttribute('disabled', 'disabled');
    if (label) el.dataset._old = el.textContent, el.textContent = label;
  } else {
    el.removeAttribute('disabled');
    if (el.dataset && el.dataset._old) {
      el.textContent = el.dataset._old;
      delete el.dataset._old;
    }
  }
}

function disableAllControls(reasonMsg = '') {
  [getQuoteBtn, buyBtn, sellBtn, searchBtn, viewAllBtn, refreshBtn, viewLedgerBtn].forEach(b => b && b.setAttribute('disabled', 'disabled'));
  if (reasonMsg) {
    quoteResultEl.textContent = reasonMsg;
    marketSnapshotEl.innerHTML = `<div class="muted">${reasonMsg}</div>`;
    itemListEl.innerHTML = `<div class="muted">${reasonMsg}</div>`;
  }
}

/* ---------------------------
   API detection and fetchers
   --------------------------- */
async function detectApi() {
  if (MODE.apiAvailable !== null) return MODE.apiAvailable;
  try {
    // prefer a lightweight catalog check
    const r = await apiFetch('/api/market/catalog', { method: 'GET' });
    if (r && r.ok) { MODE.apiAvailable = true; return true; }

    // fallback to snapshot
    const r2 = await apiFetch('/api/market/snapshot', { method: 'GET' });
    if (r2 && r2.ok) { MODE.apiAvailable = true; return true; }
  } catch (e) { /* ignore */ }
  MODE.apiAvailable = false;
  return false;
}

async function fetchCatalog() {
  // Strict: no client-side catalog generation
  const r = await apiFetch('/api/market/catalog', { method: 'GET' });
  if (!r || !r.ok) {
    // Try another conventional endpoint
    const r2 = await apiFetch('/api/items', { method: 'GET' });
    if (!r2 || !r2.ok) {
      throw new Error(r && r.error ? r.error : (r2 && r2.error ? r2.error : 'Catalogue indisponible'));
    }
    return (r2.data && Array.isArray(r2.data)) ? r2.data : [];
  }
  return (r.data && Array.isArray(r.data)) ? r.data : [];
}

async function fetchSnapshot() {
  const r = await apiFetch('/api/market/snapshot', { method: 'GET' });
  if (r && r.ok && r.data) return r.data;
  const r2 = await apiFetch('/api/market', { method: 'GET' });
  if (r2 && r2.ok && r2.data) return r2.data;
  throw new Error('Snapshot indisponible');
}

async function getQuote(payload) {
  // payload: { itemId, qty, countryId }
  const r = await apiFetch('/api/market/quote', { method: 'POST', body: payload });
  if (r && r.ok) {
    // The API may respond with { ok:true, price, breakdown } or raw { price, breakdown }
    if (r.data && typeof r.data === 'object') {
      if ('ok' in r.data) return r.data;
      return { ok: true, price: r.data.price, breakdown: r.data.breakdown || r.data.breakdown };
    }
    return { ok: true, price: r.data };
  }
  // try alternate path
  const r2 = await apiFetch('/api/market/price', { method: 'POST', body: payload });
  if (r2 && r2.ok) {
    if (r2.data && typeof r2.data === 'object') {
      if ('ok' in r2.data) return r2.data;
      return { ok: true, price: r2.data.price, breakdown: r2.data.breakdown || {} };
    }
    return { ok: true, price: r2.data };
  }
  return { ok: false, error: r && r.error ? r.error : 'Erreur quote' };
}

async function executeTrade(payload) {
  // payload: { actor, countryId, itemId, qty, side }
  const r = await apiFetch('/api/market/trade', { method: 'POST', body: payload });
  if (r && r.ok) {
    // common shapes: { ok:true, tx } or { tx: {...} } or { ok:true, data:{tx:...} }
    const d = r.data;
    if (d && d.ok && d.tx) return { ok: true, tx: d.tx };
    if (d && d.tx) return { ok: true, tx: d.tx };
    if (d && d.ok && d.data && d.data.tx) return { ok: true, tx: d.data.tx };
    // maybe API returns the transaction directly
    if (d && d.id) return { ok: true, tx: d };
    return { ok: true, tx: d };
  }
  // fallback alternate endpoint
  const r2 = await apiFetch('/api/market/execute', { method: 'POST', body: payload });
  if (r2 && r2.ok) {
    const d = r2.data;
    if (d && d.ok && d.tx) return { ok: true, tx: d.tx };
    if (d && d.id) return { ok: true, tx: d };
    return { ok: true, tx: d };
  }
  return { ok: false, error: r && r.error ? r.error : 'Erreur trade' };
}

/* ---------------------------
   UI renderers (strict)
   --------------------------- */
function renderItemList(items) {
  itemListEl.innerHTML = '';
  if (!items || items.length === 0) {
    itemListEl.innerHTML = '<div class="muted">Catalogue vide.</div>';
    return;
  }
  items.forEach(it => {
    const btn = D.createElement('button');
    btn.type = 'button';
    btn.className = 'catalog-item';
    // display: prefer name then id
    btn.textContent = `${(it.name || it.label || it.id)} — ${it.id}`;
    btn.dataset.itemId = it.id;
    btn.addEventListener('click', () => onSelectItem(it));
    itemListEl.appendChild(btn);
  });
}

function renderMarketSnapshot(snapshot) {
  if (!snapshot || !snapshot.state) {
    marketSnapshotEl.innerHTML = '<div class="muted">Aucune donnée de marché.</div>';
    recentTradesEl.innerHTML = '<div class="muted">Aucune transaction récente.</div>';
    return;
  }
  const keys = Object.keys(snapshot.state).slice(0, 6);
  const lines = keys.map(k => {
    const s = snapshot.state[k];
    return `${k}: stock=${s.stock ?? '—'} demand=${s.demand ?? '—'} trend=${(s.trend ?? 0).toFixed ? (s.trend ?? 0).toFixed(3) : (s.trend ?? 0)}`;
  });
  marketSnapshotEl.innerHTML = `<div>${lines.join('<br>')}</div>`;

  recentTradesEl.innerHTML = '';
  const recent = snapshot.recent || snapshot.ledger || [];
  if (!recent || !recent.length) {
    recentTradesEl.innerHTML = '<div class="muted">Aucune transaction récente.</div>';
    return;
  }
  for (const t of recent.slice(-20).reverse()) {
    const el = D.createElement('div');
    el.className = 'trade-item';
    const when = new Date(t.ts || Date.now()).toLocaleString();
    el.innerHTML = `<div><strong>${t.item}</strong> ${t.side} ×${t.qty} • ${t.total_price ?? (t.price_per_unit ? (t.price_per_unit * t.qty) : '—')}</div>
                    <div class="muted mini">${t.actor || '—'} • ${t.country || '—'} • ${when}</div>`;
    recentTradesEl.appendChild(el);
  }
}

/* ---------------------------
   Event handlers
   --------------------------- */
function onSelectItem(item) {
  selectedItemEl.textContent = `${item.name || item.label || item.id} (${item.id})`;
  itemIdInput.value = item.id;
  qtyInput.value = 1;
  countryIdInput.value = '';
  quoteResultEl.textContent = '—';
  breakdownPre.textContent = 'Aucun devis pour l\'instant.';
  tradeControlsEl.classList.add('visually-hidden');
}

/* Search */
searchBtn?.addEventListener('click', async (e) => {
  e.preventDefault();
  const q = (searchInput.value || '').trim().toLowerCase();
  try {
    const items = await fetchCatalog();
    const filtered = items.filter(it => (it.id && it.id.toLowerCase().includes(q)) || ((it.name || it.label) && (it.name || it.label).toLowerCase().includes(q)));
    renderItemList(filtered);
  } catch (err) {
    showToast('Erreur recherche catalogue', 'error');
    console.error(err);
  }
});

viewAllBtn?.addEventListener('click', async () => {
  try {
    const items = await fetchCatalog();
    renderItemList(items);
  } catch (err) {
    showToast('Impossible de charger le catalogue', 'error');
  }
});

/* Quote */
getQuoteBtn?.addEventListener('click', async (e) => {
  e.preventDefault();
  const itemId = (itemIdInput.value || '').trim();
  const qty = Number(qtyInput.value || 1);
  const countryId = (countryIdInput.value || '').trim() || null;
  if (!itemId) { showToast('Choisis un item', 'error'); return; }
  if (!(qty > 0)) { showToast('Quantité invalide', 'error'); return; }

  setLoading(getQuoteBtn, true, 'Calcul...');
  try {
    const out = await getQuote({ itemId, qty, countryId });
    if (!out || out.ok === false) {
      showToast(out && out.error ? out.error : 'Erreur devis', 'error');
      quoteResultEl.textContent = 'Erreur devis';
      return;
    }
    const price = out.price ?? (out.data && out.data.price);
    const breakdown = out.breakdown ?? (out.data && out.data.breakdown) ?? {};
    if (price === undefined || price === null) {
      quoteResultEl.textContent = 'Erreur devis';
      showToast('Réponse devis invalide', 'error');
      return;
    }
    quoteResultEl.textContent = `${price} (par unité) • Total: ${Math.round(price * qty * 100) / 100}`;
    breakdownPre.textContent = JSON.stringify(breakdown, null, 2);
    tradeControlsEl.classList.remove('visually-hidden');
    tradeMsgEl.textContent = '';
  } catch (err) {
    console.error(err);
    showToast('Erreur lors du devis', 'error');
  } finally {
    setLoading(getQuoteBtn, false);
  }
});

/* Trade */
async function doTrade(side) {
  const itemId = (itemIdInput.value || '').trim();
  const qty = Number(qtyInput.value || 1);
  const countryId = (countryIdInput.value || '').trim() || null;
  if (!itemId || !(qty > 0)) { showToast('Paramètres invalides', 'error'); return; }

  const actor = (window.WC && window.WC.session && window.WC.session.username) ? window.WC.session.username : 'web_user';
  setLoading(buyBtn, true, 'En cours...');
  setLoading(sellBtn, true, 'En cours...');
  try {
    const result = await executeTrade({ actor, countryId, itemId, qty, side });
    if (!result || result.ok === false) {
      showToast((result && result.error) || 'Échec de la transaction', 'error');
      tradeMsgEl.textContent = (result && result.error) || 'Échec';
      return;
    }
    const tx = result.tx || (result.data && result.data.tx);
    showToast('Transaction réussie', 'success');
    tradeMsgEl.textContent = `Tx: ${tx && tx.id ? tx.id : '—'} • Total: ${tx && (tx.total_price ?? (tx.price_per_unit ? tx.price_per_unit * tx.qty : null)) ?? '—'}`;
    // refresh snapshot
    await refreshSnapshot();
  } catch (err) {
    console.error(err);
    showToast('Erreur transaction', 'error');
  } finally {
    setLoading(buyBtn, false);
    setLoading(sellBtn, false);
  }
}

buyBtn?.addEventListener('click', () => doTrade('buy'));
sellBtn?.addEventListener('click', () => doTrade('sell'));

refreshBtn?.addEventListener('click', () => refreshAll());

viewLedgerBtn?.addEventListener('click', async () => {
  try {
    const snap = await fetchSnapshot();
    const ledger = snap && (snap.recent || snap.ledger || []) ? (snap.recent || snap.ledger) : [];
    if (!ledger.length) { alert('Ledger vide'); return; }
    const text = ledger.slice(-50).reverse().map(tx => `${tx.id} — ${tx.item} ${tx.side} ×${tx.qty} • ${tx.total_price ?? (tx.price_per_unit ? tx.price_per_unit * tx.qty : '—')}`).join('\n');
    alert(text);
  } catch (err) {
    showToast('Impossible de récupérer le ledger', 'error');
  }
});

// nav buttons (keep behaviour)
D.getElementById('nav-chat')?.addEventListener('click', () => location.href = 'chat.html');
D.getElementById('nav-lobby')?.addEventListener('click', () => location.href = 'dashboard.html');
D.getElementById('nav-profile')?.addEventListener('click', () => location.href = 'profile.html');

/* ---------------------------
   Boot / init
   --------------------------- */
async function refreshSnapshot() {
  try {
    const snap = await fetchSnapshot();
    renderMarketSnapshot(snap);
  } catch (err) {
    marketSnapshotEl.innerHTML = `<div class="muted">Snapshot indisponible</div>`;
    recentTradesEl.innerHTML = `<div class="muted">Transactions indisponibles</div>`;
    console.error(err);
  }
}

async function refreshAll() {
  try {
    const items = await fetchCatalog();
    renderItemList(items);
    await refreshSnapshot();
  } catch (err) {
    console.error(err);
    showToast('Impossible de rafraîchir le marché', 'error');
  }
}

async function init() {
  try {
    const apiOk = await detectApi();
    if (!apiOk) {
      showToast('API du marché indisponible — le marché est désactivé', 'error', 5000);
      disableAllControls('API indisponible');
      return;
    }
    await refreshAll();

    // preselect if ?item=...
    const params = new URLSearchParams(location.search);
    const maybeItem = params.get('item');
    if (maybeItem) {
      const items = await fetchCatalog();
      const found = items.find(it => it.id === maybeItem || (it.name && it.name.toLowerCase().includes(maybeItem.toLowerCase())));
      if (found) onSelectItem(found);
    }
  } catch (e) {
    console.error(e);
    showToast('Erreur initialisation marché', 'error');
    disableAllControls('Erreur initialisation');
  }
}

// start
init();

===== ./chat.html =====

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WorldConflict — Chat</title>

  <link rel="stylesheet" href="variables.css">
  <link rel="stylesheet" href="chat.css">
</head>
<body>
  <div class="app-shell">

    <!-- HEADER -->
    <header class="wc-header minimalist" role="banner">
      <div class="wc-brand">
        <div class="brand-title">WorldConflict</div>
        <div id="headerSub" class="brand-sub muted" aria-live="polite">Chargement…</div>
      </div>

      <div class="header-actions">
        <button id="membersBtn" class="round-btn" title="Voir les membres" aria-expanded="false" aria-controls="membersOverlay" aria-pressed="false">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path d="M16 11a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM8 11a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM2 20c0-2.8 4.5-4 6-4h8c1.5 0 6 1.2 6 4v1H2v-1z" fill="currentColor"/></svg>
        </button>
      </div>
    </header>

    <!-- MAIN GRID -->
    <main class="chat-container" role="main" aria-label="Interface de chat">

      <!-- LEFT: Sidebar -->
      <aside class="sidebar panel" aria-label="Navigation des salons">
        <div class="sidebar-top">
          <div class="sidebar-title">SALONS</div>
          <div class="sidebar-actions">
            <button id="createChannelBtn" class="btn ghost tiny" title="Créer un salon">+</button>
          </div>
        </div>

        <div class="channel-nav-wrap" aria-hidden="false">
          <div class="cat-title">TEXTE</div>
          <ul id="channelNavText" class="channel-nav" aria-label="Salons textuels" role="navigation"></ul>

          <div class="cat-title" style="margin-top:12px">VOCAUX</div>
          <ul id="channelNavVoice" class="channel-nav" aria-label="Salons vocaux" role="navigation"></ul>
        </div>

        <div class="sidebar-search" style="margin-top:8px">
          <label for="channelSearch" class="visually-hidden">Rechercher un salon</label>
          <input id="channelSearch" class="text-input" placeholder="Rechercher" aria-label="Rechercher un salon" autocomplete="off">
        </div>
      </aside>

      <!-- CENTER: Messages -->
      <section class="panel messages-panel" aria-label="Messages du salon">
        <div class="messages-header">
          <div>
            <h2 id="currentChannelName" class="channel-header"># global</h2>
            <div id="currentChannelInfo" class="muted small" aria-live="polite">—</div>
          </div>

          <div class="messages-header-actions">
            <div id="voiceControls" class="voice-controls" aria-hidden="true"></div>
            <button id="leaveChannelBtn" class="btn ghost small" title="Quitter le salon">Quitter</button>
          </div>
        </div>

        <div id="messages" class="messages" role="log" aria-live="polite" aria-relevant="additions">
          <!-- messages injectés par JS -->
        </div>

        <form id="sendForm" class="send-form" autocomplete="off" aria-label="Envoyer un message">
          <label for="msgInput" class="visually-hidden">Message</label>
          <textarea id="msgInput" class="text-input" placeholder="Écris un message — Entrée pour envoyer, Shift+Entrée pour saut de ligne" rows="1" aria-label="Message"></textarea>
          <button id="sendBtn" type="submit" class="btn primary" aria-label="Envoyer le message">Envoyer</button>
        </form>
      </section>

      <!-- RIGHT: Info & members -->
      <aside class="panel right-panel" aria-label="Informations">
        <div class="panel-card">
          <h3>À propos</h3>
          <p id="rightInfo" class="muted">Sélectionne un salon pour voir les détails.</p>
        </div>

        <div class="panel-card members-panel" style="margin-top:12px">
          <h4>Membres</h4>
          <ul id="membersList" class="members muted">—</ul>
        </div>
      </aside>
    </main>

    <!-- MEMBERS OVERLAY -->
    <aside id="membersOverlay" class="members-overlay" role="dialog" aria-hidden="true" aria-label="Liste des membres">
      <header class="overlay-header">
        <h3>Membres</h3>
        <button id="closeMembers" class="icon-btn" aria-label="Fermer">✕</button>
      </header>

      <section class="overlay-body">
        <div class="members-section">
          <h4>Actifs</h4>
          <ul id="overlayActive" class="members-list">—</ul>
        </div>
        <div class="members-section" style="margin-top:10px">
          <h4>Inactifs</h4>
          <ul id="overlayInactive" class="members-list">—</ul>
        </div>
      </section>
    </aside>

    <!-- toast -->
    <div id="wcToast" class="wc-toast" role="status" aria-live="polite"></div>

    <!-- bottom nav -->
    <nav class="bottom-nav" role="navigation" aria-label="Navigation principale">
      <button id="navChat" class="nav-item active" aria-label="Chat">Chat</button>
      <button id="navDashboard" class="nav-item" aria-label="Lobby">Lobby</button>
      <button id="navNotifs" class="nav-item" aria-label="Notifications">Notifications</button>
      <button id="navProfile" class="nav-item" aria-label="Profil">Profil</button>
    </nav>
  </div>

  <script src="utils.js" defer></script>
  <script src="chat.js" defer></script>
</body>
</html>

===== ./testCatalog.js =====

import { reloadCatalog, getMarketItems } from './economy/catalog.js';

(async () => {
  const r = await reloadCatalog();
  console.log(r);
  console.log(getMarketItems());
})();

===== ./package-lock.json =====

{
  "name": "worldconflict",
  "version": "1.0.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "worldconflict",
      "version": "1.0.0",
      "license": "ISC",
      "dependencies": {
        "@capacitor/android": "^7.4.4",
        "body-parser": "^2.2.0",
        "cors": "^2.8.5",
        "express": "^5.2.1",
        "express-session": "^1.18.2"
      }
    },
    "node_modules/@capacitor/android": {
      "version": "7.4.4",
      "resolved": "https://registry.npmjs.org/@capacitor/android/-/android-7.4.4.tgz",
      "integrity": "sha512-y8knfV1JXNrd6XZZLZireGT+EBCN0lvOo+HZ/s7L8LkrPBu4nY5UZn0Wxz4yOezItEII9rqYJSHsS5fMJG9gdw==",
      "license": "MIT",
      "peerDependencies": {
        "@capacitor/core": "^7.4.0"
      }
    },
    "node_modules/@capacitor/core": {
      "version": "7.4.4",
      "resolved": "https://registry.npmjs.org/@capacitor/core/-/core-7.4.4.tgz",
      "integrity": "sha512-xzjxpr+d2zwTpCaN0k+C6wKSZzWFAb9OVEUtmO72ihjr/NEDoLvsGl4WLfjWPcCO2zOy0b2X52tfRWjECFUjtw==",
      "license": "MIT",
      "peer": true,
      "dependencies": {
        "tslib": "^2.1.0"
      }
    },
    "node_modules/accepts": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/accepts/-/accepts-2.0.0.tgz",
      "integrity": "sha512-5cvg6CtKwfgdmVqY1WIiXKc3Q1bkRqGLi+2W/6ao+6Y7gu/RCwRuAhGEzh5B4KlszSuTLgZYuqFqo5bImjNKng==",
      "license": "MIT",
      "dependencies": {
        "mime-types": "^3.0.0",
        "negotiator": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/body-parser": {
      "version": "2.2.1",
      "resolved": "https://registry.npmjs.org/body-parser/-/body-parser-2.2.1.tgz",
      "integrity": "sha512-nfDwkulwiZYQIGwxdy0RUmowMhKcFVcYXUU7m4QlKYim1rUtg83xm2yjZ40QjDuc291AJjjeSc9b++AWHSgSHw==",
      "license": "MIT",
      "dependencies": {
        "bytes": "^3.1.2",
        "content-type": "^1.0.5",
        "debug": "^4.4.3",
        "http-errors": "^2.0.0",
        "iconv-lite": "^0.7.0",
        "on-finished": "^2.4.1",
        "qs": "^6.14.0",
        "raw-body": "^3.0.1",
        "type-is": "^2.0.1"
      },
      "engines": {
        "node": ">=18"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/bytes": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/bytes/-/bytes-3.1.2.tgz",
      "integrity": "sha512-/Nf7TyzTx6S3yRJObOAV7956r8cr2+Oj8AC5dt8wSP3BQAoeX58NoHyCU8P8zGkNXStjTSi6fzO6F0pBdcYbEg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/call-bind-apply-helpers": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/call-bind-apply-helpers/-/call-bind-apply-helpers-1.0.2.tgz",
      "integrity": "sha512-Sp1ablJ0ivDkSzjcaJdxEunN5/XvksFJ2sMBFfq6x0ryhQV/2b/KwFe21cMpmHtPOSij8K99/wSfoEuTObmuMQ==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "function-bind": "^1.1.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/call-bound": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/call-bound/-/call-bound-1.0.4.tgz",
      "integrity": "sha512-+ys997U96po4Kx/ABpBCqhA9EuxJaQWDQg7295H4hBphv3IZg0boBKuwYpt4YXp6MZ5AmZQnU/tyMTlRpaSejg==",
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.2",
        "get-intrinsic": "^1.3.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/content-disposition": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/content-disposition/-/content-disposition-1.0.1.tgz",
      "integrity": "sha512-oIXISMynqSqm241k6kcQ5UwttDILMK4BiurCfGEREw6+X9jkkpEe5T9FZaApyLGGOnFuyMWZpdolTXMtvEJ08Q==",
      "license": "MIT",
      "engines": {
        "node": ">=18"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/content-type": {
      "version": "1.0.5",
      "resolved": "https://registry.npmjs.org/content-type/-/content-type-1.0.5.tgz",
      "integrity": "sha512-nTjqfcBFEipKdXCv4YDQWCfmcLZKm81ldF0pAopTvyrFGVbcR6P/VAAd5G7N+0tTr8QqiU0tFadD6FK4NtJwOA==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/cookie": {
      "version": "0.7.2",
      "resolved": "https://registry.npmjs.org/cookie/-/cookie-0.7.2.tgz",
      "integrity": "sha512-yki5XnKuf750l50uGTllt6kKILY4nQ1eNIQatoXEByZ5dWgnKqbnqmTrBE5B4N7lrMJKQ2ytWMiTO2o0v6Ew/w==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/cookie-signature": {
      "version": "1.2.2",
      "resolved": "https://registry.npmjs.org/cookie-signature/-/cookie-signature-1.2.2.tgz",
      "integrity": "sha512-D76uU73ulSXrD1UXF4KE2TMxVVwhsnCgfAyTg9k8P6KGZjlXKrOLe4dJQKI3Bxi5wjesZoFXJWElNWBjPZMbhg==",
      "license": "MIT",
      "engines": {
        "node": ">=6.6.0"
      }
    },
    "node_modules/cors": {
      "version": "2.8.5",
      "resolved": "https://registry.npmjs.org/cors/-/cors-2.8.5.tgz",
      "integrity": "sha512-KIHbLJqu73RGr/hnbrO9uBeixNGuvSQjul/jdFvS/KFSIH1hWVd1ng7zOHx+YrEfInLG7q4n6GHQ9cDtxv/P6g==",
      "license": "MIT",
      "dependencies": {
        "object-assign": "^4",
        "vary": "^1"
      },
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/debug": {
      "version": "4.4.3",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.4.3.tgz",
      "integrity": "sha512-RGwwWnwQvkVfavKVt22FGLw+xYSdzARwm0ru6DhTVA3umU5hZc28V3kO4stgYryrTlLpuvgI9GiijltAjNbcqA==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/depd": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/depd/-/depd-2.0.0.tgz",
      "integrity": "sha512-g7nH6P6dyDioJogAAGprGpCtVImJhpPk/roCzdb3fIh61/s/nPsfR6onyMwkCAR/OlC3yBC0lESvUoQEAssIrw==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/dunder-proto": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/dunder-proto/-/dunder-proto-1.0.1.tgz",
      "integrity": "sha512-KIN/nDJBQRcXw0MLVhZE9iQHmG68qAVIBg9CqmUYjmQIhgij9U5MFvrqkUL5FbtyyzZuOeOt0zdeRe4UY7ct+A==",
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.1",
        "es-errors": "^1.3.0",
        "gopd": "^1.2.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/ee-first": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/ee-first/-/ee-first-1.1.1.tgz",
      "integrity": "sha512-WMwm9LhRUo+WUaRN+vRuETqG89IgZphVSNkdFgeb6sS/E4OrDIN7t48CAewSHXc6C8lefD8KKfr5vY61brQlow==",
      "license": "MIT"
    },
    "node_modules/encodeurl": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/encodeurl/-/encodeurl-2.0.0.tgz",
      "integrity": "sha512-Q0n9HRi4m6JuGIV1eFlmvJB7ZEVxu93IrMyiMsGC0lrMJMWzRgx6WGquyfQgZVb31vhGgXnfmPNNXmxnOkRBrg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/es-define-property": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/es-define-property/-/es-define-property-1.0.1.tgz",
      "integrity": "sha512-e3nRfgfUZ4rNGL232gUgX06QNyyez04KdjFrF+LTRoOXmrOgFKDg4BCdsjW8EnT69eqdYGmRpJwiPVYNrCaW3g==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-errors": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/es-errors/-/es-errors-1.3.0.tgz",
      "integrity": "sha512-Zf5H2Kxt2xjTvbJvP2ZWLEICxA6j+hAmMzIlypy4xcBg1vKVnx89Wy0GbS+kf5cwCVFFzdCFh2XSCFNULS6csw==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-object-atoms": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/es-object-atoms/-/es-object-atoms-1.1.1.tgz",
      "integrity": "sha512-FGgH2h8zKNim9ljj7dankFPcICIK9Cp5bm+c2gQSYePhpaG5+esrLODihIorn+Pe6FGJzWhXQotPv73jTaldXA==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/escape-html": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/escape-html/-/escape-html-1.0.3.tgz",
      "integrity": "sha512-NiSupZ4OeuGwr68lGIeym/ksIZMJodUGOSCZ/FSnTxcrekbvqrgdUxlJOMpijaKZVjAJrWrGs/6Jy8OMuyj9ow==",
      "license": "MIT"
    },
    "node_modules/etag": {
      "version": "1.8.1",
      "resolved": "https://registry.npmjs.org/etag/-/etag-1.8.1.tgz",
      "integrity": "sha512-aIL5Fx7mawVa300al2BnEE4iNvo1qETxLrPI/o05L7z6go7fCw1J6EQmbK4FmJ2AS7kgVF/KEZWufBfdClMcPg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/express": {
      "version": "5.2.1",
      "resolved": "https://registry.npmjs.org/express/-/express-5.2.1.tgz",
      "integrity": "sha512-hIS4idWWai69NezIdRt2xFVofaF4j+6INOpJlVOLDO8zXGpUVEVzIYk12UUi2JzjEzWL3IOAxcTubgz9Po0yXw==",
      "license": "MIT",
      "dependencies": {
        "accepts": "^2.0.0",
        "body-parser": "^2.2.1",
        "content-disposition": "^1.0.0",
        "content-type": "^1.0.5",
        "cookie": "^0.7.1",
        "cookie-signature": "^1.2.1",
        "debug": "^4.4.0",
        "depd": "^2.0.0",
        "encodeurl": "^2.0.0",
        "escape-html": "^1.0.3",
        "etag": "^1.8.1",
        "finalhandler": "^2.1.0",
        "fresh": "^2.0.0",
        "http-errors": "^2.0.0",
        "merge-descriptors": "^2.0.0",
        "mime-types": "^3.0.0",
        "on-finished": "^2.4.1",
        "once": "^1.4.0",
        "parseurl": "^1.3.3",
        "proxy-addr": "^2.0.7",
        "qs": "^6.14.0",
        "range-parser": "^1.2.1",
        "router": "^2.2.0",
        "send": "^1.1.0",
        "serve-static": "^2.2.0",
        "statuses": "^2.0.1",
        "type-is": "^2.0.1",
        "vary": "^1.1.2"
      },
      "engines": {
        "node": ">= 18"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/express-session": {
      "version": "1.18.2",
      "resolved": "https://registry.npmjs.org/express-session/-/express-session-1.18.2.tgz",
      "integrity": "sha512-SZjssGQC7TzTs9rpPDuUrR23GNZ9+2+IkA/+IJWmvQilTr5OSliEHGF+D9scbIpdC6yGtTI0/VhaHoVes2AN/A==",
      "license": "MIT",
      "dependencies": {
        "cookie": "0.7.2",
        "cookie-signature": "1.0.7",
        "debug": "2.6.9",
        "depd": "~2.0.0",
        "on-headers": "~1.1.0",
        "parseurl": "~1.3.3",
        "safe-buffer": "5.2.1",
        "uid-safe": "~2.1.5"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/express-session/node_modules/cookie-signature": {
      "version": "1.0.7",
      "resolved": "https://registry.npmjs.org/cookie-signature/-/cookie-signature-1.0.7.tgz",
      "integrity": "sha512-NXdYc3dLr47pBkpUCHtKSwIOQXLVn8dZEuywboCOJY/osA0wFSLlSawr3KN8qXJEyX66FcONTH8EIlVuK0yyFA==",
      "license": "MIT"
    },
    "node_modules/express-session/node_modules/debug": {
      "version": "2.6.9",
      "resolved": "https://registry.npmjs.org/debug/-/debug-2.6.9.tgz",
      "integrity": "sha512-bC7ElrdJaJnPbAP+1EotYvqZsb3ecl5wi6Bfi6BJTUcNowp6cvspg0jXznRTKDjm/E7AdgFBVeAPVMNcKGsHMA==",
      "license": "MIT",
      "dependencies": {
        "ms": "2.0.0"
      }
    },
    "node_modules/express-session/node_modules/ms": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/ms/-/ms-2.0.0.tgz",
      "integrity": "sha512-Tpp60P6IUJDTuOq/5Z8cdskzJujfwqfOTkrwIwj7IRISpnkJnT6SyJ4PCPnGMoFjC9ddhal5KVIYtAt97ix05A==",
      "license": "MIT"
    },
    "node_modules/finalhandler": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/finalhandler/-/finalhandler-2.1.0.tgz",
      "integrity": "sha512-/t88Ty3d5JWQbWYgaOGCCYfXRwV1+be02WqYYlL6h0lEiUAMPM8o8qKGO01YIkOHzka2up08wvgYD0mDiI+q3Q==",
      "license": "MIT",
      "dependencies": {
        "debug": "^4.4.0",
        "encodeurl": "^2.0.0",
        "escape-html": "^1.0.3",
        "on-finished": "^2.4.1",
        "parseurl": "^1.3.3",
        "statuses": "^2.0.1"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/forwarded": {
      "version": "0.2.0",
      "resolved": "https://registry.npmjs.org/forwarded/-/forwarded-0.2.0.tgz",
      "integrity": "sha512-buRG0fpBtRHSTCOASe6hD258tEubFoRLb4ZNA6NxMVHNw2gOcwHo9wyablzMzOA5z9xA9L1KNjk/Nt6MT9aYow==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/fresh": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/fresh/-/fresh-2.0.0.tgz",
      "integrity": "sha512-Rx/WycZ60HOaqLKAi6cHRKKI7zxWbJ31MhntmtwMoaTeF7XFH9hhBp8vITaMidfljRQ6eYWCKkaTK+ykVJHP2A==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/function-bind": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/function-bind/-/function-bind-1.1.2.tgz",
      "integrity": "sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==",
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-intrinsic": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/get-intrinsic/-/get-intrinsic-1.3.0.tgz",
      "integrity": "sha512-9fSjSaos/fRIVIp+xSJlE6lfwhES7LNtKaCBIamHsjr2na1BiABJPo0mOjjz8GJDURarmCPGqaiVg5mfjb98CQ==",
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.2",
        "es-define-property": "^1.0.1",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.1.1",
        "function-bind": "^1.1.2",
        "get-proto": "^1.0.1",
        "gopd": "^1.2.0",
        "has-symbols": "^1.1.0",
        "hasown": "^2.0.2",
        "math-intrinsics": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-proto": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/get-proto/-/get-proto-1.0.1.tgz",
      "integrity": "sha512-sTSfBjoXBp89JvIKIefqw7U2CCebsc74kiY6awiGogKtoSGbgjYE/G/+l9sF3MWFPNc9IcoOC4ODfKHfxFmp0g==",
      "license": "MIT",
      "dependencies": {
        "dunder-proto": "^1.0.1",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/gopd": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/gopd/-/gopd-1.2.0.tgz",
      "integrity": "sha512-ZUKRh6/kUFoAiTAtTYPZJ3hw9wNxx+BIBOijnlG9PnrJsCcSjs1wyyD6vJpaYtgnzDrKYRSqf3OO6Rfa93xsRg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/has-symbols": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/has-symbols/-/has-symbols-1.1.0.tgz",
      "integrity": "sha512-1cDNdwJ2Jaohmb3sg4OmKaMBwuC48sYni5HUw2DvsC8LjGTLK9h+eb1X6RyuOHe4hT0ULCW68iomhjUoKUqlPQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/hasown": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/hasown/-/hasown-2.0.2.tgz",
      "integrity": "sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==",
      "license": "MIT",
      "dependencies": {
        "function-bind": "^1.1.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/http-errors": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/http-errors/-/http-errors-2.0.1.tgz",
      "integrity": "sha512-4FbRdAX+bSdmo4AUFuS0WNiPz8NgFt+r8ThgNWmlrjQjt1Q7ZR9+zTlce2859x4KSXrwIsaeTqDoKQmtP8pLmQ==",
      "license": "MIT",
      "dependencies": {
        "depd": "~2.0.0",
        "inherits": "~2.0.4",
        "setprototypeof": "~1.2.0",
        "statuses": "~2.0.2",
        "toidentifier": "~1.0.1"
      },
      "engines": {
        "node": ">= 0.8"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/iconv-lite": {
      "version": "0.7.1",
      "resolved": "https://registry.npmjs.org/iconv-lite/-/iconv-lite-0.7.1.tgz",
      "integrity": "sha512-2Tth85cXwGFHfvRgZWszZSvdo+0Xsqmw8k8ZwxScfcBneNUraK+dxRxRm24nszx80Y0TVio8kKLt5sLE7ZCLlw==",
      "license": "MIT",
      "dependencies": {
        "safer-buffer": ">= 2.1.2 < 3.0.0"
      },
      "engines": {
        "node": ">=0.10.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/inherits": {
      "version": "2.0.4",
      "resolved": "https://registry.npmjs.org/inherits/-/inherits-2.0.4.tgz",
      "integrity": "sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==",
      "license": "ISC"
    },
    "node_modules/ipaddr.js": {
      "version": "1.9.1",
      "resolved": "https://registry.npmjs.org/ipaddr.js/-/ipaddr.js-1.9.1.tgz",
      "integrity": "sha512-0KI/607xoxSToH7GjN1FfSbLoU0+btTicjsQSWQlh/hZykN8KpmMf7uYwPW3R+akZ6R/w18ZlXSHBYXiYUPO3g==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/is-promise": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/is-promise/-/is-promise-4.0.0.tgz",
      "integrity": "sha512-hvpoI6korhJMnej285dSg6nu1+e6uxs7zG3BYAm5byqDsgJNWwxzM6z6iZiAgQR4TJ30JmBTOwqZUw3WlyH3AQ==",
      "license": "MIT"
    },
    "node_modules/math-intrinsics": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/math-intrinsics/-/math-intrinsics-1.1.0.tgz",
      "integrity": "sha512-/IXtbwEk5HTPyEwyKX6hGkYXxM9nbj64B+ilVJnC/R6B0pH5G4V3b0pVbL7DBj4tkhBAppbQUlf6F6Xl9LHu1g==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/media-typer": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/media-typer/-/media-typer-1.1.0.tgz",
      "integrity": "sha512-aisnrDP4GNe06UcKFnV5bfMNPBUw4jsLGaWwWfnH3v02GnBuXX2MCVn5RbrWo0j3pczUilYblq7fQ7Nw2t5XKw==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/merge-descriptors": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/merge-descriptors/-/merge-descriptors-2.0.0.tgz",
      "integrity": "sha512-Snk314V5ayFLhp3fkUREub6WtjBfPdCPY1Ln8/8munuLuiYhsABgBVWsozAG+MWMbVEvcdcpbi9R7ww22l9Q3g==",
      "license": "MIT",
      "engines": {
        "node": ">=18"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/mime-db": {
      "version": "1.54.0",
      "resolved": "https://registry.npmjs.org/mime-db/-/mime-db-1.54.0.tgz",
      "integrity": "sha512-aU5EJuIN2WDemCcAp2vFBfp/m4EAhWJnUNSSw0ixs7/kXbd6Pg64EmwJkNdFhB8aWt1sH2CTXrLxo/iAGV3oPQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/mime-types": {
      "version": "3.0.2",
      "resolved": "https://registry.npmjs.org/mime-types/-/mime-types-3.0.2.tgz",
      "integrity": "sha512-Lbgzdk0h4juoQ9fCKXW4by0UJqj+nOOrI9MJ1sSj4nI8aI2eo1qmvQEie4VD1glsS250n15LsWsYtCugiStS5A==",
      "license": "MIT",
      "dependencies": {
        "mime-db": "^1.54.0"
      },
      "engines": {
        "node": ">=18"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/ms": {
      "version": "2.1.3",
      "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",
      "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",
      "license": "MIT"
    },
    "node_modules/negotiator": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/negotiator/-/negotiator-1.0.0.tgz",
      "integrity": "sha512-8Ofs/AUQh8MaEcrlq5xOX0CQ9ypTF5dl78mjlMNfOK08fzpgTHQRQPBxcPlEtIw0yRpws+Zo/3r+5WRby7u3Gg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/object-assign": {
      "version": "4.1.1",
      "resolved": "https://registry.npmjs.org/object-assign/-/object-assign-4.1.1.tgz",
      "integrity": "sha512-rJgTQnkUnH1sFw8yT6VSU3zD3sWmu6sZhIseY8VX+GRu3P6F7Fu+JNDoXfklElbLJSnc3FUQHVe4cU5hj+BcUg==",
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/object-inspect": {
      "version": "1.13.4",
      "resolved": "https://registry.npmjs.org/object-inspect/-/object-inspect-1.13.4.tgz",
      "integrity": "sha512-W67iLl4J2EXEGTbfeHCffrjDfitvLANg0UlX3wFUUSTx92KXRFegMHUVgSqE+wvhAbi4WqjGg9czysTV2Epbew==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/on-finished": {
      "version": "2.4.1",
      "resolved": "https://registry.npmjs.org/on-finished/-/on-finished-2.4.1.tgz",
      "integrity": "sha512-oVlzkg3ENAhCk2zdv7IJwd/QUD4z2RxRwpkcGY8psCVcCYZNq4wYnVWALHM+brtuJjePWiYF/ClmuDr8Ch5+kg==",
      "license": "MIT",
      "dependencies": {
        "ee-first": "1.1.1"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/on-headers": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/on-headers/-/on-headers-1.1.0.tgz",
      "integrity": "sha512-737ZY3yNnXy37FHkQxPzt4UZ2UWPWiCZWLvFZ4fu5cueciegX0zGPnrlY6bwRg4FdQOe9YU8MkmJwGhoMybl8A==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/once": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/once/-/once-1.4.0.tgz",
      "integrity": "sha512-lNaJgI+2Q5URQBkccEKHTQOPaXdUxnZZElQTZY0MFUAuaEqe1E+Nyvgdz/aIyNi6Z9MzO5dv1H8n58/GELp3+w==",
      "license": "ISC",
      "dependencies": {
        "wrappy": "1"
      }
    },
    "node_modules/parseurl": {
      "version": "1.3.3",
      "resolved": "https://registry.npmjs.org/parseurl/-/parseurl-1.3.3.tgz",
      "integrity": "sha512-CiyeOxFT/JZyN5m0z9PfXw4SCBJ6Sygz1Dpl0wqjlhDEGGBP1GnsUVEL0p63hoG1fcj3fHynXi9NYO4nWOL+qQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/path-to-regexp": {
      "version": "8.3.0",
      "resolved": "https://registry.npmjs.org/path-to-regexp/-/path-to-regexp-8.3.0.tgz",
      "integrity": "sha512-7jdwVIRtsP8MYpdXSwOS0YdD0Du+qOoF/AEPIt88PcCFrZCzx41oxku1jD88hZBwbNUIEfpqvuhjFaMAqMTWnA==",
      "license": "MIT",
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/proxy-addr": {
      "version": "2.0.7",
      "resolved": "https://registry.npmjs.org/proxy-addr/-/proxy-addr-2.0.7.tgz",
      "integrity": "sha512-llQsMLSUDUPT44jdrU/O37qlnifitDP+ZwrmmZcoSKyLKvtZxpyV0n2/bD/N4tBAAZ/gJEdZU7KMraoK1+XYAg==",
      "license": "MIT",
      "dependencies": {
        "forwarded": "0.2.0",
        "ipaddr.js": "1.9.1"
      },
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/qs": {
      "version": "6.14.0",
      "resolved": "https://registry.npmjs.org/qs/-/qs-6.14.0.tgz",
      "integrity": "sha512-YWWTjgABSKcvs/nWBi9PycY/JiPJqOD4JA6o9Sej2AtvSGarXxKC3OQSk4pAarbdQlKAh5D4FCQkJNkW+GAn3w==",
      "license": "BSD-3-Clause",
      "dependencies": {
        "side-channel": "^1.1.0"
      },
      "engines": {
        "node": ">=0.6"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/random-bytes": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/random-bytes/-/random-bytes-1.0.0.tgz",
      "integrity": "sha512-iv7LhNVO047HzYR3InF6pUcUsPQiHTM1Qal51DcGSuZFBil1aBBWG5eHPNek7bvILMaYJ/8RU1e8w1AMdHmLQQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/range-parser": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/range-parser/-/range-parser-1.2.1.tgz",
      "integrity": "sha512-Hrgsx+orqoygnmhFbKaHE6c296J+HTAQXoxEF6gNupROmmGJRoyzfG3ccAveqCBrwr/2yxQ5BVd/GTl5agOwSg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/raw-body": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/raw-body/-/raw-body-3.0.1.tgz",
      "integrity": "sha512-9G8cA+tuMS75+6G/TzW8OtLzmBDMo8p1JRxN5AZ+LAp8uxGA8V8GZm4GQ4/N5QNQEnLmg6SS7wyuSmbKepiKqA==",
      "license": "MIT",
      "dependencies": {
        "bytes": "3.1.2",
        "http-errors": "2.0.0",
        "iconv-lite": "0.7.0",
        "unpipe": "1.0.0"
      },
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/raw-body/node_modules/http-errors": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/http-errors/-/http-errors-2.0.0.tgz",
      "integrity": "sha512-FtwrG/euBzaEjYeRqOgly7G0qviiXoJWnvEH2Z1plBdXgbyjv34pHTSb9zoeHMyDy33+DWy5Wt9Wo+TURtOYSQ==",
      "license": "MIT",
      "dependencies": {
        "depd": "2.0.0",
        "inherits": "2.0.4",
        "setprototypeof": "1.2.0",
        "statuses": "2.0.1",
        "toidentifier": "1.0.1"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/raw-body/node_modules/iconv-lite": {
      "version": "0.7.0",
      "resolved": "https://registry.npmjs.org/iconv-lite/-/iconv-lite-0.7.0.tgz",
      "integrity": "sha512-cf6L2Ds3h57VVmkZe+Pn+5APsT7FpqJtEhhieDCvrE2MK5Qk9MyffgQyuxQTm6BChfeZNtcOLHp9IcWRVcIcBQ==",
      "license": "MIT",
      "dependencies": {
        "safer-buffer": ">= 2.1.2 < 3.0.0"
      },
      "engines": {
        "node": ">=0.10.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/raw-body/node_modules/statuses": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/statuses/-/statuses-2.0.1.tgz",
      "integrity": "sha512-RwNA9Z/7PrK06rYLIzFMlaF+l73iwpzsqRIFgbMLbTcLD6cOao82TaWefPXQvB2fOC4AjuYSEndS7N/mTCbkdQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/router": {
      "version": "2.2.0",
      "resolved": "https://registry.npmjs.org/router/-/router-2.2.0.tgz",
      "integrity": "sha512-nLTrUKm2UyiL7rlhapu/Zl45FwNgkZGaCpZbIHajDYgwlJCOzLSk+cIPAnsEqV955GjILJnKbdQC1nVPz+gAYQ==",
      "license": "MIT",
      "dependencies": {
        "debug": "^4.4.0",
        "depd": "^2.0.0",
        "is-promise": "^4.0.0",
        "parseurl": "^1.3.3",
        "path-to-regexp": "^8.0.0"
      },
      "engines": {
        "node": ">= 18"
      }
    },
    "node_modules/safe-buffer": {
      "version": "5.2.1",
      "resolved": "https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.2.1.tgz",
      "integrity": "sha512-rp3So07KcdmmKbGvgaNxQSJr7bGVSVk5S9Eq1F+ppbRo70+YeaDxkw5Dd8NPN+GD6bjnYm2VuPuCXmpuYvmCXQ==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT"
    },
    "node_modules/safer-buffer": {
      "version": "2.1.2",
      "resolved": "https://registry.npmjs.org/safer-buffer/-/safer-buffer-2.1.2.tgz",
      "integrity": "sha512-YZo3K82SD7Riyi0E1EQPojLz7kpepnSQI9IyPbHHg1XXXevb5dJI7tpyN2ADxGcQbHG7vcyRHk0cbwqcQriUtg==",
      "license": "MIT"
    },
    "node_modules/send": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/send/-/send-1.2.0.tgz",
      "integrity": "sha512-uaW0WwXKpL9blXE2o0bRhoL2EGXIrZxQ2ZQ4mgcfoBxdFmQold+qWsD2jLrfZ0trjKL6vOw0j//eAwcALFjKSw==",
      "license": "MIT",
      "dependencies": {
        "debug": "^4.3.5",
        "encodeurl": "^2.0.0",
        "escape-html": "^1.0.3",
        "etag": "^1.8.1",
        "fresh": "^2.0.0",
        "http-errors": "^2.0.0",
        "mime-types": "^3.0.1",
        "ms": "^2.1.3",
        "on-finished": "^2.4.1",
        "range-parser": "^1.2.1",
        "statuses": "^2.0.1"
      },
      "engines": {
        "node": ">= 18"
      }
    },
    "node_modules/serve-static": {
      "version": "2.2.0",
      "resolved": "https://registry.npmjs.org/serve-static/-/serve-static-2.2.0.tgz",
      "integrity": "sha512-61g9pCh0Vnh7IutZjtLGGpTA355+OPn2TyDv/6ivP2h/AdAVX9azsoxmg2/M6nZeQZNYBEwIcsne1mJd9oQItQ==",
      "license": "MIT",
      "dependencies": {
        "encodeurl": "^2.0.0",
        "escape-html": "^1.0.3",
        "parseurl": "^1.3.3",
        "send": "^1.2.0"
      },
      "engines": {
        "node": ">= 18"
      }
    },
    "node_modules/setprototypeof": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/setprototypeof/-/setprototypeof-1.2.0.tgz",
      "integrity": "sha512-E5LDX7Wrp85Kil5bhZv46j8jOeboKq5JMmYM3gVGdGH8xFpPWXUMsNrlODCrkoxMEeNi/XZIwuRvY4XNwYMJpw==",
      "license": "ISC"
    },
    "node_modules/side-channel": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/side-channel/-/side-channel-1.1.0.tgz",
      "integrity": "sha512-ZX99e6tRweoUXqR+VBrslhda51Nh5MTQwou5tnUDgbtyM0dBgmhEDtWGP/xbKn6hqfPRHujUNwz5fy/wbbhnpw==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "object-inspect": "^1.13.3",
        "side-channel-list": "^1.0.0",
        "side-channel-map": "^1.0.1",
        "side-channel-weakmap": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-list": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/side-channel-list/-/side-channel-list-1.0.0.tgz",
      "integrity": "sha512-FCLHtRD/gnpCiCHEiJLOwdmFP+wzCmDEkc9y7NsYxeF4u7Btsn1ZuwgwJGxImImHicJArLP4R0yX4c2KCrMrTA==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "object-inspect": "^1.13.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-map": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/side-channel-map/-/side-channel-map-1.0.1.tgz",
      "integrity": "sha512-VCjCNfgMsby3tTdo02nbjtM/ewra6jPHmpThenkTYh8pG9ucZ/1P8So4u4FGBek/BjpOVsDCMoLA/iuBKIFXRA==",
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.5",
        "object-inspect": "^1.13.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-weakmap": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/side-channel-weakmap/-/side-channel-weakmap-1.0.2.tgz",
      "integrity": "sha512-WPS/HvHQTYnHisLo9McqBHOJk2FkHO/tlpvldyrnem4aeQp4hai3gythswg6p01oSoTl58rcpiFAjF2br2Ak2A==",
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.5",
        "object-inspect": "^1.13.3",
        "side-channel-map": "^1.0.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/statuses": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/statuses/-/statuses-2.0.2.tgz",
      "integrity": "sha512-DvEy55V3DB7uknRo+4iOGT5fP1slR8wQohVdknigZPMpMstaKJQWhwiYBACJE3Ul2pTnATihhBYnRhZQHGBiRw==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/toidentifier": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/toidentifier/-/toidentifier-1.0.1.tgz",
      "integrity": "sha512-o5sSPKEkg/DIQNmH43V0/uerLrpzVedkUh8tGNvaeXpfpuwjKenlSox/2O/BTlZUtEe+JG7s5YhEz608PlAHRA==",
      "license": "MIT",
      "engines": {
        "node": ">=0.6"
      }
    },
    "node_modules/tslib": {
      "version": "2.8.1",
      "resolved": "https://registry.npmjs.org/tslib/-/tslib-2.8.1.tgz",
      "integrity": "sha512-oJFu94HQb+KVduSUQL7wnpmqnfmLsOA/nAh6b6EH0wCEoK0/mPeXU6c3wKDV83MkOuHPRHtSXKKU99IBazS/2w==",
      "license": "0BSD"
    },
    "node_modules/type-is": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/type-is/-/type-is-2.0.1.tgz",
      "integrity": "sha512-OZs6gsjF4vMp32qrCbiVSkrFmXtG/AZhY3t0iAMrMBiAZyV9oALtXO8hsrHbMXF9x6L3grlFuwW2oAz7cav+Gw==",
      "license": "MIT",
      "dependencies": {
        "content-type": "^1.0.5",
        "media-typer": "^1.1.0",
        "mime-types": "^3.0.0"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/uid-safe": {
      "version": "2.1.5",
      "resolved": "https://registry.npmjs.org/uid-safe/-/uid-safe-2.1.5.tgz",
      "integrity": "sha512-KPHm4VL5dDXKz01UuEd88Df+KzynaohSL9fBh096KWAxSKZQDI2uBrVqtvRM4rwrIrRRKsdLNML/lnaaVSRioA==",
      "license": "MIT",
      "dependencies": {
        "random-bytes": "~1.0.0"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/unpipe": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/unpipe/-/unpipe-1.0.0.tgz",
      "integrity": "sha512-pjy2bYhSsufwWlKwPc+l3cN7+wuJlK6uz0YdJEOlQDbl6jo/YlPi4mb8agUkVC8BF7V8NuzeyPNqRksA3hztKQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/vary": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/vary/-/vary-1.1.2.tgz",
      "integrity": "sha512-BNGbWLfd0eUPabhkXUVm0j8uuvREyTh5ovRa/dyow/BqAbZJyC+5fU+IzQOzmAKzYqYRAISoRhdQr3eIZ/PXqg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/wrappy": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/wrappy/-/wrappy-1.0.2.tgz",
      "integrity": "sha512-l4Sp/DRseor9wL6EvV2+TuQn63dMkPjZ/sp9XkghTEbV9KlPS1xUsZ3u7/IQO4wxtcFB4bgpQPRcR3QCvezPcQ==",
      "license": "ISC"
    }
  }
}

===== ./dashboard.html =====

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WorldConflict — Lobby</title>

  <link rel="stylesheet" href="variables.css">
  <link rel="stylesheet" href="dashboard.css">
</head>
<body>
  <div class="app-shell">

    <!-- Header -->
    <header class="dc-header">
      <button id="menuBtnLeft" class="icon-btn" aria-label="Essentiels (menu)"><span class="burger"></span></button>

      <div class="dc-title">
        <span class="brand-logo" aria-hidden="true">🌐</span>
        <h1>WorldConflict</h1>
        <p class="muted small">Lobby principal</p>
      </div>

      <button id="menuBtnRight" class="icon-btn" aria-label="Actions (menu)"><span class="dotdot"></span></button>
    </header>

    <!-- Left panel (info essentials) -->
    <aside id="leftPanel" class="side-panel left" aria-hidden="true">
      <div class="panel-header">
        <h3>Essentiels</h3>
        <button class="close-panel" data-target="leftPanel" aria-label="Fermer">✕</button>
      </div>
      <nav class="panel-nav">
        <button data-action="open-map">Carte mondiale</button>
        <button data-action="recent-wars">Guerres récentes</button>
        <button data-action="rules">Règlement</button>
        <button data-action="server-status">État du serveur</button>
      </nav>
      <div class="panel-foot muted" id="leftPanelFoot">Chargement...</div>
    </aside>

    <!-- Right panel (role actions) -->
    <aside id="rightPanel" class="side-panel right" aria-hidden="true">
      <div class="panel-header">
        <h3>Actions</h3>
        <button class="close-panel" data-target="rightPanel" aria-label="Fermer">✕</button>
      </div>

      <div id="actionsList" class="actions-list">
        <!-- populated by JS -->
      </div>

      <div class="panel-foot">
        <button id="logoutBtn" class="btn ghost full">Se déconnecter</button>
      </div>
    </aside>

    <!-- Main content / Lobby -->
    <main id="mainArea" class="dc-main">
      <section class="hero-card">
        <div class="hero-left">
          <h2 id="welcome">Vérification de la session…</h2>
          <p id="subtitle" class="muted">Préparation du lobby...</p>

          <div id="quickInfo" class="quick-info">
            <!-- small cards -->
            <div class="qi-card">
              <div class="qi-title">Rôle</div>
              <div id="qiRole" class="qi-value">—</div>
            </div>
            <div class="qi-card">
              <div class="qi-title">Pays</div>
              <div id="qiCountry" class="qi-value">—</div>
            </div>
            <div class="qi-card">
              <div class="qi-title">Membres dans le pays</div>
              <div id="qiMembers" class="qi-value">—</div>
            </div>
          </div>
        </div>

        <div class="hero-right" id="heroRight">
          <!-- placeholder / quick actions -->
          <div class="card surface">
            <h4>Accès rapide</h4>
            <div class="quick-actions">
              <button data-action="chat" class="btn ghost full">Aller au tchat</button>
              <button data-action="notifications" class="btn ghost full">Notifications</button>
              <button data-action="profile" class="btn ghost full">Profil</button>
            </div>
          </div>
        </div>
      </section>

      <!-- dynamic zone for logs / news -->
      <section id="feed" class="card feed">
        <h3>Fil RP</h3>
        <div id="feedList" class="feed-list muted">Aucun événement pour l'instant.</div>
      </section>
    </main>

    <!-- Bottom navigation -->
    <nav class="bottom-nav" role="navigation" aria-label="Navigation principale">
      <button class="nav-btn" data-to="chat.html" title="Tchat">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M4 4h16v10H7l-3 3z"/></svg>
        <span>Chat</span>
      </button>

      <button class="nav-btn active" data-to="dashboard.html" title="Lobby">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 2L2 7v13h20V7z"/></svg>
        <span>Lobby</span>
      </button>

      <button class="nav-btn" data-to="notifications.html" title="Notifications">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 22a2 2 0 0 0 2-2H10a2 2 0 0 0 2 2zM18 16v-5a6 6 0 1 0-12 0v5l-2 2v1h16v-1z"/></svg>
        <span>Notifs</span>
      </button>

      <button class="nav-btn" data-to="profile.html" title="Profil">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm0 2c-5 0-9 3-9 6v2h18v-2c0-3-4-6-9-6z"/></svg>
        <span>Profil</span>
      </button>
    </nav>
  </div>

  <script src="dashboard.js" defer></script>
</body>
</html>

===== ./choose-role.html =====

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WorldConflict — Choisir un rôle</title>
  <link rel="stylesheet" href="variables.css">
  <link rel="stylesheet" href="join-rp.css">
</head>
<body>
  <main class="wrap container">
    <section class="card join-card" aria-labelledby="chooseTitle">
      <header class="card-header">
        <div>
          <h1 id="chooseTitle">Choisir ton rôle</h1>
          <p class="muted sub">Tu n'es pas le premier membre pour ce pays — choisis si tu veux être Ministre ou Citoyen.</p>
        </div>
      </header>

      <form id="chooseRoleForm" class="form" novalidate>
        <div class="row">
          <label class="label">Rôle souhaité</label>
          <div style="display:flex;gap:12px;flex-wrap:wrap">
            <label style="display:flex;flex-direction:column;gap:6px;cursor:pointer">
              <input type="radio" name="role" value="minister" /> <strong>Ministre</strong>
              <span class="muted">Accès aux fonctions officielles (sous réserve).</span>
            </label>
            <label style="display:flex;flex-direction:column;gap:6px;cursor:pointer">
              <input type="radio" name="role" value="citizen" /> <strong>Citoyen</strong>
              <span class="muted">Participation normale. Tu choisiras ensuite un job.</span>
            </label>
          </div>
        </div>

        <div id="citizenJobRow" class="row hidden">
          <label for="jobSelect" class="label">Choisis un job (si citoyen)</label>
          <select id="jobSelect" class="select">
            <option value="">-- Choisir un job --</option>
            <option value="teacher">Enseignant</option>
            <option value="doctor">Médecin</option>
            <option value="engineer">Ingénieur</option>
            <option value="farmer">Agriculteur</option>
            <option value="journalist">Journaliste</option>
            <option value="trader">Commerçant</option>
            <option value="none">Aucun / Libre</option>
          </select>
        </div>

        <div class="form-actions">
          <div>
            <div id="chooseMsg" class="msg"></div>
          </div>
          <div class="actions-right">
            <a class="btn ghost" href="dashboard.html">Annuler</a>
            <button id="chooseSubmit" class="btn primary" type="submit">Valider</button>
          </div>
        </div>
      </form>
    </section>
  </main>

  <script src="utils.js" defer></script>
  <script src="choose-role.js" defer></script>
</body>
</html>

===== ./generate_north_america.js =====

// generate_north_america.js
// Usage:
//   node generate_north_america.js            -> crée fichiers si absents (ne pas écraser)
//   node generate_north_america.js --force    -> écrase les fichiers existants
//
// Place ce fichier à la racine du projet (~/WorldConflict) et exécute-le avec node.

const fs = require('fs');
const path = require('path');

const FORCE = process.argv.includes('--force');

function slugify(name) {
  return name
    .normalize('NFD').replace(/[\u0300-\u036f]/g, '') // enlever accents
    .toLowerCase()
    .replace(/['’"]/g, '') // virer apostrophes/marques
    .replace(/[^a-z0-9\s-]/g, '') // garder alnum espace -
    .trim()
    .replace(/\s+/g, '-');
}

// Liste complète Amérique du Nord
// id = identifiant court (3 lettres ou custom), name = nom affiché
const NORTH_AMERICA = [
  { id: 'can', name: 'Canada' },
  { id: 'cri', name: 'Costa Rica' },
  { id: 'cub', name: 'Cuba' },
  { id: 'dom', name: 'Dominican Republic' },
  { id: 'slv', name: 'El Salvador' },
  { id: 'gtm', name: 'Guatemala' },
  { id: 'hti', name: 'Haiti' },
  { id: 'hnd', name: 'Honduras' },
  { id: 'mex', name: 'Mexico' },
  { id: 'nic', name: 'Nicaragua' },
  { id: 'pan', name: 'Panama' },
  { id: 'usa', name: 'United States' }
];

const outDir = path.join(process.cwd(), 'map', 'world', 'north_america');
if (!fs.existsSync(outDir)) fs.mkdirSync(outDir, { recursive: true });

const today = new Date().toISOString().slice(0, 10); // YYYY-MM-DD

let created = 0, skipped = 0, overwritten = 0;

NORTH_AMERICA.forEach(c => {
  const slug = slugify(c.name);
  const fileName = `${slug}.json`;
  const filePath = path.join(outDir, fileName);

  const payload = {
    id: (c.id || slug).toLowerCase(),
    name: c.name,
    continent: 'north_america',
    metadata: {
      created_at: today,
      updated_at: null
    },
    government: {
      leader: null,
      ministers: [],
      system: null
    },
    population: {
      value: 0,
      growth_rate: 0
    },
    economy: {
      gdp: 0,
      resources: {}
    },
    military: {
      active: 0,
      reserve: 0,
      equipment: {}
    },
    geography: {
      area_km2: 0,
      major_cities: [],
      climate_zones: [],
      borders: []
    },
    status: {
      occupied: false,
      contested: false
    }
  };

  if (fs.existsSync(filePath)) {
    if (FORCE) {
      fs.writeFileSync(filePath, JSON.stringify(payload, null, 2), 'utf8');
      overwritten++;
      console.log(`overwritten: ${fileName}`);
    } else {
      skipped++;
      console.log(`skipped: ${fileName} (exists)`);
    }
  } else {
    fs.writeFileSync(filePath, JSON.stringify(payload, null, 2), 'utf8');
    created++;
    console.log(`created: ${fileName}`);
  }
});

console.log('\nSummary:');
console.log(`  created: ${created}`);
console.log(`  overwritten: ${overwritten}`);
console.log(`  skipped: ${skipped}`);
console.log(`Files generated in: ${outDir}`);

===== ./rules.css =====

/* rules.css — style professionnel et lisible pour la page Règlement */

:root {
  /* les variables globales sont dans variables.css */
}

/* Layout */
.wrap {
  padding: 28px;
  display: block;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
  margin-bottom: 20px;
}

.brand {
  display: flex;
  gap: 14px;
  align-items: center;
}

.logo { width: 56px; height: 56px; flex: 0 0 56px; }
.brand-text h1 { margin: 0; font-size: 18px; }
.muted { color: var(--muted); }

/* Layout columns */
.layout {
  display: grid;
  grid-template-columns: 260px 1fr;
  gap: 20px;
  align-items: start;
}

/* Table of contents (aside) */
.toc {
  position: sticky;
  top: 20px;
  align-self: start;
  background: transparent;
}

.toc-head { margin-bottom: 12px; }
.toc-head h2 { margin: 0 0 8px; font-size: 16px; }
.toc-search {
  width: 100%;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.04);
  background: var(--glass);
  color: var(--text);
  font-size: 14px;
}

/* TOC list */
.toc-list {
  margin-top: 12px;
}
.toc-list a {
  display: block;
  padding: 8px 10px;
  border-radius: 8px;
  color: var(--text);
  text-decoration: none;
  font-size: 14px;
  margin-bottom: 6px;
  transition: background 160ms;
}
.toc-list a:hover, .toc-list a:focus {
  background: rgba(79,70,229,0.06);
  outline: none;
}
.toc-foot { margin-top: 12px; font-size: 13px; color: var(--muted); }

/* Content card */
.card.rules {
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
  border-radius: var(--radius);
  padding: 22px;
  box-shadow: var(--card-shadow);
  line-height: 1.6;
}

/* Headings & sections */
.card.rules h2 { margin-top: 0; font-size: 20px; }
.lead { margin: 8px 0 16px; font-size: 14px; color: var(--muted); }

.section { margin-top: 18px; }
.section h3 { margin: 6px 0 8px; font-size: 16px; }
.section p { margin: 6px 0; color: var(--text); }
.section ul { margin: 8px 0 0 20px; color: var(--text); }
.section li { margin-bottom: 8px; }

/* Small utilities */
.btn {
  padding: 8px 10px;
  border-radius: 8px;
  border: 1px solid rgba(255,255,255,0.04);
  background: transparent;
  color: var(--text);
  cursor: pointer;
}
.btn-small { font-size: 13px; }

/* Responsive */
@media (max-width: 980px) {
  .layout { grid-template-columns: 1fr; }
  .toc { display: none; }
  .card.rules { padding: 18px; }
  .header { gap: 10px; }
}

===== ./generate_europe.js =====

// generate_europe.js
// Usage:
//   node generate_europe.js            -> crée fichiers si absents (ne pas écraser)
//   node generate_europe.js --force    -> écrase les fichiers existants
//
// Place ce fichier à la racine du projet (~/WorldConflict) et exécute-le avec node.

const fs = require('fs');
const path = require('path');

const FORCE = process.argv.includes('--force');

function slugify(name) {
  return name
    .normalize('NFD').replace(/[\u0300-\u036f]/g, '') // enlever accents
    .toLowerCase()
    .replace(/['’"]/g, '') // virer apostrophes/marques
    .replace(/[^a-z0-9\s-]/g, '') // garder alnum espace -
    .trim()
    .replace(/\s+/g, '-');
}

// Liste complète Europe (incl. territoires contestés et pays partiellement reconnus)
// id = identifiant court (3 lettres ou custom), name = nom affiché
const EUROPE = [
  { id: 'alb', name: 'Albania' },
  { id: 'and', name: 'Andorra' },
  { id: 'arm', name: 'Armenia' },
  { id: 'aut', name: 'Austria' },
  { id: 'aze', name: 'Azerbaijan' },
  { id: 'blr', name: 'Belarus' },
  { id: 'bel', name: 'Belgium' },
  { id: 'bih', name: 'Bosnia and Herzegovina' },
  { id: 'bul', name: 'Bulgaria' },
  { id: 'cro', name: 'Croatia' },
  { id: 'cyp', name: 'Cyprus' },
  { id: 'cze', name: 'Czech Republic' },
  { id: 'dnk', name: 'Denmark' },
  { id: 'est', name: 'Estonia' },
  { id: 'fin', name: 'Finland' },
  { id: 'fra', name: 'France' },
  { id: 'geo', name: 'Georgia' }, // Partly in Europe
  { id: 'deu', name: 'Germany' },
  { id: 'grc', name: 'Greece' },
  { id: 'hun', name: 'Hungary' },
  { id: 'isl', name: 'Iceland' },
  { id: 'irl', name: 'Ireland' },
  { id: 'ita', name: 'Italy' },
  { id: 'kaz', name: 'Kazakhstan' }, // Partly in Europe
  { id: 'kos', name: 'Kosovo' }, // Partially recognized
  { id: 'lva', name: 'Latvia' },
  { id: 'lie', name: 'Liechtenstein' },
  { id: 'ltu', name: 'Lithuania' },
  { id: 'lux', name: 'Luxembourg' },
  { id: 'mlt', name: 'Malta' },
  { id: 'mda', name: 'Moldova' },
  { id: 'mco', name: 'Monaco' },
  { id: 'mne', name: 'Montenegro' },
  { id: 'nld', name: 'Netherlands' },
  { id: 'mkd', name: 'North Macedonia' },
  { id: 'nor', name: 'Norway' },
  { id: 'pol', name: 'Poland' },
  { id: 'prt', name: 'Portugal' },
  { id: 'rou', name: 'Romania' },
  { id: 'rus', name: 'Russia' }, // Partly in Europe
  { id: 'smr', name: 'San Marino' },
  { id: 'srb', name: 'Serbia' },
  { id: 'svk', name: 'Slovakia' },
  { id: 'svn', name: 'Slovenia' },
  { id: 'esp', name: 'Spain' },
  { id: 'swe', name: 'Sweden' },
  { id: 'che', name: 'Switzerland' },
  { id: 'tur', name: 'Turkey' }, // Partly in Europe
  { id: 'ukr', name: 'Ukraine' },
  { id: 'gbr', name: 'United Kingdom' },
  { id: 'vat', name: 'Vatican City' },
  { id: 'tms', name: 'Transnistria' }, // Contested territory
  { id: 'abk', name: 'Abkhazia' }, // Contested territory
  { id: 'oss', name: 'South Ossetia' }, // Contested territory
];

const outDir = path.join(process.cwd(), 'map', 'world', 'europe');
if (!fs.existsSync(outDir)) fs.mkdirSync(outDir, { recursive: true });

const today = new Date().toISOString().slice(0, 10); // YYYY-MM-DD

let created = 0, skipped = 0, overwritten = 0;

EUROPE.forEach(c => {
  const slug = slugify(c.name);
  const fileName = `${slug}.json`;
  const filePath = path.join(outDir, fileName);

  const payload = {
    id: (c.id || slug).toLowerCase(),
    name: c.name,
    continent: 'europe',
    metadata: {
      created_at: today,
      updated_at: null
    },
    government: {
      leader: null,
      ministers: [],
      system: null
    },
    population: {
      value: 0,
      growth_rate: 0
    },
    economy: {
      gdp: 0,
      resources: {}
    },
    military: {
      active: 0,
      reserve: 0,
      equipment: {}
    },
    geography: {
      area_km2: 0,
      major_cities: [],
      climate_zones: [],
      borders: []
    },
    status: {
      occupied: false,
      contested: false
    }
  };

  if (fs.existsSync(filePath)) {
    if (FORCE) {
      fs.writeFileSync(filePath, JSON.stringify(payload, null, 2), 'utf8');
      overwritten++;
      console.log(`overwritten: ${fileName}`);
    } else {
      skipped++;
      console.log(`skipped: ${fileName} (exists)`);
    }
  } else {
    fs.writeFileSync(filePath, JSON.stringify(payload, null, 2), 'utf8');
    created++;
    console.log(`created: ${fileName}`);
  }
});

console.log('\nSummary:');
console.log(`  created: ${created}`);
console.log(`  overwritten: ${overwritten}`);
console.log(`  skipped: ${skipped}`);
console.log(`Files generated in: ${outDir}`);

===== ./open.js =====

#!/usr/bin/env node
// open.js : ouvre le projet WorldConflict en localhost sans dépendances externes

import http from 'http';
import fs from 'fs';
import path from 'path';
import { exec } from 'child_process';
import { fileURLToPath } from 'url';
import { dirname } from 'path';

// configuration
const PORT = 3000;
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
const ROOT = path.resolve(__dirname); // dossier du projet

// ouvrir le navigateur selon l'OS
function openBrowser(url) {
  const start =
    process.platform === 'darwin' ? 'open' :
    process.platform === 'win32' ? 'start' :
    'xdg-open';
  exec(`${start} ${url}`);
}

// serveur simple
const server = http.createServer((req, res) => {
  let filePath = path.join(ROOT, req.url === '/' ? 'index.html' : req.url);
  const ext = path.extname(filePath).toLowerCase();

  const mimeTypes = {
    '.html': 'text/html',
    '.js': 'text/javascript',
    '.css': 'text/css',
    '.json': 'application/json',
    '.png': 'image/png',
    '.jpg': 'image/jpeg',
    '.jpeg': 'image/jpeg',
    '.gif': 'image/gif',
    '.svg': 'image/svg+xml',
  };

  fs.readFile(filePath, (err, content) => {
    if (err) {
      res.writeHead(404, {'Content-Type': 'text/plain'});
      res.end('404 - Not Found');
    } else {
      res.writeHead(200, {'Content-Type': mimeTypes[ext] || 'application/octet-stream'});
      res.end(content);
    }
  });
});

// démarrer le serveur
server.listen(PORT, () => {
  const url = `http://localhost:${PORT}`;
  console.log(`🚀 Serveur lancé sur ${url}`);
  openBrowser(url);
});

===== ./war/state.json =====

{
  "wars": [
    {
      "id": "war_france_germany_1766395261149",
      "attackers": [
        "france"
      ],
      "defenders": [
        "germany"
      ],
      "status": "active",
      "startedAt": "2025-12-22T09:21:01.150Z",
      "endedAt": null,
      "intensity": 0.24167458310713313,
      "casualties": {
        "france": null,
        "germany": null
      },
      "economyImpact": {}
    }
  ]
}
===== ./war/engine.js =====

// war/engine.js
import fs from 'fs';
import path from 'path';

const STATE_PATH = path.resolve('./war/state.json');
const LEDGER_PATH = path.resolve('./war/ledger.json');
const COUNTRIES_DIR = path.resolve('./map/world/countries');

// --------------------
// Utils
// --------------------
function loadJSON(p, fallback) {
  try {
    return JSON.parse(fs.readFileSync(p, 'utf8'));
  } catch {
    return fallback;
  }
}

function saveJSON(p, data) {
  fs.writeFileSync(p, JSON.stringify(data, null, 2));
}

function now() {
  return new Date().toISOString();
}

function clamp(v, min, max) {
  return Math.max(min, Math.min(max, v));
}

function rnd(min, max) {
  return Math.random() * (max - min) + min;
}

// --------------------
// Countries
// --------------------
function loadCountry(id) {
  const file = path.join(COUNTRIES_DIR, `${id}.json`);
  return JSON.parse(fs.readFileSync(file, 'utf8'));
}

function saveCountry(id, data) {
  const file = path.join(COUNTRIES_DIR, `${id}.json`);
  fs.writeFileSync(file, JSON.stringify(data, null, 2));
}

// --------------------
// War Engine
// --------------------
export function declareWar(attacker, defender) {
  const state = loadJSON(STATE_PATH, { wars: [] });

  const id = `war_${attacker}_${defender}_${Date.now()}`;

  const war = {
    id,
    attackers: [attacker],
    defenders: [defender],
    status: 'active',
    startedAt: now(),
    endedAt: null,
    intensity: 0.2,
    casualties: {},
    economyImpact: {}
  };

  state.wars.push(war);
  saveJSON(STATE_PATH, state);

  // update countries
  for (const c of [attacker, defender]) {
    const country = loadCountry(c);
    country.war.atWar = true;
    country.war.wars.push(id);
    saveCountry(c, country);
  }

  logEvent('DECLARE_WAR', { attacker, defender, warId: id });

  return war;
}

export function tickWars() {
  const state = loadJSON(STATE_PATH, { wars: [] });

  for (const war of state.wars) {
    if (war.status !== 'active') continue;

    war.intensity = clamp(
      war.intensity + rnd(0.01, 0.05),
      0,
      1
    );

    for (const side of [...war.attackers, ...war.defenders]) {
      const country = loadCountry(side);

      const loss = Math.floor((country.population || 10_000_000) * war.intensity * 0.000005);

      war.casualties[side] = (war.casualties[side] || 0) + loss;

      country.population = Math.max(0, (country.population || 10_000_000) - loss);

      country.war.warExhaustion = clamp(
        country.war.warExhaustion + war.intensity * 0.03,
        0,
        1
      );

      saveCountry(side, country);
    }

    logEvent('WAR_TICK', {
      warId: war.id,
      intensity: war.intensity
    });

    // End condition
    const exhausted = [...war.attackers, ...war.defenders]
      .some(c => loadCountry(c).war.warExhaustion >= 0.95);

    if (exhausted) endWar(war.id, 'exhaustion');
  }

  saveJSON(STATE_PATH, state);
}

export function endWar(warId, reason) {
  const state = loadJSON(STATE_PATH, { wars: [] });
  const war = state.wars.find(w => w.id === warId);
  if (!war) return;

  war.status = 'ended';
  war.endedAt = now();

  for (const c of [...war.attackers, ...war.defenders]) {
    const country = loadCountry(c);
    country.war.atWar = false;
    country.war.wars = country.war.wars.filter(w => w !== warId);
    country.war.warExhaustion = 0;
    saveCountry(c, country);
  }

  logEvent('END_WAR', { warId, reason });
  saveJSON(STATE_PATH, state);
}

// --------------------
// Ledger
// --------------------
function logEvent(type, details) {
  const ledger = loadJSON(LEDGER_PATH, []);
  ledger.push({ ts: now(), type, details });
  saveJSON(LEDGER_PATH, ledger);
}

===== ./war/ledger.json =====

[
  {
    "ts": "2025-12-22T09:21:01.166Z",
    "type": "DECLARE_WAR",
    "details": {
      "attacker": "france",
      "defender": "germany",
      "warId": "war_france_germany_1766395261149"
    }
  },
  {
    "ts": "2025-12-22T09:21:29.858Z",
    "type": "WAR_TICK",
    "details": {
      "warId": "war_france_germany_1766395261149",
      "intensity": 0.24167458310713313
    }
  }
]
===== ./market.html =====

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WorldConflict — Marché</title>

  <!-- Variables globales et style du projet -->
  <link rel="stylesheet" href="variables.css">
  <link rel="stylesheet" href="market.css">
</head>
<body>
  <div class="shell">
    <header class="market-header">
      <div>
        <div class="title">Marché — WorldConflict</div>
        <div class="muted">Achetez, vendez et consultez les prix du marché mondial</div>
      </div>

      <div class="header-right">
        <div class="mini">Mode : <strong id="modeLabel">Lecture</strong></div>
        <button id="refreshBtn" class="btn" title="Rafraîchir">⟳ Rafraîchir</button>
      </div>
    </header>

    <main class="market-wrapper">
      <!-- Catalogue (gauche) -->
      <aside class="panel catalog" aria-label="Catalogue">
        <h3>Catalogue</h3>

        <div class="search">
          <input id="searchInput" placeholder="Rechercher un item..." aria-label="Recherche item">
          <button id="searchBtn" class="btn">Rechercher</button>
        </div>

        <div id="itemList" class="item-list" role="list">
          <!-- Rempli par market.js : liste d'items => chaque item button.data-item -->
          <div class="muted">Chargement des items…</div>
        </div>

        <div style="margin-top:10px" class="actions-row">
          <button id="viewAllBtn" class="btn btn-ghost">Voir tout</button>
        </div>
      </aside>

      <!-- Panneau central : devis + trade -->
      <section class="panel market-panel" aria-label="Panneau du marché">
        <div class="market-panel-inner">
          <div id="selectedItem" class="selected-item mini">Sélectionne un item dans la colonne de gauche.</div>

          <form id="quoteForm" class="quote-form" autocomplete="off">
            <label class="field">
              <span class="label">Item</span>
              <input id="itemId" name="itemId" placeholder="ex: oil" required>
            </label>

            <div class="two-cols">
              <label class="field">
                <span class="label">Quantité</span>
                <input id="qty" name="qty" type="number" min="1" value="1" required>
              </label>

              <label class="field">
                <span class="label">Pays (facultatif)</span>
                <input id="countryId" name="countryId" placeholder="ex: fra">
              </label>
            </div>

            <div class="quote-row">
              <button id="getQuoteBtn" class="btn btn-primary" type="button">Obtenir un devis</button>
              <div id="quoteResult" class="quote-result muted">—</div>
            </div>

            <div id="tradeControls" class="trade-controls visually-hidden">
              <div class="two-cols">
                <button id="buyBtn" class="btn btn-success" type="button">Acheter</button>
                <button id="sellBtn" class="btn btn-danger" type="button">Vendre</button>
              </div>
              <div id="tradeMsg" class="muted mini" style="margin-top:8px"></div>
            </div>
          </form>

          <section id="priceBreakdown" class="panel small muted" style="margin-top:12px; padding:10px;">
            <h4>Décomposition du prix</h4>
            <pre id="breakdownPre" class="mini">Aucun devis pour l'instant.</pre>
          </section>
        </div>
      </section>

      <!-- Colonne droite : snapshot & transactions -->
      <aside class="panel trades-panel" aria-label="Dernières transactions">
        <h3>Marché — Synthèse</h3>

        <div id="marketSnapshot" class="mini muted" style="margin-bottom:10px">
          Chargement de l'état du marché…
        </div>

        <h4 style="margin-top:6px">Transactions récentes</h4>
        <div id="recentTrades" class="trade-list">
          <div class="muted">Aucune transaction récente.</div>
        </div>

        <div style="margin-top:12px" class="actions-row">
          <button id="viewLedgerBtn" class="btn btn-ghost">Voir le ledger</button>
        </div>
      </aside>
    </main>
  </div>

<nav class="bottom-nav">
  <div class="nav-pill">

    <button id="nav-chat" class="nav-btn active">
      <span class="nav-icon">💬</span>
      <span class="nav-label">Chat</span>
    </button>

    <button id="nav-lobby" class="nav-btn">
      <span class="nav-icon">🏛️</span>
      <span class="nav-label">Lobby</span>
    </button>

    <button id="nav-notifications" class="nav-btn">
      <span class="nav-icon">🔔</span>
      <span class="nav-label">Notif</span>
    </button>

    <button id="nav-profile" class="nav-btn">
      <span class="nav-icon">👤</span>
      <span class="nav-label">Profile</span>
    </button>

  </div>
</nav>

  <div id="toast" class="wc-toast visually-hidden" role="status" aria-live="polite"></div>

  <!-- Placeholder JS (réellement implémenté plus tard) -->
  <script type="module" src="market.js" defer></script>
</body>
</html>

===== ./generate_africa.js =====

// generate_africa.js
// Usage:
//   node generate_africa.js            -> crée fichiers si absents (ne pas écraser)
//   node generate_africa.js --force    -> écrase les fichiers existants
//
// Place ce fichier à la racine du projet (~/WorldConflict) et exécute-le avec node.

const fs = require('fs');
const path = require('path');

const FORCE = process.argv.includes('--force');

function slugify(name){
  return name
    .normalize('NFD').replace(/[\u0300-\u036f]/g, '') // enlever accents
    .toLowerCase()
    .replace(/['’"]/g, '') // virer apostrophes/marques
    .replace(/[^a-z0-9\s-]/g, '') // garder alnum espace -
    .trim()
    .replace(/\s+/g, '-');
}

// Liste complète Afrique (incl. Western Sahara et Somaliland)
// id = identifiant court (3 lettres ou custom), name = nom affiché
const AFRICA = [
  { id: 'dza', name: 'Algeria' },
  { id: 'ago', name: 'Angola' },
  { id: 'ben', name: 'Benin' },
  { id: 'bwa', name: 'Botswana' },
  { id: 'bfa', name: 'Burkina Faso' },
  { id: 'bdi', name: 'Burundi' },
  { id: 'cpv', name: 'Cabo Verde' },
  { id: 'cmr', name: 'Cameroon' },
  { id: 'caf', name: 'Central African Republic' },
  { id: 'tcd', name: 'Chad' },
  { id: 'com', name: 'Comoros' },
  { id: 'cog', name: 'Congo' },
  { id: 'cod', name: 'Democratic Republic of the Congo' },
  { id: 'civ', name: 'Côte d’Ivoire' },
  { id: 'dji', name: 'Djibouti' },
  { id: 'egy', name: 'Egypt' },
  { id: 'gnq', name: 'Equatorial Guinea' },
  { id: 'eri', name: 'Eritrea' },
  { id: 'swz', name: 'Eswatini' },
  { id: 'eth', name: 'Ethiopia' },
  { id: 'gab', name: 'Gabon' },
  { id: 'gmb', name: 'Gambia' },
  { id: 'gha', name: 'Ghana' },
  { id: 'gin', name: 'Guinea' },
  { id: 'gnb', name: 'Guinea-Bissau' },
  { id: 'ken', name: 'Kenya' },
  { id: 'lso', name: 'Lesotho' },
  { id: 'lbr', name: 'Liberia' },
  { id: 'lby', name: 'Libya' },
  { id: 'mdg', name: 'Madagascar' },
  { id: 'mwi', name: 'Malawi' },
  { id: 'mli', name: 'Mali' },
  { id: 'mrt', name: 'Mauritania' },
  { id: 'mus', name: 'Mauritius' },
  { id: 'mar', name: 'Morocco' },
  { id: 'moz', name: 'Mozambique' },
  { id: 'nam', name: 'Namibia' },
  { id: 'ner', name: 'Niger' },
  { id: 'nga', name: 'Nigeria' },
  { id: 'rwa', name: 'Rwanda' },
  { id: 'stp', name: 'Sao Tome and Principe' },
  { id: 'sen', name: 'Senegal' },
  { id: 'syc', name: 'Seychelles' },
  { id: 'sle', name: 'Sierra Leone' },
  { id: 'som', name: 'Somalia' },
  { id: 'sdn', name: 'Sudan' },
  { id: 'ssd', name: 'South Sudan' },
  { id: 'tza', name: 'Tanzania' },
  { id: 'tgo', name: 'Togo' },
  { id: 'tun', name: 'Tunisia' },
  { id: 'uga', name: 'Uganda' },
  { id: 'zmb', name: 'Zambia' },
  { id: 'zwe', name: 'Zimbabwe' },
  { id: 'zaf', name: 'South Africa' },
  // Territoires / quasi-États
  { id: 'esh', name: 'Western Sahara' },    // Sahara Occidental
  { id: 'som-l', name: 'Somaliland' }       // Somaliland (autoproclamé)
];

const outDir = path.join(process.cwd(), 'map', 'world', 'africa');
if (!fs.existsSync(outDir)) fs.mkdirSync(outDir, { recursive: true });

const today = new Date().toISOString().slice(0,10); // YYYY-MM-DD

let created = 0, skipped = 0, overwritten = 0;

AFRICA.forEach(c => {
  const slug = slugify(c.name);
  const fileName = `${slug}.json`;
  const filePath = path.join(outDir, fileName);

  const payload = {
    id: (c.id || slug).toLowerCase(),
    name: c.name,
    continent: 'africa',
    metadata: {
      created_at: today,
      updated_at: null
    },
    government: {
      leader: null,
      ministers: [],
      system: null
    },
    population: {
      value: 0,
      growth_rate: 0
    },
    economy: {
      gdp: 0,
      resources: {}
    },
    military: {
      active: 0,
      reserve: 0,
      equipment: {}
    },
    geography: {
      area_km2: 0,
      major_cities: [],
      climate_zones: [],
      borders: []
    },
    status: {
      occupied: false,
      contested: false
    }
  };

  if (fs.existsSync(filePath)) {
    if (FORCE) {
      fs.writeFileSync(filePath, JSON.stringify(payload, null, 2), 'utf8');
      overwritten++;
      console.log(`overwritten: ${fileName}`);
    } else {
      skipped++;
      console.log(`skipped: ${fileName} (exists)`);
    }
  } else {
    fs.writeFileSync(filePath, JSON.stringify(payload, null, 2), 'utf8');
    created++;
    console.log(`created: ${fileName}`);
  }
});

console.log('\nSummary:');
console.log(`  created: ${created}`);
console.log(`  overwritten: ${overwritten}`);
console.log(`  skipped: ${skipped}`);
console.log(`Files generated in: ${outDir}`);

===== ./map/world/asia.json =====

{
  "name": "Asia",
  "slug": "asia",
  "type": "continent",
  "version": "1.0",
  "last_update": "2025-11-01T00:00:00Z",
  "meta": {
    "source": "WorldConflict-minimal",
    "auto_generated": false
  },
  "statistics": {
    "population_estimate": null,
    "area_km2": null
  },
  "geography": {
    "hemisphere": "Nord (partiellement Sud)"
  },
  "economy": {
    "gdp_estimate_usd": null
  },
  "politics": {
    "note": null
  },
  "structure": {
    "continent_dir": "map/world/asia",
    "country_files": "map/world/asia/*.json"
  }
}

===== ./map/world/europe.json =====

{
  "name": "Europe",
  "slug": "europe",
  "type": "continent",
  "version": "1.0",
  "last_update": "2025-11-01T00:00:00Z",
  "meta": {
    "source": "WorldConflict-minimal",
    "auto_generated": false
  },
  "statistics": {
    "population_estimate": null,
    "area_km2": null
  },
  "geography": {
    "hemisphere": "Nord"
  },
  "economy": {
    "gdp_estimate_usd": null
  },
  "politics": {
    "note": null
  },
  "structure": {
    "continent_dir": "map/world/europe",
    "country_files": "map/world/europe/*.json"
  }
}

===== ./map/world/north_america.json =====

{
  "name": "North America",
  "slug": "north_america",
  "type": "continent",
  "version": "1.0",
  "last_update": "2025-11-01T00:00:00Z",
  "meta": {
    "source": "WorldConflict-minimal",
    "auto_generated": false
  },
  "statistics": {
    "population_estimate": null,
    "area_km2": null
  },
  "geography": {
    "hemisphere": "Nord"
  },
  "economy": {
    "gdp_estimate_usd": null
  },
  "politics": {
    "note": null
  },
  "structure": {
    "continent_dir": "map/world/north_america",
    "country_files": "map/world/north_america/*.json"
  }
}

===== ./map/world/oceania.json =====

{
  "name": "Oceania",
  "slug": "oceania",
  "type": "continent",
  "version": "1.0",
  "last_update": "2025-11-01T00:00:00Z",
  "meta": {
    "source": "WorldConflict-minimal",
    "auto_generated": false
  },
  "statistics": {
    "population_estimate": null,
    "area_km2": null
  },
  "geography": {
    "hemisphere": "Sud (partiellement Nord)"
  },
  "economy": {
    "gdp_estimate_usd": null
  },
  "politics": {
    "note": null
  },
  "structure": {
    "continent_dir": "map/world/oceania",
    "country_files": "map/world/oceania/*.json"
  }
}

===== ./map/world/antarctica.json =====

{
  "name": "Antarctica",
  "slug": "antarctica",
  "type": "continent",
  "version": "1.0",
  "last_update": "2025-11-01T00:00:00Z",
  "meta": {
    "source": "WorldConflict-minimal",
    "auto_generated": false
  },
  "statistics": {
    "population_estimate": null,
    "area_km2": null
  },
  "geography": {
    "hemisphere": "Sud"
  },
  "economy": {
    "gdp_estimate_usd": null
  },
  "politics": {
    "note": null
  },
  "structure": {
    "continent_dir": "map/world/antarctica",
    "country_files": "map/world/antarctica/*.json"
  }
}

===== ./map/world/africa.json =====

{
  "name": "Africa",
  "slug": "africa",
  "type": "continent",
  "version": "1.0",
  "last_update": "2025-11-01T00:00:00Z",
  "meta": {
    "source": "WorldConflict-minimal",
    "auto_generated": false
  },
  "statistics": {
    "population_estimate": null,
    "area_km2": null
  },
  "geography": {
    "hemisphere": "Nord-Sud"
  },
  "economy": {
    "gdp_estimate_usd": null
  },
  "politics": {
    "note": null
  },
  "structure": {
    "continent_dir": "map/world/africa",
    "country_files": "map/world/africa/*.json"
  }
}

===== ./map/world/countries/seychelles.json =====

{
  "id": "syc",
  "name": "Seychelles",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/ghana.json =====

{
  "id": "gha",
  "name": "Ghana",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/south-ossetia.json =====

{
  "id": "oss",
  "name": "South Ossetia",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/saudi-arabia.json =====

{
  "id": "sau",
  "name": "Saudi Arabia",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/guinea-bissau.json =====

{
  "id": "gnb",
  "name": "Guinea-Bissau",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/botswana.json =====

{
  "id": "bwa",
  "name": "Botswana",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/jordan.json =====

{
  "id": "jor",
  "name": "Jordan",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/luxembourg.json =====

{
  "id": "lux",
  "name": "Luxembourg",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/benin.json =====

{
  "id": "ben",
  "name": "Bénin",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/congo.json =====

{
  "id": "cog",
  "name": "Congo",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/haiti.json =====

{
  "id": "hti",
  "name": "Haiti",
  "continent": "north_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/venezuela.json =====

{
  "id": "ven",
  "name": "Venezuela",
  "continent": "south_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/djibouti.json =====

{
  "id": "dji",
  "name": "Djibouti",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/vietnam.json =====

{
  "id": "vnm",
  "name": "Vietnam",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/solomon-islands.json =====

{
  "id": "slb",
  "name": "Solomon Islands",
  "continent": "oceania",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/new-zealand.json =====

{
  "id": "nzl",
  "name": "New Zealand",
  "continent": "oceania",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/algeria.json =====

{
  "id": "dza",
  "name": "Algeria",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/albania.json =====

{
  "id": "alb",
  "name": "Albania",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/sierra-leone.json =====

{
  "id": "sle",
  "name": "Sierra Leone",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/nigeria.json =====

{
  "id": "nga",
  "name": "Nigeria",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/china.json =====

{
  "id": "chn",
  "name": "China",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/bhutan.json =====

{
  "id": "btn",
  "name": "Bhutan",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/marshall-islands.json =====

{
  "id": "mhl",
  "name": "Marshall Islands",
  "continent": "oceania",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/kenya.json =====

{
  "id": "ken",
  "name": "Kenya",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/spain.json =====

{
  "id": "esp",
  "name": "Spain",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/zambia.json =====

{
  "id": "zmb",
  "name": "Zambia",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/estonia.json =====

{
  "id": "est",
  "name": "Estonia",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/cote-divoire.json =====

{
  "id": "civ",
  "name": "Côte d’Ivoire",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/lesotho.json =====

{
  "id": "lso",
  "name": "Lesotho",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/cuba.json =====

{
  "id": "cub",
  "name": "Cuba",
  "continent": "north_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/papua-new-guinea.json =====

{
  "id": "png",
  "name": "Papua New Guinea",
  "continent": "oceania",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/brunei.json =====

{
  "id": "brn",
  "name": "Brunei",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/qatar.json =====

{
  "id": "qat",
  "name": "Qatar",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/singapore.json =====

{
  "id": "sgp",
  "name": "Singapore",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/south-korea.json =====

{
  "id": "kor",
  "name": "South Korea",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/comoros.json =====

{
  "id": "com",
  "name": "Comoros",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/syria.json =====

{
  "id": "syc",
  "name": "Syria",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/greece.json =====

{
  "id": "grc",
  "name": "Greece",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/egypt.json =====

{
  "id": "egy",
  "name": "Egypt",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/latvia.json =====

{
  "id": "lva",
  "name": "Latvia",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/uruguay.json =====

{
  "id": "ury",
  "name": "Uruguay",
  "continent": "south_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/madagascar.json =====

{
  "id": "mdg",
  "name": "Madagascar",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/palestine.json =====

{
  "id": "pse",
  "name": "Palestine",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/andorra.json =====

{
  "id": "and",
  "name": "Andorra",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/sri-lanka.json =====

{
  "id": "lka",
  "name": "Sri Lanka",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/nauru.json =====

{
  "id": "nru",
  "name": "Nauru",
  "continent": "oceania",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/mozambique.json =====

{
  "id": "moz",
  "name": "Mozambique",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/liechtenstein.json =====

{
  "id": "lie",
  "name": "Liechtenstein",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/montenegro.json =====

{
  "id": "mne",
  "name": "Montenegro",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/austria.json =====

{
  "id": "aut",
  "name": "Austria",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/uganda.json =====

{
  "id": "uga",
  "name": "Uganda",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/somalia.json =====

{
  "id": "som",
  "name": "Somalia",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/fiji.json =====

{
  "id": "fji",
  "name": "Fiji",
  "continent": "oceania",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/morocco.json =====

{
  "id": "mar",
  "name": "Morocco",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/finland.json =====

{
  "id": "fin",
  "name": "Finland",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/cyprus.json =====

{
  "id": "cyp",
  "name": "Cyprus",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/sweden.json =====

{
  "id": "swe",
  "name": "Sweden",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/angola.json =====

{
  "id": "ago",
  "name": "Angola",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/abkhazia.json =====

{
  "id": "abk",
  "name": "Abkhazia",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/kazakhstan.json =====

{
  "id": "kaz",
  "name": "Kazakhstan",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/mexico.json =====

{
  "id": "mex",
  "name": "Mexico",
  "continent": "north_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/nicaragua.json =====

{
  "id": "nic",
  "name": "Nicaragua",
  "continent": "north_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/maldives.json =====

{
  "id": "mdv",
  "name": "Maldives",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/indonesia.json =====

{
  "id": "idn",
  "name": "Indonesia",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/western-sahara.json =====

{
  "id": "esh",
  "name": "Western Sahara",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/germany.json =====

{
  "id": "deu",
  "name": "Germany",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": null,
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": true,
    "wars": [
      "war_france_germany_1766395261149"
    ],
    "warExhaustion": 0.007250237493213994
  }
}
===== ./map/world/countries/north-korea.json =====

{
  "id": "prk",
  "name": "North Korea",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/ethiopia.json =====

{
  "id": "eth",
  "name": "Ethiopia",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/malta.json =====

{
  "id": "mlt",
  "name": "Malta",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/eswatini.json =====

{
  "id": "swz",
  "name": "Eswatini",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/palau.json =====

{
  "id": "plw",
  "name": "Palau",
  "continent": "oceania",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/south-africa.json =====

{
  "id": "zaf",
  "name": "South Africa",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/kyrgyzstan.json =====

{
  "id": "kgz",
  "name": "Kyrgyzstan",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/malaysia.json =====

{
  "id": "mys",
  "name": "Malaysia",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/burma-myanmar.json =====

{
  "id": "mmr",
  "name": "Burma (Myanmar)",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/colombia.json =====

{
  "id": "col",
  "name": "Colombia",
  "continent": "south_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/equatorial-guinea.json =====

{
  "id": "gnq",
  "name": "Equatorial Guinea",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/vatican-city.json =====

{
  "id": "vat",
  "name": "Vatican City",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/iraq.json =====

{
  "id": "irq",
  "name": "Iraq",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/japan.json =====

{
  "id": "jpn",
  "name": "Japan",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/north-macedonia.json =====

{
  "id": "mkd",
  "name": "North Macedonia",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/liberia.json =====

{
  "id": "lbr",
  "name": "Liberia",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/australia.json =====

{
  "id": "aus",
  "name": "Australia",
  "continent": "oceania",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/san-marino.json =====

{
  "id": "smr",
  "name": "San Marino",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/mali.json =====

{
  "id": "mli",
  "name": "Mali",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/peru.json =====

{
  "id": "per",
  "name": "Peru",
  "continent": "south_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/tonga.json =====

{
  "id": "ton",
  "name": "Tonga",
  "continent": "oceania",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/russia.json =====

{
  "id": "rus",
  "name": "Russia",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/dominican-republic.json =====

{
  "id": "dom",
  "name": "Dominican Republic",
  "continent": "north_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/bosnia-and-herzegovina.json =====

{
  "id": "bih",
  "name": "Bosnia and Herzegovina",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/brazil.json =====

{
  "id": "bra",
  "name": "Brazil",
  "continent": "south_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/moldova.json =====

{
  "id": "mda",
  "name": "Moldova",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/micronesia.json =====

{
  "id": "fsm",
  "name": "Micronesia",
  "continent": "oceania",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/tajikistan.json =====

{
  "id": "tjk",
  "name": "Tajikistan",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/united-kingdom.json =====

{
  "id": "gbr",
  "name": "United Kingdom",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/bolivia.json =====

{
  "id": "bol",
  "name": "Bolivia",
  "continent": "south_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/uzbekistan.json =====

{
  "id": "uzb",
  "name": "Uzbekistan",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/portugal.json =====

{
  "id": "prt",
  "name": "Portugal",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/united-arab-emirates.json =====

{
  "id": "are",
  "name": "United Arab Emirates",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/bulgaria.json =====

{
  "id": "bul",
  "name": "Bulgaria",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/el-salvador.json =====

{
  "id": "slv",
  "name": "El Salvador",
  "continent": "north_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/croatia.json =====

{
  "id": "cro",
  "name": "Croatia",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/malawi.json =====

{
  "id": "mwi",
  "name": "Malawi",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/kiribati.json =====

{
  "id": "kir",
  "name": "Kiribati",
  "continent": "oceania",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/samoa.json =====

{
  "id": "smr",
  "name": "Samoa",
  "continent": "oceania",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/chad.json =====

{
  "id": "tcd",
  "name": "Chad",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/senegal.json =====

{
  "id": "sen",
  "name": "Senegal",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/burundi.json =====

{
  "id": "bdi",
  "name": "Burundi",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/chile.json =====

{
  "id": "chl",
  "name": "Chile",
  "continent": "south_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/turkmenistan.json =====

{
  "id": "tkm",
  "name": "Turkmenistan",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/suriname.json =====

{
  "id": "sur",
  "name": "Suriname",
  "continent": "south_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/bangladesh.json =====

{
  "id": "bgd",
  "name": "Bangladesh",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/canada.json =====

{
  "id": "can",
  "name": "Canada",
  "continent": "north_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/netherlands.json =====

{
  "id": "nld",
  "name": "Netherlands",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/czech-republic.json =====

{
  "id": "cze",
  "name": "Czech Republic",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/denmark.json =====

{
  "id": "dnk",
  "name": "Denmark",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/philippines.json =====

{
  "id": "phl",
  "name": "Philippines",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/costa-rica.json =====

{
  "id": "cri",
  "name": "Costa Rica",
  "continent": "north_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/panama.json =====

{
  "id": "pan",
  "name": "Panama",
  "continent": "north_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/pakistan.json =====

{
  "id": "pak",
  "name": "Pakistan",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/lithuania.json =====

{
  "id": "ltu",
  "name": "Lithuania",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/georgia.json =====

{
  "id": "geo",
  "name": "Georgia",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/hungary.json =====

{
  "id": "hun",
  "name": "Hungary",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/israel.json =====

{
  "id": "isr",
  "name": "Israel",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/transnistria.json =====

{
  "id": "tms",
  "name": "Transnistria",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/iceland.json =====

{
  "id": "isl",
  "name": "Iceland",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/somaliland.json =====

{
  "id": "som-l",
  "name": "Somaliland",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/ukraine.json =====

{
  "id": "ukr",
  "name": "Ukraine",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/sudan.json =====

{
  "id": "sdn",
  "name": "Sudan",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/togo.json =====

{
  "id": "tgo",
  "name": "Togo",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/niger.json =====

{
  "id": "ner",
  "name": "Niger",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/gambia.json =====

{
  "id": "gmb",
  "name": "Gambia",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/slovakia.json =====

{
  "id": "svk",
  "name": "Slovakia",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/poland.json =====

{
  "id": "pol",
  "name": "Poland",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/slovenia.json =====

{
  "id": "svn",
  "name": "Slovenia",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/sao-tome-and-principe.json =====

{
  "id": "stp",
  "name": "Sao Tome and Principe",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/armenia.json =====

{
  "id": "arm",
  "name": "Armenia",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/india.json =====

{
  "id": "ind",
  "name": "India",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/guyana.json =====

{
  "id": "guy",
  "name": "Guyana",
  "continent": "south_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/italy.json =====

{
  "id": "ita",
  "name": "Italy",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/romania.json =====

{
  "id": "rou",
  "name": "Romania",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/belarus.json =====

{
  "id": "blr",
  "name": "Belarus",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/burkina-faso.json =====

{
  "id": "bfa",
  "name": "Burkina Faso",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/paraguay.json =====

{
  "id": "pry",
  "name": "Paraguay",
  "continent": "south_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/eritrea.json =====

{
  "id": "eri",
  "name": "Eritrea",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/afghanistan.json =====

{
  "id": "afg",
  "name": "Afghanistan",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/switzerland.json =====

{
  "id": "che",
  "name": "Switzerland",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/mauritania.json =====

{
  "id": "mrt",
  "name": "Mauritania",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/laos.json =====

{
  "id": "lao",
  "name": "Laos",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/argentina.json =====

{
  "id": "arg",
  "name": "Argentina",
  "continent": "south_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/gabon.json =====

{
  "id": "gab",
  "name": "Gabon",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/bahrain.json =====

{
  "id": "bhr",
  "name": "Bahrain",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/guatemala.json =====

{
  "id": "gtm",
  "name": "Guatemala",
  "continent": "north_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/libya.json =====

{
  "id": "lby",
  "name": "Libya",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/cameroon.json =====

{
  "id": "cmr",
  "name": "Cameroon",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/honduras.json =====

{
  "id": "hnd",
  "name": "Honduras",
  "continent": "north_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/guinea.json =====

{
  "id": "gin",
  "name": "Guinea",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/ireland.json =====

{
  "id": "irl",
  "name": "Ireland",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/kuwait.json =====

{
  "id": "kwt",
  "name": "Kuwait",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/democratic-republic-of-the-congo.json =====

{
  "id": "cod",
  "name": "Democratic Republic of the Congo",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/serbia.json =====

{
  "id": "srb",
  "name": "Serbia",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/mauritius.json =====

{
  "id": "mus",
  "name": "Mauritius",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/lebanon.json =====

{
  "id": "lbn",
  "name": "Lebanon",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/thailand.json =====

{
  "id": "tha",
  "name": "Thailand",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/iran.json =====

{
  "id": "irn",
  "name": "Iran",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/belgium.json =====

{
  "id": "bel",
  "name": "Belgium",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/vanuatu.json =====

{
  "id": "vut",
  "name": "Vanuatu",
  "continent": "oceania",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/united-states.json =====

{
  "id": "usa",
  "name": "United States",
  "continent": "north_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/ecuador.json =====

{
  "id": "ecu",
  "name": "Ecuador",
  "continent": "south_america",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/france.json =====

{
  "id": "fra",
  "name": "France",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": null,
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": true,
    "wars": [
      "war_france_germany_1766395261149"
    ],
    "warExhaustion": 0.007250237493213994
  }
}
===== ./map/world/countries/tunisia.json =====

{
  "id": "tun",
  "name": "Tunisia",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/oman.json =====

{
  "id": "omn",
  "name": "Oman",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/tuvalu.json =====

{
  "id": "tuv",
  "name": "Tuvalu",
  "continent": "oceania",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/azerbaijan.json =====

{
  "id": "aze",
  "name": "Azerbaijan",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/nepal.json =====

{
  "id": "npl",
  "name": "Nepal",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/rwanda.json =====

{
  "id": "rwa",
  "name": "Rwanda",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/mongolia.json =====

{
  "id": "mng",
  "name": "Mongolia",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/timor-leste-east-timor.json =====

{
  "id": "tls",
  "name": "Timor-Leste (East Timor)",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/zimbabwe.json =====

{
  "id": "zwe",
  "name": "Zimbabwe",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/namibia.json =====

{
  "id": "nam",
  "name": "Namibia",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/turkey.json =====

{
  "id": "tur",
  "name": "Turkey",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/cabo-verde.json =====

{
  "id": "cpv",
  "name": "Cabo Verde",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/monaco.json =====

{
  "id": "mco",
  "name": "Monaco",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/south-sudan.json =====

{
  "id": "ssd",
  "name": "South Sudan",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/tanzania.json =====

{
  "id": "tza",
  "name": "Tanzania",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/yemen.json =====

{
  "id": "yem",
  "name": "Yemen",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/kosovo.json =====

{
  "id": "kos",
  "name": "Kosovo",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/cambodia.json =====

{
  "id": "khm",
  "name": "Cambodia",
  "continent": "asia",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/central-african-republic.json =====

{
  "id": "caf",
  "name": "Central African Republic",
  "continent": "africa",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/countries/norway.json =====

{
  "id": "nor",
  "name": "Norway",
  "continent": "europe",
  "metadata": {
    "created_at": "2025-11-14",
    "updated_at": null
  },
  "government": {
    "leader": null,
    "ministers": [],
    "system": null
  },
  "population": {
    "value": 0,
    "growth_rate": 0
  },
  "economy": {
    "gdp": 0,
    "resources": {}
  },
  "military": {
    "active": 0,
    "reserve": 0,
    "equipment": {}
  },
  "geography": {
    "area_km2": 0,
    "major_cities": [],
    "climate_zones": [],
    "borders": []
  },
  "status": {
    "occupied": false,
    "contested": false
  },
  "war": {
    "atWar": false,
    "wars": [],
    "warExhaustion": 0
  }
}

===== ./map/world/south_america.json =====

{
  "name": "South America",
  "slug": "south_america",
  "type": "continent",
  "version": "1.0",
  "last_update": "2025-11-01T00:00:00Z",
  "meta": {
    "source": "WorldConflict-minimal",
    "auto_generated": false
  },
  "statistics": {
    "population_estimate": null,
    "area_km2": null
  },
  "geography": {
    "hemisphere": "Sud (partiellement Nord)"
  },
  "economy": {
    "gdp_estimate_usd": null
  },
  "politics": {
    "note": null
  },
  "structure": {
    "continent_dir": "map/world/south_america",
    "country_files": "map/world/south_america/*.json"
  }
}

===== ./map/world.json =====

{
  "name": "WorldConflict — World Map",
  "version": "1.0",
  "generated_by": "assistant",
  "last_update": "2025-11-01T00:00:00Z",
  "description": "Fichier racine contenant les métadonnées globales du monde et l'index des continents. Les données détaillées se trouvent dans map/world/{continent}.json et sous-dossiers.",
  "statistics": {
    "total_population_estimate": 8150000000,
    "total_area_km2": 510072000,
    "total_countries_estimate": 195,
    "continents_count": 6
  },
  "continents_index": {
    "Europe": {
      "file": "world/europe.json",
      "population_estimate": 750000000,
      "area_km2": 10180000,
      "countries_count_estimate": 44
    },
    "Asia": {
      "file": "world/asia.json",
      "population_estimate": 4650000000,
      "area_km2": 44579000,
      "countries_count_estimate": 50
    },
    "Africa": {
      "file": "world/africa.json",
      "population_estimate": 1400000000,
      "area_km2": 30370000,
      "countries_count_estimate": 54
    },
    "Americas": {
      "file": "world/americas.json",
      "population_estimate": 1050000000,
      "area_km2": 42000000,
      "countries_count_estimate": 35
    },
    "Oceania": {
      "file": "world/oceania.json",
      "population_estimate": 43000000,
      "area_km2": 8600000,
      "countries_count_estimate": 14
    },
    "Antarctica": {
      "file": "world/antarctica.json",
      "population_estimate": 0,
      "area_km2": 14000000,
      "countries_count_estimate": 0
    }
  },
  "structure": {
    "root_dir": "map",
    "world_dir": "map/world",
    "levels": [
      "continent",
      "country",
      "region",
      "city",
      "district",
      "building"
    ],
    "file_naming_convention": "{level}/{name}.json (ex: world/europe.json, world/europe/france.json, world/europe/france/ile-de-france.json)"
  },
  "defaults": {
    "coord_system": "WGS84",
    "time_zone_default": "UTC",
    "currency_reference": "USD",
    "date_format": "YYYY-MM-DDTHH:mm:ssZ"
  },
  "behavior_notes": {
    "lazy_load": "Client/serveur doit charger seulement les fichiers nécessaires (continent -> country -> region) pour économiser mémoire.",
    "dynamic_updates": "Les fichiers JSON sont modifiables par le moteur (/engine). Chaque changement doit écrire un champ last_update avec horodatage ISO.",
    "authority": "Les entités (pays, régions) pourront avoir un champ 'authority' pointant vers un user id (ex: dirigeant) ou null.",
    "security": "Ne jamais exposer les endpoints de modification sans authentification serveur. En local prototype, engine écrit directement dans map/*."
  },
  "example_usage": {
    "get_continent_file": "map/world/europe.json",
    "get_country_file": "map/world/europe/france.json",
    "get_region_file": "map/world/europe/france/ile-de-france.json"
  },
  "notes_for_dev": {
    "create_script_suggestion": "Un script Node (setup_map.js) peut générer l'arborescence initiale et des fichiers exemples pour chaque continent.",
    "engine_integration": "Les scripts de l'engine doivent valider et verrouiller les fichiers avant écriture pour éviter les corruptions concurrentes."
  }
}

===== ./rules.js =====

(() => {
  // Insert current year
  const year = document.getElementById('year');
  if (year) year.textContent = new Date().getFullYear();

  // Print button
  const printBtn = document.getElementById('printBtn');
  if (printBtn) {
    printBtn.addEventListener('click', () => {
      window.print();
    });
  }

  // Build TOC from sections (h3 inside .section)
  const tocList = document.getElementById('tocList');
  const content = document.getElementById('rulesContent');
  if (tocList && content) {
    const sections = Array.from(content.querySelectorAll('.section'));
    sections.forEach((sec, index) => {
      const h3 = sec.querySelector('h3');
      if (!h3) return;
      // ensure id exists
      if (!sec.id) {
        sec.id = 'section-' + (index + 1);
      }
      const title = h3.textContent.trim();
      const a = document.createElement('a');
      a.href = '#' + sec.id;
      a.textContent = title;
      a.addEventListener('click', (e) => {
        // smooth scroll + focus
        e.preventDefault();
        const el = document.getElementById(sec.id);
        if (el) {
          window.history.replaceState(null, '', '#' + sec.id);
          el.scrollIntoView({ behavior: 'smooth', block: 'start' });
          el.setAttribute('tabindex', '-1');
          el.focus({ preventScroll: true });
        }
      });
      tocList.appendChild(a);
    });
  }

  // Lightweight search/filter for the rules (client-side)
  const searchInput = document.getElementById('rulesSearch');
  if (searchInput && content) {
    const sections = Array.from(content.querySelectorAll('.section'));
    let lastTimer = null;

    function normalizeText(s) {
      return (s || '').toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu, '');
    }

    searchInput.addEventListener('input', (e) => {
      const q = normalizeText(e.target.value.trim());
      if (lastTimer) clearTimeout(lastTimer);
      lastTimer = setTimeout(() => {
        if (!q) {
          sections.forEach(s => { s.style.display = ''; });
          return;
        }
        sections.forEach(s => {
          const text = normalizeText(s.textContent || '');
          s.style.display = text.includes(q) ? '' : 'none';
        });
      }, 160);
    });
  }

  // Accessibility: allow keyboard navigation in TOC
  if (tocList) {
    tocList.addEventListener('keydown', (e) => {
      const items = Array.from(tocList.querySelectorAll('a'));
      const idx = items.indexOf(document.activeElement);
      if (e.key === 'ArrowDown') {
        e.preventDefault();
        const next = items[Math.min(items.length - 1, Math.max(0, idx + 1))];
        next?.focus();
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        const prev = items[Math.max(0, idx - 1)];
        prev?.focus();
      }
    });
  }

})();

===== ./register.css =====

:root {
  --bg: #0b1020;
  --surface: #0f1724;
  --muted: #9aa4b2;
  --accent1: #4f46e5;
  --accent2: #06b6d4;
  --glass: rgba(255,255,255,0.04);
  --card-shadow: 0 8px 26px rgba(2,6,23,0.6);
  --radius: 12px;
  --radius-sm: 10px;
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg);
  color: #e6eef8;
  font-family: inherit;
}

.register-container {
  width: 100%;
  max-width: 420px;
  padding: 20px;
}

.register-box {
  background: var(--surface);
  border-radius: var(--radius);
  padding: 30px;
  box-shadow: var(--card-shadow);
}

h1 {
  text-align: center;
  font-size: 1.8em;
  color: #fff;
  margin-bottom: 25px;
}

form { display: flex; flex-direction: column; gap: 15px; }

label { font-size: 0.9em; color: var(--muted); }
input {
  background: var(--glass);
  border: 1px solid rgba(255,255,255,0.03);
  color: inherit;
  padding: 10px;
  border-radius: var(--radius-sm);
  outline: none;
}
input:focus { border-color: rgba(79,70,229,0.6); }

.password-box { display: flex; align-items: center; gap: 8px; }
.password-box input { flex: 1; }
.password-box button { background: none; border: none; color: var(--muted); cursor: pointer; font-size: 1.2em; }
.password-box button:hover { color: #fff; }

.btn.primary {
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  border: none;
  color: #fff;
  padding: 12px;
  font-size: 1em;
  border-radius: var(--radius-sm);
  cursor: pointer;
}

.btn.primary:hover { opacity: 0.9; }

.back-login { text-align: center; margin-top: 10px; font-size: 0.9em; }
.back-login a { color: var(--accent2); text-decoration: none; }
.back-login a:hover { text-decoration: underline; }

footer { text-align: center; color: var(--muted); font-size: 0.8em; margin-top: 15px; }

@media (max-width: 480px) { .register-box { padding: 20px; } h1 { font-size: 1.5em; } }
.rules-link { color: var(--accent2); text-decoration: underline; }
.rules-link:hover { color: #00cfff; }

===== ./.js =====

import fs from 'fs';
import path from 'path';

const continents = ['africa','asia','europe','north_america','south_america','oceania'];
const basePath = path.join('.', 'map', 'world');
const countriesDir = path.join(basePath, 'countries');

if (!fs.existsSync(countriesDir)) fs.mkdirSync(countriesDir);

for (const continent of continents) {
  const continentDir = path.join(basePath, continent);
  if (!fs.existsSync(continentDir)) continue;

  const files = fs.readdirSync(continentDir);
  for (const file of files) {
    if (file.endsWith('.json')) {
      const src = path.join(continentDir, file);
      const dest = path.join(countriesDir, file);
      fs.renameSync(src, dest);
      console.log(`Déplacé ${file}`);
    }
  }
}
console.log('Migration terminée.');

===== ./profile.css =====

/* profile.css — page profil publique (style cohérent) */

.container { max-width:900px; margin:18px auto; padding:0 16px; }

.pc-header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
.icon-btn { display:inline-flex; align-items:center; justify-content:center; width:44px; height:44px; border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.004)); border:1px solid rgba(255,255,255,0.03); font-size:18px; cursor:pointer; text-decoration:none; color:var(--text); }
.pc-title { font-weight:800; font-size:18px; color:var(--text); }

/* main card */
.pc-main { display:flex; justify-content:center; }
.card.profile-card { width:100%; max-width:760px; padding:18px; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.003)); border:1px solid rgba(255,255,255,0.03); box-shadow: var(--card-shadow); }

/* header area */
.profile-top { display:flex; gap:16px; align-items:center; margin-bottom:14px; }
.avatar { width:96px; height:96px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-weight:800; font-size:26px; background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:#fff; }
.avatar-xl { width:110px; height:110px; border-radius:14px; font-size:30px; }
.profile-meta h1 { margin:0; font-size:20px; }
.profile-meta .muted { color:var(--muted); margin-top:6px; }
.profile-actions { margin-top:8px; display:flex; gap:8px; }
.btn { padding:8px 12px; border-radius:10px; font-weight:700; cursor:pointer; border:0; }
.btn-ghost { background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--text); }
.small { padding:6px 8px; font-size:13px; border-radius:8px; }

/* body */
.profile-body { margin-top:8px; }
.profile-grid { display:grid; grid-template-columns:repeat(2, 1fr); gap:10px; }
.profile-grid dt { color:var(--muted); font-size:13px; }
.profile-grid dd { margin:4px 0 10px 0; font-weight:700; }

.bottom-nav { position:fixed; left:0; right:0; bottom:18px; display:flex; justify-content:center; gap:10px; z-index:60; pointer-events:auto; }
.nav-btn { min-width:84px; height:48px; border-radius:12px; border:1px solid rgba(255,255,255,0.03); background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.004)); color:var(--muted); padding:8px 12px; font-weight:700; cursor:pointer; }
.nav-btn.active { color:#fff; background: linear-gradient(90deg,var(--accent1),var(--accent2)); transform:translateY(-3px); box-shadow: 0 14px 32px rgba(79,70,229,0.18); }
@media (max-width:700px) {
  .profile-grid { grid-template-columns: 1fr; }
  .avatar { width:86px; height:86px; font-size:22px; }
}

===== ./utils.js =====

// utils.js — petites fonctions utilitaires globales (non-module)
// Version améliorée : non-destructive (fusionne dans window.WC), support JSON auto,
// timeout via AbortController, et helper pour token d'auth.
(function (global) {
  // reuse existing WC if present to avoid overwrite
  const WC = Object.assign({}, global.WC || {});

  // affiche l'année dans un élément (id)
  WC.showYear = function (id) {
    const el = document.getElementById(id);
    if (el) el.textContent = new Date().getFullYear();
  };

  // toggle password field by id
  WC.togglePassword = function (inputId) {
    const input = document.getElementById(inputId);
    if (!input) return;
    input.type = input.type === 'password' ? 'text' : 'password';
  };

  // message inline (element or id expected)
  WC.showMessage = function (elOrId, text, type = 'error', timeout = 4000) {
    let el = typeof elOrId === 'string' ? document.getElementById(elOrId) : elOrId;
    if (!el) return;
    el.textContent = text;
    el.classList.remove('msg-error', 'msg-success', 'msg-info');
    el.classList.add(type === 'success' ? 'msg-success' : type === 'info' ? 'msg-info' : 'msg-error');
    if (timeout) {
      setTimeout(() => {
        if (el) el.textContent = '';
      }, timeout);
    }
  };

  // bouton loading state (element or node) — bascule texte
  WC.setBtnLoading = function (btn, loading, textWhenLoading = 'En cours…', restoreText = null) {
    if (!btn) return;
    if (loading) {
      if (!btn.dataset._orig) btn.dataset._orig = btn.textContent;
      btn.disabled = true;
      btn.textContent = textWhenLoading;
    } else {
      btn.disabled = false;
      btn.textContent = restoreText || btn.dataset._orig || btn.textContent;
      delete btn.dataset._orig;
    }
  };

  // simple auth token helper (Authorization: Bearer <token>)
  WC._authToken = WC._authToken || null;
  WC.setAuthToken = function (token) {
    WC._authToken = token;
  };
  WC.clearAuthToken = function () {
    WC._authToken = null;
  };
  WC.getAuthToken = function () {
    return WC._authToken;
  };

  // wrapper fetch pour JSON, renvoie { ok, status, data, error }
  // opts supports: method, headers, body, credentials, timeout (ms), signal, skipJsonAuto (bool)
  WC.apiFetch = async function (url, opts = {}) {
    const finalOpts = Object.assign({}, opts);
    finalOpts.credentials = finalOpts.credentials || 'same-origin';
    finalOpts.headers = Object.assign({}, finalOpts.headers || {});

    // attach auth token if provided and no Authorization header set
    if (WC._authToken && !finalOpts.headers.Authorization && !finalOpts.headers.authorization) {
      finalOpts.headers.Authorization = 'Bearer ' + WC._authToken;
    }

    // automatic JSON stringify when body is a plain object and not FormData
    if (finalOpts.body && typeof finalOpts.body === 'object' && !(finalOpts.body instanceof FormData) && !finalOpts.skipJsonAuto) {
      if (!finalOpts.headers['Content-Type'] && !finalOpts.headers['content-type']) {
        finalOpts.headers['Content-Type'] = 'application/json';
      }
      // if Content-Type indicates JSON, stringify
      const ct = (finalOpts.headers['Content-Type'] || finalOpts.headers['content-type'] || '').toLowerCase();
      if (ct.includes('application/json')) {
        try {
          finalOpts.body = JSON.stringify(finalOpts.body);
        } catch (e) {
          return { ok: false, status: 0, error: 'Failed to serialize request body' };
        }
      }
    }

    // support timeout via AbortController (opts.timeout in ms)
    let controller;
    let timeoutId;
    if (typeof finalOpts.timeout === 'number' && finalOpts.timeout > 0) {
      controller = new AbortController();
      finalOpts.signal = controller.signal;
      timeoutId = setTimeout(() => controller.abort(), finalOpts.timeout);
      // remove timeout property so fetch doesn't get confused
      delete finalOpts.timeout;
    }

    try {
      const r = await fetch(url, finalOpts);
      if (timeoutId) clearTimeout(timeoutId);

      const ct = r.headers.get('content-type') || '';
      let body = null;
      // handle 204 No Content
      if (r.status === 204) body = null;
      else if (ct.includes('application/json')) {
        try { body = await r.json(); }
        catch (e) { body = null; }
      } else {
        try { body = await r.text(); } catch (e) { body = null; }
      }

      if (!r.ok) {
        const err = body && body.error ? body.error : (typeof body === 'string' ? body : 'Erreur');
        return { ok: false, status: r.status, data: body, error: err };
      }
      return { ok: true, status: r.status, data: body };
    } catch (err) {
      // Aborted?
      if (err && err.name === 'AbortError') {
        return { ok: false, status: 0, error: 'Request timeout' };
      }
      return { ok: false, status: 0, error: err && err.message ? err.message : 'Network error' };
    }
  };

  // require session (client-side redirect helper) : hits /api/session and redirects to index if not ok
  WC.requireSessionOrRedirect = async function (redirectTo = 'index.html') {
    try {
      const r = await WC.apiFetch('/api/session', { method: 'GET' });
      if (!r.ok || !r.data || !r.data.ok) {
        window.location.href = redirectTo;
        return false;
      }
      return r.data;
    } catch (e) {
      window.location.href = redirectTo;
      return false;
    }
  };

  // expose/merge into global (do not overwrite other properties)
  global.WC = Object.assign({}, global.WC || {}, WC);
})(window);

===== ./index.css =====

:root {
  --bg: #0b1020;
  --surface: #0f1724;
  --muted: #9aa4b2;
  --accent1: #4f46e5;
  --accent2: #06b6d4;
  --glass: rgba(255,255,255,0.04);
  --card-shadow: 0 8px 26px rgba(2,6,23,0.6);
  --radius: 12px;
  --radius-sm: 10px;
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

html, body { height: 100%; background: var(--bg); color: #e6eef8; font-family: inherit; }

body {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 32px;
}

.app {
  width: 100%;
  max-width: 1100px;
  display: grid;
  grid-template-columns: 1fr 420px;
  gap: 32px;
  align-items: center;
}

/* HERO / left */
.hero {
  padding: 28px;
  border-radius: var(--radius);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent 30%);
  box-shadow: var(--card-shadow);
  min-height: 480px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.brand { display: flex; gap: 18px; align-items: center; }
.logo { width: 72px; height: 72px; border-radius: 12px; }
.brand-text h1 { margin: 0; font-size: 22px; }
.tag { margin: 4px 0 0; color: var(--muted); font-size: 13px; }

.hero-illustration { display: flex; justify-content: center; align-items: center; margin-top: 24px; }
.cards { position: relative; width: 100%; height: 260px; display: flex; align-items: center; justify-content: center; }
.card { position: absolute; width: 80%; height: 68%; border-radius: var(--radius); box-shadow: var(--card-shadow); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); backdrop-filter: blur(6px); }
.card-1 { transform: rotate(-6deg) translateX(-8%); }
.card-2 { transform: rotate(4deg) translateX(6%); width: 86%; height: 74%; }
.card-3 { transform: rotate(-2deg) translateY(18%); width: 72%; height: 60%; opacity: 0.95; }

/* AUTH / right */
.auth { display: flex; flex-direction: column; align-items: stretch; }
.card.form {
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius: var(--radius-sm);
  padding: 22px;
  box-shadow: var(--card-shadow);
}
.card.form h2 { margin: 4px 0 4px; }
.muted { color: var(--muted); font-size: 13px; }
.field { display: block; margin-top: 14px; }
.field .label { display: block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
.field input {
  width: 100%;
  padding: 12px 14px;
  border-radius: var(--radius-sm);
  background: var(--glass);
  border: 1px solid rgba(255,255,255,0.03);
  color: inherit;
  font-size: 15px;
}
.field input:focus { outline: none; border-color: rgba(79,70,229,0.6); box-shadow: 0 6px 18px rgba(79,70,229,0.06); }
.passwrap { display: flex; align-items: center; gap: 8px; }
.passwrap input { flex: 1; }
#togglePassword { background: transparent; border: 0; padding: 8px; border-radius: 8px; cursor: pointer; font-size: 14px; }
#togglePassword:focus { outline: 2px solid rgba(79,70,229,0.18); }

/* Rows, checkboxes, links */
.row { display: flex; align-items: center; margin-top: 12px; }
.row.between { justify-content: space-between; }
.checkbox { display: flex; align-items: center; gap: 8px; color: var(--muted); font-size: 14px; }
.checkbox input { width: 16px; height: 16px; }
.link { color: var(--muted); text-decoration: none; font-size: 14px; }
.link:hover { text-decoration: underline; }

/* Buttons */
.btn { width: 100%; padding: 12px 14px; border-radius: var(--radius); border: 0; font-weight: 600; font-size: 15px; margin-top: 14px; cursor: pointer; }
.btn.primary { background: linear-gradient(90deg, var(--accent1), var(--accent2)); box-shadow: 0 8px 24px rgba(6,11,41,0.45); color: white; }
.btn.ghost { background: transparent; border: 1px solid rgba(255,255,255,0.04); color: var(--muted); }

.sep { display: flex; align-items: center; gap: 12px; margin-top: 12px; }
.sep::before, .sep::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.03), transparent); }
.sep span { padding: 0 10px; color: var(--muted); font-size: 13px; }

.meta { margin-top: 12px; font-size: 12px; color: var(--muted); }
.legal { margin-top: 18px; text-align: right; color: var(--muted); font-size: 13px; }

/* Responsive */
@media (max-width:980px){ .app{ grid-template-columns: 1fr; max-width: 720px; } .hero{ order:2; } .auth{ order:1; } .hero-illustration{ display:none; } }
@media (max-width:420px){ body{padding:18px} .card.form{padding:16px} }

===== ./join-rp.css =====

/* join-rp.css — style pro pour Rejoindre le RP (utilise variables.css)
   Ajouts: animations, modal, clear button visible, améliorations responsive
*/

/* existing base classes preserved — only additions / small overrides */
.join-card {
  padding: 26px;
  border-radius: var(--radius);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
  box-shadow: var(--card-shadow);
  transition: transform .12s ease, box-shadow .12s ease;
}

/* slight lift on hover to feel interactive */
.join-card:hover { transform: translateY(-3px); box-shadow: 0 12px 30px rgba(0,0,0,0.06); }

.card-header { display:flex; justify-content:space-between; align-items:flex-start; gap:12px; margin-bottom:14px; }
.card-header h1 { margin:0; font-size:20px; }
.sub { margin-top:6px; font-size:13px; color:var(--muted); }

/* form controls (kept, minor polish) */
.label { display:block; margin-bottom:6px; font-size:13px; color:var(--muted); font-weight:600; }
.text-input, .select {
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  background:var(--glass);
  border:1px solid rgba(255,255,255,0.035);
  color:var(--text);
  font-size:14px;
  transition: box-shadow .18s ease, border-color .18s ease, transform .12s ease;
}
.text-input:focus, .select:focus {
  outline:none;
  border-color: rgba(79,70,229,0.6);
  box-shadow: 0 8px 24px rgba(79,70,229,0.06);
  transform: translateY(-1px);
}

.form { display:flex; flex-direction:column; gap:12px; }
.row { display:flex; flex-direction:column; gap:6px; }
.form-actions { display:flex; justify-content:space-between; align-items:center; margin-top:14px; gap:12px; }
.actions-right { display:flex; gap:10px; }

/* Buttons */
.btn { padding:9px 14px; border-radius:10px; cursor:pointer; font-weight:600; border:0; user-select:none; }
.btn.ghost { background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.02); }
.btn.primary { background: linear-gradient(90deg, var(--accent1), var(--accent2)); color:#fff; box-shadow: 0 6px 18px rgba(79,70,229,0.12); }

/* small / clear variants */
.btn.ghost.small { padding:6px 8px; font-size:13px; }
.clear-btn { height:34px; min-width:34px; padding:0; display:inline-flex; align-items:center; justify-content:center; border-radius:8px; border:1px solid rgba(255,255,255,0.03); background:transparent; color:var(--muted); font-size:14px; cursor:pointer; }

/* disabled */
button[disabled], .btn[aria-disabled="true"] { opacity:0.6; cursor:not-allowed; pointer-events:none; }

/* preview */
.country-preview {
  display:flex;
  gap:12px;
  padding:12px;
  border-radius:10px;
  background:rgba(255,255,255,0.01);
  border:1px solid rgba(255,255,255,0.03);
  align-items:flex-start;
  transition: transform .16s ease, opacity .16s ease;
  transform-origin: top left;
}
.country-preview.hidden { opacity:0; height:0; overflow:hidden; padding:0; margin:0; border:0; transition: height .2s ease, opacity .16s ease; }
.country-preview.visible { opacity:1; transform: translateY(0); }

/* left flag */
.cp-left { width:64px; display:flex; align-items:center; justify-content:center; }
.cp-flag { width:64px; height:42px; display:flex; align-items:center; justify-content:center; font-size:28px; border-radius:8px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); }

/* right content */
.cp-name { font-weight:700; font-size:16px; }
.cp-meta { font-size:13px; color:var(--muted); margin-bottom:8px; }
.cp-desc { font-size:13px; color:var(--muted); margin-top:4px; max-width:560px; }
.cp-stats-row { display:flex; gap:10px; margin-top:8px; color:var(--muted); font-size:13px; }

/* small helper */
.cp-stat { background:transparent; padding:4px 8px; border-radius:8px; border:1px solid rgba(255,255,255,0.02); font-size:12px; color:var(--muted); }

/* loader + spinner */
.loader { display:flex; align-items:center; gap:8px; color:var(--muted); font-size:14px; }
.spinner { width:14px; height:14px; border-radius:50%; border:2px solid rgba(255,255,255,0.12); border-top-color: rgba(255,255,255,0.6); animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

/* messages */
.msg { font-size:0.95rem; padding:8px 10px; border-radius:8px; margin-top:4px; min-height:1.5em; }
.msg-error { background: rgba(255,40,40,0.06); color: #ffb3b3; border: 1px solid rgba(255,40,40,0.08); }
.msg-success { background: rgba(40,255,120,0.04); color: #bfffd6; border: 1px solid rgba(40,255,120,0.06); }
.msg-info { background: rgba(96,165,250,0.04); color: #dbe9ff; border: 1px solid rgba(96,165,250,0.06); }

/* search input style */
.search-wrap { position: relative; display:flex; align-items:center; gap:8px; }
.search-input {
  width:100%;
  padding: 10px 40px 10px 40px;
  border-radius: 10px;
  background: linear-gradient(180deg, rgba(255,255,255,0.006), rgba(255,255,255,0.003));
  border: 1px solid rgba(255,255,255,0.03);
  color: var(--text);
  font-size: 14px;
  outline: none;
  transition: box-shadow 160ms ease, border-color 160ms ease;
  background-image: url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23AAB7C9' d='M21.53 20.47l-4.82-4.82a7 7 0 10-1.06 1.06l4.82 4.82a.75.75 0 101.06-1.06zM5.5 10.5a5 5 0 1110 0 5 5 0 01-10 0z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: 12px center;
  background-size: 16px 16px;
}
.search-input::placeholder { color: rgba(170,183,201,0.6); font-style: italic; }
.search-input:focus { box-shadow: 0 6px 18px rgba(79,70,229,0.06); border-color: rgba(79,70,229,0.6); }

/* country card hover */
.country-card { transition: transform .15s ease, background .2s ease; }
.country-card:hover { transform: translateY(-4px); background: rgba(255,255,255,0.05); }
.country-card.selected { border: 2px solid #5588ff; background: rgba(85,136,255,0.1); }

/* small responsive tweaks */
@media (max-width:900px) {
  .card-header { flex-direction:column; align-items:flex-start; gap:8px; }
  .cp-desc { max-width: 100%; }
}

/* Modal (confirmation) — minimal, uses same visual language */
.modal {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(6,8,12,0.6);
  z-index: 1200;
  opacity: 0;
  pointer-events: none;
  transition: opacity .15s ease;
}
.modal.open { opacity:1; pointer-events:auto; }
.modal-box {
  width: min(520px, calc(100% - 40px));
  background: var(--panel-bg, #0f1724);
  border-radius: 14px;
  padding: 18px;
  box-shadow: 0 30px 80px rgba(0,0,0,0.6);
  border: 1px solid rgba(255,255,255,0.02);
}
.modal-actions { display:flex; justify-content:flex-end; gap:10px; margin-top:14px; }

===== ./server.js =====

// server.js (ESM) — backend amélioré & plus professionnel (dev)
import express from "express";
import bodyParser from "body-parser";
import session from "express-session";
import path from "path";
import { fileURLToPath } from "url";
import fs from "fs/promises";
import fsSync from "fs";
import crypto from "crypto";
import marketApi from './economy/market_api.js';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const DATA_DIR = path.join(__dirname, "data");
const USERS_FILE = path.join(DATA_DIR, "users.json");

const app = express();
app.use('/api/market', marketApi);
const PORT = process.env.PORT || 3000;
const SESSION_SECRET = process.env.SESSION_SECRET || "dev-worldconflict-secret";

// small rate limiter (in-memory)
const rate = {
  login: new Map(), // ip -> { count, firstAt }
  checkEmail: new Map(),
};
const RATE_LIMIT_WINDOW_MS = 10 * 60 * 1000; // 10 min
const RATE_LIMIT_MAX = { login: 8, checkEmail: 30 };

function checkRate(map, ip, max) {
  const now = Date.now();
  const entry = map.get(ip) || { count: 0, firstAt: now };
  if (now - entry.firstAt > RATE_LIMIT_WINDOW_MS) {
    entry.count = 1;
    entry.firstAt = now;
    map.set(ip, entry);
    return true;
  }
  entry.count++;
  map.set(ip, entry);
  return entry.count <= max;
}

// utils
const normalize = (s) => (typeof s === "string" ? s.trim().toLowerCase() : "");
const safeTrim = (s, max = 200) => (typeof s === "string" ? s.trim().slice(0, max) : "");
const hashPwd = (p) => crypto.createHash("sha256").update(String(p)).digest("hex");

// persistence helpers
async function ensureDataDir() {
  if (!fsSync.existsSync(DATA_DIR)) {
    await fs.mkdir(DATA_DIR, { recursive: true });
  }
}
let users = [];
async function loadUsers() {
  try {
    await ensureDataDir();
    if (!fsSync.existsSync(USERS_FILE)) {
      users = [];
      await fs.writeFile(USERS_FILE, JSON.stringify(users, null, 2), "utf8");
      return;
    }
    const txt = await fs.readFile(USERS_FILE, "utf8");
    users = JSON.parse(txt || "[]");
  } catch (e) {
    console.error("loadUsers failed:", e);
    users = [];
  }
}
async function saveUsers() {
  try {
    await ensureDataDir();
    await fs.writeFile(USERS_FILE, JSON.stringify(users, null, 2), "utf8");
  } catch (e) {
    console.error("saveUsers failed:", e);
  }
}

await loadUsers();

function findUserByEmail(email) {
  if (!email) return null;
  const n = normalize(email);
  return users.find((u) => normalize(u.email) === n) || null;
}
function findUserByUsername(username) {
  if (!username) return null;
  const n = normalize(username);
  return users.find((u) => normalize(u.username) === n) || null;
}
function findUserByLogin(id) {
  if (!id) return null;
  const n = normalize(id);
  return users.find((u) => normalize(u.username) === n || normalize(u.email) === n) || null;
}

// middlewares
app.use(bodyParser.json({ limit: "2mb" }));
app.use(bodyParser.urlencoded({ extended: true }));
app.use(
  session({
    name: "wc_sid",
    secret: SESSION_SECRET,
    resave: false,
    saveUninitialized: false,
    cookie: {
      secure: process.env.NODE_ENV === "production",
      httpOnly: true,
      sameSite: "lax",
      maxAge: 1000 * 60 * 60 * 24,
    },
  })
);

app.use(express.static(__dirname));

// --- /api/countries (cache en mémoire après 1ère lecture) ---
let countriesCache = null;
async function buildCountriesCache() {
  try {
    const worldDir = path.join(__dirname, "map", "world");
    const dirEntries = await fs.readdir(worldDir, { withFileTypes: true });
    const continents = dirEntries.filter((d) => d.isDirectory()).map((d) => d.name);
    const list = [];
    for (const cont of continents) {
      const contDir = path.join(worldDir, cont);
      try {
        const files = await fs.readdir(contDir);
        for (const f of files) {
          if (!f.toLowerCase().endsWith(".json")) continue;
          const filePath = path.join(contDir, f);
          let parsed = null;
          try { parsed = JSON.parse(await fs.readFile(filePath, "utf8")); } catch (e) { parsed = null; }
          const id = path.basename(f, ".json");
          const name = (parsed && (parsed.name || parsed.common)) || id;
          list.push({
            id,
            name,
            file: `/map/world/${cont}/${f}`,
            continent: cont,
            meta: parsed && parsed.meta ? parsed.meta : null,
            last_update: parsed && parsed.last_update ? parsed.last_update : null,
          });
        }
      } catch (e) {
        // ignore per-continent errors
      }
    }
    // sort alpha
    list.sort((a, b) => (a.name || a.id).localeCompare(b.name || b.id));
    countriesCache = list;
  } catch (err) {
    console.error("buildCountriesCache failed:", err);
    countriesCache = [];
  }
}
await buildCountriesCache();

// ---------- API ----------
app.get("/api/countries", (req, res) => {
  try {
    if (!countriesCache) {
      return res.json({ ok: true, countries: [] });
    }
    return res.json({ ok: true, countries: countriesCache });
  } catch (err) {
    console.error("GET /api/countries error:", err);
    return res.status(500).json({ ok: false, error: "Impossible de récupérer la liste des pays" });
  }
});

// check-email with basic rate limiting
app.post("/api/check-email", (req, res) => {
  try {
    const ip = req.ip || req.headers["x-forwarded-for"] || "unknown";
    if (!checkRate(rate.checkEmail, ip, RATE_LIMIT_MAX.checkEmail)) {
      return res.status(429).json({ ok: false, error: "Trop de requêtes, réessaye plus tard" });
    }
    const email = safeTrim(req.body?.email || "", 200);
    if (!email || !email.includes("@")) return res.status(400).json({ ok: false, error: "Email invalide" });
    const exists = !!findUserByEmail(email);
    return res.json({ ok: true, available: !exists });
  } catch (err) {
    console.error("POST /api/check-email:", err);
    return res.status(500).json({ ok: false, error: "Erreur serveur" });
  }
});

// register
app.post("/api/register", async (req, res) => {
  try {
    const username = safeTrim(req.body?.username || "", 60);
    const email = safeTrim(req.body?.email || "", 200);
    const password = String(req.body?.password || "");
    if (!username || !email || !password) return res.status(400).json({ ok: false, error: "Champs manquants" });

    if (findUserByEmail(email)) return res.json({ ok: false, error: "Email déjà utilisé" });
    if (findUserByUsername(username)) return res.json({ ok: false, error: "Nom d’utilisateur déjà pris" });

    const user = {
      username,
      email,
      password: hashPwd(password),
      rp: { joined: false },
      createdAt: new Date().toISOString(),
    };
    users.push(user);
    await saveUsers();

    req.session.user = { username: user.username, email: user.email };
    return res.json({ ok: true });
  } catch (err) {
    console.error("POST /api/register error:", err);
    return res.status(500).json({ ok: false, error: "Erreur serveur" });
  }
});

// login with rate limiting
app.post("/api/login", async (req, res) => {
  try {
    const ip = req.ip || req.headers["x-forwarded-for"] || "unknown";
    if (!checkRate(rate.login, ip, RATE_LIMIT_MAX.login)) {
      return res.status(429).json({ ok: false, error: "Trop de tentatives, réessaye plus tard" });
    }

    const userId = safeTrim(req.body?.user || "", 200);
    const password = String(req.body?.password || "");
    if (!userId || !password) return res.status(400).json({ ok: false, error: "Champs manquants" });

    const found = findUserByLogin(userId);
    if (!found || found.password !== hashPwd(password)) {
      return res.status(401).json({ ok: false, error: "Identifiants invalides" });
    }

    req.session.user = { username: found.username, email: found.email };
    return res.json({ ok: true, username: found.username, rp: found.rp });
  } catch (err) {
    console.error("POST /api/login error:", err);
    return res.status(500).json({ ok: false, error: "Erreur serveur" });
  }
});

// logout
app.post("/api/logout", (req, res) => {
  try {
    req.session.destroy((err) => {
      if (err) {
        console.warn("session destroy err", err);
        return res.status(500).json({ ok: false, error: "Erreur lors de la déconnexion" });
      }
      res.clearCookie("wc_sid");
      return res.json({ ok: true });
    });
  } catch (err) {
    console.error("POST /api/logout:", err);
    return res.status(500).json({ ok: false, error: "Erreur serveur" });
  }
});

// session
app.get("/api/session", (req, res) => {
  try {
    const s = req.session.user;
    if (!s) return res.json({ ok: false });
    const user = findUserByEmail(s.email) || findUserByUsername(s.username) || null;
    return res.json({ ok: true, username: s.username, email: s.email, rp: user?.rp || { joined: false } });
  } catch (err) {
    console.error("GET /api/session:", err);
    return res.status(500).json({ ok: false, error: "Erreur serveur" });
  }
});

// join-rp: logic leader / pending & persistence
app.post("/api/user/join-rp", async (req, res) => {
  try {
    const s = req.session.user;
    if (!s) return res.status(401).json({ ok: false, error: "Non authentifié" });

    const country_id = safeTrim(req.body?.country_id || "", 200);
    const country_name = safeTrim(req.body?.country_name || "", 200) || null;
    const displayName = safeTrim(req.body?.displayName || "", 60) || null;

    if (!country_id) return res.status(400).json({ ok: false, error: "country_id manquant" });

    const user = findUserByEmail(s.email) || findUserByUsername(s.username) || null;
    if (!user) return res.status(404).json({ ok: false, error: "Utilisateur introuvable" });

    // count existing joined users for that country
    const members = users.filter((u) => u.rp && u.rp.joined && String(u.rp.country_id) === String(country_id));
    if (members.length === 0) {
      // assign leader
      user.rp = {
        joined: true,
        country_id: String(country_id),
        country_name,
        role: "leader",
        displayName,
        joinedAt: new Date().toISOString(),
      };
      await saveUsers();
      req.session.user = { username: user.username, email: user.email };
      return res.json({ ok: true, rp: user.rp, assigned: "leader" });
    } else {
      // others -> pending
      user.rp = {
        joined: true,
        country_id: String(country_id),
        country_name,
        role: "pending",
        displayName,
        joinedAt: new Date().toISOString(),
      };
      await saveUsers();
      req.session.user = { username: user.username, email: user.email };
      return res.json({ ok: true, rp: user.rp, next: "/choose-role.html" });
    }
  } catch (err) {
    console.error("POST /api/user/join-rp:", err);
    return res.status(500).json({ ok: false, error: "Erreur serveur" });
  }
});

// assign-role
app.post("/api/user/assign-role", async (req, res) => {
  try {
    const s = req.session.user;
    if (!s) return res.status(401).json({ ok: false, error: "Non authentifié" });
    const role = safeTrim(req.body?.role || "", 40);
    const job = safeTrim(req.body?.job || "", 80) || null;

    const user = findUserByEmail(s.email) || findUserByUsername(s.username) || null;
    if (!user) return res.status(404).json({ ok: false, error: "Utilisateur introuvable" });
    if (!user.rp || !user.rp.joined) return res.status(400).json({ ok: false, error: "Utilisateur n'a pas rejoint le RP" });

    // leader stays leader
    if (user.rp.role === "leader") return res.json({ ok: true, rp: user.rp });

    if (role === "minister" || role === "official") {
      user.rp.role = "official";
      user.rp.job = job;
    } else if (role === "citizen" || role === "civil") {
      user.rp.role = "citizen";
      user.rp.job = job;
    } else {
      return res.status(400).json({ ok: false, error: "role invalide" });
    }

    await saveUsers();
    req.session.user = { username: user.username, email: user.email };
    return res.json({ ok: true, rp: user.rp });
  } catch (err) {
    console.error("POST /api/user/assign-role:", err);
    return res.status(500).json({ ok: false, error: "Erreur serveur" });
  }
});

// fallback for /api
app.use("/api", (req, res) => {
  return res.status(404).json({ ok: false, error: "Route API introuvable", requested: req.originalUrl });
});

// start
app.listen(PORT, () => {
  console.log(`🚀 Backend ESM running on http://localhost:${PORT}`);
  console.log(`Serving static files from: ${__dirname}`);
});

===== ./guerre.css =====

/* guerre.css — styles aligned with project global design
   This file intentionally relies on variables.css only (no hard-coded color fallbacks)
   so it matches the appearance of other pages (market, dashboard, settings, ...).
*/

:root { }

/* Base layout (matches other pages) */
body {
  font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
  background: var(--bg);
  color: var(--text, #111827);
  margin: 0;
}

.shell {
  max-width: 1100px;
  margin: 18px auto;
  padding: 12px;
}

/* Header — use same conventions as other pages */
.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.page-header .title {
  font-size: 20px;
  font-weight: 600;
}

.muted { color: var(--muted); font-size: 13px; }
.mini { font-size: 12px; color: var(--muted); }

.icon-btn { background: none; border: none; font-size: 18px; padding: 6px 8px; cursor: pointer; }

/* Main grid mirrors other pages (list + detail) */
.main-grid {
  display: grid;
  grid-template-columns: 1fr 320px;
  gap: 12px;
}

.panel {
  background: var(--panel-bg);
  border-radius: var(--radius, 12px);
  padding: 14px;
  box-shadow: var(--shadow, 0 6px 18px rgba(20,20,30,0.06));
}

.panel-row { display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:8px; }

.controls { display:flex; gap:8px; align-items:center; }
.controls input {
  border: 1px solid var(--muted-border, #e6e9ef);
  padding: 8px 10px;
  border-radius: 8px;
  min-width: 220px;
  background: var(--input-bg, transparent);
  color: inherit;
}

.btn {
  border: 1px solid transparent;
  padding: 8px 12px;
  border-radius: 10px;
  background: transparent;
  cursor: pointer;
}

.btn-primary {
  background: var(--accent);
  color: var(--on-accent, #fff);
  border-color: rgba(0,0,0,0.03);
}

/* war list items */
.war-list { display:flex; flex-direction:column; gap:10px; min-height:220px; }
.war-item {
  display:flex; justify-content:space-between; align-items:center; gap:12px;
  padding:10px; border-radius:10px; border:1px solid var(--muted-border, #eef2ff); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0));
}
.war-item.selected { outline: 2px solid rgba(37,99,235,0.14); }

.war-meta { display:flex; gap:10px; align-items:center; }
.country-pill { padding:6px 8px; border-radius:8px; background: var(--chip-bg, rgba(0,0,0,0.04)); font-weight:600; font-size:13px; }
.status-badge { padding:6px 8px; border-radius:999px; font-size:12px; font-weight:600; }
.status-active { background: rgba(37,99,235,0.12); color:var(--accent); }
.status-ended { background: rgba(16,185,129,0.12); color:var(--success); }
.status-warning { background: rgba(220,38,38,0.1); color:var(--danger); }

.war-details { margin-top:8px; font-size:14px; color:var(--muted); }
.empty { color: var(--muted); padding:18px; text-align:center; }

.detail-panel .action-row { margin-top:12px; display:flex; gap:8px; }

/* Bottom nav — match structure used across other pages */
.bottom-nav { position:fixed; left:0; right:0; bottom:8px; display:flex; gap:8px; justify-content:center; }
.nav-btn { background:var(--panel-bg); border-radius:10px; padding:8px 12px; border:1px solid var(--muted-border, #eee); }
.nav-btn.active { box-shadow: var(--shadow, 0 6px 18px rgba(0,0,0,0.06)); }

/* Modal overlay (minimal and consistent) */
.modal-overlay {
  position:fixed; inset:0; display:flex; align-items:flex-start; justify-content:center; background:rgba(0,0,0,0.32); padding:24px; z-index:1200;
}

@media (max-width:900px) {
  .main-grid { grid-template-columns: 1fr; }
  .detail-panel { order: 2; }
}

===== ./choose-role.js =====

// choose-role.js — version pro using WC.apiFetch if present
(() => {
  const form = document.getElementById('chooseRoleForm');
  const chooseMsg = document.getElementById('chooseMsg');
  const jobRow = document.getElementById('citizenJobRow');
  const jobSelect = document.getElementById('jobSelect');
  const radios = Array.from(document.querySelectorAll('input[name="role"]'));
  const API = window.WC && typeof window.WC.apiFetch === 'function' ? window.WC.apiFetch : async (u,o)=> {
    const r = await fetch(u,o); const ct=r.headers.get('content-type')||''; const data = ct.includes('application/json')? await r.json() : await r.text(); return r.ok? {ok:true,data}:{ok:false,error:data};
  };

  function setMsg(t='', type='info') {
    if (!chooseMsg) return;
    chooseMsg.textContent = t;
    chooseMsg.classList.remove('msg-error','msg-success','msg-info');
    if (!t) return;
    chooseMsg.classList.add(type==='success'?'msg-success': type==='error'?'msg-error':'msg-info');
  }

  radios.forEach(r => r.addEventListener('change', () => {
    if (r.value === 'citizen' && r.checked) jobRow.classList.remove('hidden'); else jobRow.classList.add('hidden');
  }));

  if (form) form.addEventListener('submit', async (e) => {
    e.preventDefault();
    setMsg('', 'info');
    const roleEl = document.querySelector('input[name="role"]:checked');
    if (!roleEl) { setMsg('Choisis un rôle.', 'error'); return; }
    const role = roleEl.value === 'minister' ? 'minister' : 'citizen';
    const job = (jobSelect.value && jobSelect.value !== 'none') ? jobSelect.value : null;

    try {
      const r = await API('/api/user/assign-role', { method: 'POST', body: JSON.stringify({ role, job }) });
      if (!r.ok) {
        setMsg('Erreur : ' + (r.error || r.data?.error || 'Impossible d\'enregistrer le rôle'), 'error');
        return;
      }
      setMsg('Rôle enregistré — redirection...', 'success');
      setTimeout(()=> window.location.href = 'dashboard.html', 700);
    } catch (err) {
      console.error(err);
      setMsg('Erreur réseau — réessaie plus tard.', 'error');
    }
  });
})();

===== ./economy/countries.js =====

// economy/countries.js
// ES module — index économique léger pour WorldConflict
//
// - Lit map/world/countries/*.json
// - Extrait un "summary" léger par pays (id, name, continent, population, resources, borders)
// - Fournit cache en mémoire + fonctions async/sync pour y accéder
//
// Usage (async):
//   import { loadAll, getCountryById, getAllSummaries } from './economy/countries.js';
//   await loadAll(); // charge/cache
//   const france = await getCountryById('fra');
//   console.log(france.summary);

import fs from 'fs/promises';
import fsSync from 'fs';
import path from 'path';

const COUNTRIES_DIR = path.join('.', 'map', 'world', 'countries');

let _loaded = false;
let _byId = new Map();     // key = country.id (lowercase)
let _byFile = new Map();   // key = file basename (lowercase)

/** --- Helpers --- **/

function _safeLower(s) {
  return (typeof s === 'string' ? s.toLowerCase() : s);
}

function _normalizeResources(res) {
  // Normalise resources to an object: { resourceId: qty }
  if (!res) return {};
  if (Array.isArray(res)) {
    const out = {};
    for (const r of res) {
      if (typeof r === 'string') out[r] = (out[r] || 0) + 1;
      else if (r && typeof r === 'object' && r.id) out[r.id] = (out[r.id] || 0) + (Number(r.qty) || 1);
    }
    return out;
  }
  if (typeof res === 'object') {
    // assume mapping already: copy shallowly and coerce numbers
    const out = {};
    for (const k of Object.keys(res)) {
      const v = res[k];
      out[k] = (v === null || v === undefined) ? 0 : Number(v) || 0;
    }
    return out;
  }
  // fallback: string -> single resource
  if (typeof res === 'string') return { [res]: 1 };
  return {};
}

function _extractSummary(parsed, filename) {
  // Safe extraction with many fallbacks for messy JSONs
  const id = parsed.id || parsed.iso_a3 || parsed.iso || path.basename(filename, '.json');
  const name = parsed.name || parsed.title || parsed.country || parsed.country_name || parsed.full_name || path.basename(filename, '.json');
  const continent =
    parsed.continent ||
    parsed.region ||
    (parsed.geography && parsed.geography.continent) ||
    (parsed.metadata && parsed.metadata.continent) ||
    null;

  // population.value or population
  let population = 0;
  if (parsed.population) {
    if (typeof parsed.population === 'object' && parsed.population.value !== undefined) population = Number(parsed.population.value) || 0;
    else if (typeof parsed.population === 'number') population = parsed.population;
    else if (typeof parsed.population === 'string' && parsed.population.trim() !== '') population = Number(parsed.population) || 0;
  }

  // resources: prefer economy.resources, fallback to resources top-level
  const resourcesRaw = (parsed.economy && parsed.economy.resources) || parsed.resources || parsed.raw_resources || null;
  const resources = _normalizeResources(resourcesRaw);

  // borders: geography.borders or parsed.borders
  const borders = (parsed.geography && (parsed.geography.borders || parsed.geography.borderCountries)) || parsed.borders || parsed.neighbors || [];
  const bordersArr = Array.isArray(borders) ? borders : (typeof borders === 'string' ? borders.split(',').map(s=>s.trim()).filter(Boolean) : []);

  return {
    id: String(id).toLowerCase(),
    name: String(name),
    continent: continent ? String(continent).toLowerCase() : null,
    population: Number(population || 0),
    resources,
    borders: bordersArr.map(b => String(b).toLowerCase()),
    // keep filename for debugging
    _file: filename
  };
}

/** read & parse a single file, returns { raw, summary } */
async function _readCountryFile(fullPath, filename) {
  const rawText = await fs.readFile(fullPath, 'utf8');
  const parsed = JSON.parse(rawText || '{}');
  const summary = _extractSummary(parsed, filename);
  return { raw: parsed, summary };
}

/** --- Public API --- **/

/**
 * loadAll(force = false)
 * - Loads all country files into memory and builds indexes.
 * - If force=true re-reads files.
 */
export async function loadAll(force = false) {
  if (_loaded && !force) return { ok: true, count: _byId.size };

  // ensure directory exists
  try {
    await fs.access(COUNTRIES_DIR);
  } catch (e) {
    // missing directory -> initialize empty
    _byId = new Map();
    _byFile = new Map();
    _loaded = true;
    return { ok: true, count: 0, warning: 'countries dir not found' };
  }

  const names = await fs.readdir(COUNTRIES_DIR);
  _byId = new Map();
  _byFile = new Map();

  for (const fn of names) {
    if (!fn.toLowerCase().endsWith('.json')) continue;
    const full = path.join(COUNTRIES_DIR, fn);
    try {
      const { raw, summary } = await _readCountryFile(full, fn);
      const keyId = _safeLower(summary.id);
      const keyFile = _safeLower(path.basename(fn, '.json'));

      // store canonical entry object (summary + raw)
      const entry = { summary, raw };

      _byId.set(keyId, entry);
      _byFile.set(keyFile, entry);

      // also index by name (lowercase) for quick lookup by name
      if (summary.name) _byId.set(_safeLower(summary.name), entry); // name as key too
    } catch (e) {
      // ignore single-file errors but log to console (helpful during dev in Termux)
      try { console.warn('countries: failed to parse', fn, e && e.message ? e.message : e); } catch {}
    }
  }

  _loaded = true;
  return { ok: true, count: _byId.size };
}

/** getCountryById(id) - async; matches id or name or filename */
export async function getCountryById(id) {
  if (!id) return null;
  if (!_loaded) await loadAll();
  const key = _safeLower(String(id));
  return _byId.get(key) || null;
}

/** getCountryByFileName(filename) - async */
export async function getCountryByFileName(filename) {
  if (!filename) return null;
  if (!_loaded) await loadAll();
  const key = _safeLower(String(filename).replace(/\.json$/i, ''));
  return _byFile.get(key) || null;
}

/** getAllSummaries() - async => array of summary objects */
export async function getAllSummaries() {
  if (!_loaded) await loadAll();
  const seen = new Set();
  const out = [];
  for (const [k, entry] of _byId) {
    const id = entry.summary.id;
    if (seen.has(id)) continue;
    seen.add(id);
    out.push(entry.summary);
  }
  return out;
}

/** findCountry(query) - fuzzy by id, filename, or name (case-insensitive) */
export async function findCountry(query) {
  if (!query) return null;
  if (!_loaded) await loadAll();
  const q = _safeLower(String(query));
  if (_byId.has(q)) return _byId.get(q);
  if (_byFile.has(q)) return _byFile.get(q);

  // try substring match on name
  for (const entry of _byId.values()) {
    try {
      if (entry.summary.name && _safeLower(entry.summary.name).includes(q)) return entry;
    } catch (e) {}
  }
  return null;
}

/** refreshCache() - convenience to force reload from disk */
export async function refreshCache() {
  return loadAll(true);
}

/** load synchronously (small helper) - reads STATE of cache if present, else tries quick sync load */
export function loadSync() {
  // return the in-memory cache if loaded
  if (_loaded) {
    const arr = [];
    const seen = new Set();
    for (const entry of _byId.values()) {
      const id = entry.summary.id;
      if (seen.has(id)) continue;
      seen.add(id);
      arr.push(entry.summary);
    }
    return arr;
  }

  // fallback: attempt synchronous directory read/parsing (best-effort)
  try {
    const files = fsSync.readdirSync(COUNTRIES_DIR);
    const out = [];
    for (const fn of files) {
      if (!fn.toLowerCase().endsWith('.json')) continue;
      try {
        const raw = fsSync.readFileSync(path.join(COUNTRIES_DIR, fn), 'utf8');
        const parsed = JSON.parse(raw || '{}');
        const summary = _extractSummary(parsed, fn);
        out.push(summary);
      } catch (e) {
        // ignore single-file errors
      }
    }
    return out;
  } catch (e) {
    return [];
  }
}

/** default export: convenience object */
export default {
  loadAll,
  getCountryById,
  getCountryByFileName,
  getAllSummaries,
  findCountry,
  refreshCache,
  loadSync
};

===== ./economy/state.json =====

{
  "oil": {
    "stock": 0,
    "demand": 10,
    "trend": 0.05
  }
}
===== ./economy/testEngine.js =====

import { getQuote, executeTrade, getMarketSnapshot } from './engine.js';

async function test() {
  console.log('--- Quote ---');
  const quote = await getQuote({ itemId: 'oil', qty: 100, countryId: 'fra', opts: { basePrice: 60 } });
  console.log(quote);

  console.log('--- Execute trade ---');
  const trade = await executeTrade({ actor: 'user123', itemId: 'oil', qty: 100, countryId: 'fra', side: 'buy', opts: { basePrice: 60 } });
  console.log(trade);

  console.log('--- Market snapshot ---');
  const snapshot = await getMarketSnapshot();
  console.log(snapshot);
}

test();

===== ./economy/engine.js =====

// economy/engine.js
import fs from 'fs/promises';
import fsSync from 'fs';
import path from 'path';
import { computePrice, simulateStateAfterTrade } from './pricing.js';

const ECON_DIR = path.join('.', 'economy');
const STATE_PATH = path.join(ECON_DIR, 'state.json');
const LEDGER_PATH = path.join(ECON_DIR, 'ledger.json');
const COUNTRIES_DIR = path.join('.', 'map', 'world', 'countries');

let _countryCache = new Map();

/** --- Helpers --- **/
async function _ensureFile(filePath, initialContent) {
  try {
    await fs.access(filePath);
  } catch (e) {
    await fs.writeFile(filePath, initialContent, 'utf8');
  }
}

async function initIfNeeded() {
  // ensure economy dir files exist
  await _ensureFile(STATE_PATH, JSON.stringify({}, null, 2));
  await _ensureFile(LEDGER_PATH, JSON.stringify([], null, 2));
}

/** atomic write: write to temp then rename */
async function _atomicWriteJson(filePath, obj) {
  const tmp = filePath + '.tmp';
  await fs.writeFile(tmp, JSON.stringify(obj, null, 2), 'utf8');
  // rename (replace)
  await fs.rename(tmp, filePath);
}

/** load state.json object */
export async function loadState() {
  await initIfNeeded();
  const s = await fs.readFile(STATE_PATH, 'utf8');
  try {
    return JSON.parse(s || '{}');
  } catch (e) {
    // corrupt file -> reset to empty
    return {};
  }
}

/** save state.json */
export async function saveState(stateObj) {
  await _atomicWriteJson(STATE_PATH, stateObj);
}

/** read ledger array */
export async function loadLedger() {
  await initIfNeeded();
  const s = await fs.readFile(LEDGER_PATH, 'utf8');
  try {
    return JSON.parse(s || '[]');
  } catch (e) {
    return [];
  }
}

/** append transaction (writes ledger) */
export async function appendLedger(tx) {
  const ledger = await loadLedger();
  ledger.push(tx);
  await _atomicWriteJson(LEDGER_PATH, ledger);
}

/** find country by internal id (country.json contains "id") */
export async function findCountryById(countryId) {
  if (!countryId) return null;
  if (_countryCache.has(countryId)) return _countryCache.get(countryId);

  // read folder files and parse until match
  try {
    const files = await fs.readdir(COUNTRIES_DIR);
    for (const f of files) {
      if (!f.endsWith('.json')) continue;
      const full = path.join(COUNTRIES_DIR, f);
      try {
        const raw = await fs.readFile(full, 'utf8');
        const parsed = JSON.parse(raw);
        if (parsed && (parsed.id === countryId || parsed.id === countryId.toLowerCase() || f.replace('.json','') === countryId.toLowerCase())) {
          _countryCache.set(countryId, parsed);
          return parsed;
        }
      } catch (e) {
        // ignore bad file
      }
    }
  } catch (e) {
    return null;
  }
  return null;
}

/** generate short tx id */
function makeTxId() {
  const t = Date.now().toString(36);
  const r = Math.floor(Math.random() * 90000 + 10000).toString(36);
  return `tx_${t}_${r}`;
}

/** getQuote: returns computed price (does not mutate) */
export async function getQuote({ itemId, qty = 1, countryId = null, opts = {} }) {
  if (!itemId) return { ok: false, error: 'missing itemId' };
  if (qty <= 0) return { ok: false, error: 'qty must be > 0' };

  const state = await loadState();
  const stateItem = state[itemId] ?? { stock: 0, demand: 0, trend: 0 };
  const country = countryId ? (await findCountryById(countryId)) : null;
  const countryEconomy = country ? (country.economy ?? null) : null;

  const basePrice = opts.basePrice ?? (stateItem.basePrice ?? undefined);

  const result = computePrice(itemId, stateItem, countryEconomy, qty, Object.assign({}, opts, { basePrice }));
  return { ok: true, price: result.price, breakdown: result.breakdown };
}

/**
 * executeTrade
 * - payload: { actor, countryId, itemId, qty, side } where side in ['buy','sell']
 *   - 'buy'  => actor buys from market (market stock decreases)
 *   - 'sell' => actor sells to market (market stock increases)
 *
 * Returns: { ok: true, tx } or { ok: false, error }
 */
export async function executeTrade({ actor = 'anon', countryId, itemId, qty = 1, side = 'buy', opts = {} } = {}) {
  // basic validation
  if (!itemId) return { ok: false, error: 'missing itemId' };
  qty = Number(qty);
  if (!(qty > 0)) return { ok: false, error: 'qty must be > 0' };
  if (!['buy', 'sell'].includes(side)) return { ok: false, error: 'side must be "buy" or "sell"' };

  // load state and country
  const state = await loadState();
  if (!state[itemId]) {
    // initialize default item snapshot
    state[itemId] = { stock: 0, demand: 0, trend: 0 };
  }
  const stateItem = state[itemId];

  const country = countryId ? (await findCountryById(countryId)) : null;
  const countryEconomy = country ? (country.economy ?? null) : null;

  // compute price
  const priceResult = computePrice(itemId, stateItem, countryEconomy, qty, opts);
  const pricePerUnit = priceResult.price;
  const total = Math.round(pricePerUnit * qty * 100) / 100;

  // apply state mutation rules (simple, deterministic)
  const simulated = simulateStateAfterTrade(stateItem, qty, side);
  // update state
  state[itemId] = {
    stock: simulated.stock,
    demand: simulated.demand,
    trend: simulated.trend
  };

  // create ledger entry
  const tx = {
    id: makeTxId(),
    actor,
    country: countryId || null,
    item: itemId,
    qty,
    price_per_unit: pricePerUnit,
    total_price: total,
    side,
    breakdown: priceResult.breakdown,
    ts: Date.now()
  };

  // persist changes atomically: save state then append ledger
  await saveState(state);
  await appendLedger(tx);

  return { ok: true, tx };
}

/** convenience: returns full market snapshot (state + top N ledger entries) */
export async function getMarketSnapshot({ recentLedger = 20 } = {}) {
  const state = await loadState();
  const ledger = await loadLedger();
  const recent = Array.isArray(ledger) ? ledger.slice(-recentLedger) : [];
  return { ok: true, state, recent };
}

/** small sync helper for quick CLI debugging (optional) */
export function loadStateSync() {
  try {
    const raw = fsSync.readFileSync(STATE_PATH, 'utf8');
    return JSON.parse(raw || '{}');
  } catch (e) {
    return {};
  }
}

===== ./economy/pricing.js =====

// economy/pricing.js
// Pure functions only — no file I/O, no side effects.

function clamp(v, min, max) {
  return Math.max(min, Math.min(max, v));
}

/**
 * computePrice (pure)
 *
 * itemId: string
 * stateItem: { stock: number, demand: number, trend: number }  // snapshot from state.json for the item
 * countryEconomy: object|null   // optional: country.economy (to detect local abundance)
 * qty: number - requested quantity (positive)
 * opts: { basePrice?: number, minPrice?: number, maxPrice?: number, scarcityFactor?: number }
 *
 * Returns: { price: number, breakdown: { base, supplyFactor, demandFactor, qtyImpact, trendFactor, countryFactor } }
 */
export function computePrice(itemId, stateItem = {}, countryEconomy = null, qty = 1, opts = {}) {
  // defaults
  const basePrice = Number(opts.basePrice ?? 100); // default base price when nothing else provided
  const minPrice = Number(opts.minPrice ?? 0.01);
  const maxPrice = Number(opts.maxPrice ?? 1e9);
  const scarcityFactor = Number(opts.scarcityFactor ?? 1.0);

  const stock = Math.max(0, Number(stateItem.stock ?? 0));
  const demand = Math.max(0, Number(stateItem.demand ?? 0));
  const trend = Number(stateItem.trend ?? 0); // positive increases price, negative decreases

  qty = Math.max(0, Number(qty ?? 0));

  // country factor: if country has the resource listed, slightly cheaper (exporter),
  // otherwise slightly more expensive. Expect countryEconomy.resources = { itemId: qtyAvailable } or array.
  let countryFactor = 1.0;
  try {
    if (countryEconomy) {
      const res = countryEconomy.resources;
      if (res) {
        if (Array.isArray(res)) {
          if (res.includes(itemId)) countryFactor = 0.95;
        } else if (typeof res === 'object') {
          if (res[itemId] !== undefined) {
            // if quantity known and abundant -> cheaper proportional
            const localQty = Number(res[itemId] ?? 0);
            if (localQty > 0) countryFactor = clamp(0.85 + 0.15 * Math.exp(-localQty / 10000), 0.7, 1.0);
            else countryFactor = 0.98;
          }
        }
      }
    }
  } catch (e) {
    countryFactor = 1.0;
  }

  // supply-demand factor: if supply >> demand, cheap; if demand >> supply, expensive.
  // Use a soft ratio to avoid division by zero.
  const ratio = (stock + 1) / (demand + 1); // >1 => oversupply, <1 => scarcity
  // supplyFactor decreases with ratio; mapped so ratio 10 => 0.6, ratio 0.1 => 2.0
  const supplyFactor = clamp(1.0 / Math.pow(ratio, 0.25), 0.5, 3.0);

  // demandFactor — direct scaling on absolute demand pressure
  const demandFactor = clamp(1.0 + (demand / (Math.max(1, stock + demand)) ) * 1.2, 0.5, 3.0);

  // qtyImpact — larger single order moves price up (slippage)
  // small orders (<1% of stock) negligible; large orders push price non-linearly.
  const relOrder = stock > 0 ? (qty / (stock + qty)) : 1;
  const qtyImpact = 1.0 + Math.pow(relOrder, 0.6) * 2.0; // 1.0..3.0

  // trendFactor: incorporate market trend (can be negative)
  const trendFactor = 1.0 + clamp(trend, -0.5, 0.5);

  // scarcityFactor (global tuning)
  const sf = clamp(scarcityFactor, 0.5, 5.0);

  // final price
  let price = basePrice * supplyFactor * demandFactor * qtyImpact * trendFactor * countryFactor * sf;

  // defensive clamps
  price = clamp(Number(price), minPrice, maxPrice);

  // round to 2 decimals for currency-like behaviour
  const rounded = Math.round(price * 100) / 100;

  return {
    price: rounded,
    breakdown: {
      base: basePrice,
      supplyFactor,
      demandFactor,
      qtyImpact,
      trendFactor,
      countryFactor,
      scarcityFactor: sf
    }
  };
}

/**
 * simulateStateAfterTrade (pure)
 * - Given a snapshot of stateItem, simulate the new stock/demand/trend after a trade
 *
 * side: 'buy' (actor buys from market -> market stock decreases) or 'sell' (actor sells to market -> stock increases)
 */
export function simulateStateAfterTrade(stateItem = {}, qty = 1, side = 'buy', opts = {}) {
  const stock = Math.max(0, Number(stateItem.stock ?? 0));
  const demand = Math.max(0, Number(stateItem.demand ?? 0));
  const trend = Number(stateItem.trend ?? 0);

  qty = Math.max(0, Number(qty ?? 0));
  const newStock = side === 'buy' ? Math.max(0, stock - qty) : stock + qty;

  // demand moves: buy increases demand slightly, sell reduces it
  const demandDelta = (side === 'buy') ? Math.max(0, qty * 0.1) : -Math.max(0, qty * 0.05);
  const newDemand = Math.max(0, demand + demandDelta);

  // trend adjust: small EMA-like update
  const trendDelta = (demandDelta / (Math.max(1, stock + qty))) * 0.5;
  const newTrend = trend + trendDelta;
  return {
    stock: newStock,
    demand: newDemand,
    trend: Number(newTrend)
  };
}

export default { computePrice, simulateStateAfterTrade };

===== ./economy/catalog.js =====

export const CATALOG = {
  oil: {
    label: "Oil",
    unit: "barrel",
    icon: "🛢️",
    category: "energy"
  },
  iron: {
    label: "Iron",
    unit: "ton",
    icon: "⛓️",
    category: "raw"
  }
};

export function getItemMeta(id) {
  return CATALOG[id] || null;
}

===== ./economy/ledger.json =====

[
  {
    "id": "tx_mjfhoci5_jt8",
    "actor": "user123",
    "country": "fra",
    "item": "oil",
    "qty": 100,
    "price_per_unit": 180,
    "total_price": 18000,
    "side": "buy",
    "breakdown": {
      "base": 60,
      "supplyFactor": 1,
      "demandFactor": 1,
      "qtyImpact": 3,
      "trendFactor": 1,
      "countryFactor": 1,
      "scarcityFactor": 1
    },
    "ts": 1766307156557
  }
]
===== ./economy/testCountries.js =====

// economy/testCountries.js
import { loadAll, getCountryById, getAllSummaries } from './countries.js';

async function t() {
  console.log(await loadAll());
  console.log((await getCountryById('fra'))?.summary);
  console.log((await getCountryById('france'))?.summary);
  console.log((await getAllSummaries()).slice(0,5));
}
t();

===== ./economy/market_api.js =====

// economy/market_api.js
// ESM Express router that exposes minimal market API by calling economy/engine.js
// Endpoints:
//   GET  /api/market/catalog
//   GET  /api/market/snapshot
//   POST /api/market/quote    { itemId, qty, countryId }
//   POST /api/market/trade    { actor, itemId, qty, countryId, side }

import express from 'express';
import { fileURLToPath } from 'url';
import path from 'path';

// import engine methods
import {
  getQuote,
  executeTrade,
  getMarketSnapshot,
  loadState
} from './engine.js';

const router = express.Router();

// JSON body parser for endpoints
router.use(express.json());

// GET /api/market/catalog
// Returns a minimal catalog array. If a catalog module exists (economy/catalog.js) it will use it,
// otherwise it derives ids from state.json (keys) and returns { id, name } entries.
router.get('/catalog', async (req, res) => {
  try {
    // try to import an explicit catalog if present
    let catalogModule = null;
    try {
      // dynamic import — not fatal if file missing
      catalogModule = await import('./economy/catalog.js');
    } catch (e) {
      catalogModule = null;
    }

    if (catalogModule && (catalogModule.CATALOG || catalogModule.default)) {
      const CATALOG = catalogModule.CATALOG || catalogModule.default?.CATALOG || {};
      const arr = Object.keys(CATALOG).map(id => {
        const meta = CATALOG[id] || {};
        return { id, name: meta.label || meta.name || id, ...meta };
      });
      return res.json(arr);
    }

    // fallback: derive from state keys
    const state = await loadState();
    const ids = Object.keys(state || {});
    const arr = ids.map(id => ({ id, name: id }));
    return res.json(arr);
  } catch (err) {
    console.error('market/catalog error', err);
    return res.status(500).json({ ok: false, error: err.message || 'catalog error' });
  }
});

// GET /api/market/snapshot
router.get('/snapshot', async (req, res) => {
  try {
    const snap = await getMarketSnapshot({ recentLedger: 40 });
    // getMarketSnapshot returns { ok: true, state, recent } in our engine; ensure consistent shape
    if (snap && snap.ok) return res.json(snap);
    return res.json({ ok: true, state: snap.state || snap, recent: snap.recent || snap.recent });
  } catch (err) {
    console.error('market/snapshot error', err);
    return res.status(500).json({ ok: false, error: err.message || 'snapshot error' });
  }
});

// POST /api/market/quote
// body: { itemId, qty, countryId }
router.post('/quote', async (req, res) => {
  try {
    const { itemId, qty = 1, countryId = null } = req.body || {};
    if (!itemId) return res.status(400).json({ ok: false, error: 'missing itemId' });

    const out = await getQuote({ itemId, qty, countryId });
    // getQuote as implemented returns { ok: true, price, breakdown }
    return res.json(out);
  } catch (err) {
    console.error('market/quote error', err);
    return res.status(500).json({ ok: false, error: err.message || 'quote error' });
  }
});

// POST /api/market/trade
// body: { actor, itemId, qty, countryId, side } where side = 'buy'|'sell'
router.post('/trade', async (req, res) => {
  try {
    const payload = req.body || {};
    if (!payload.itemId) return res.status(400).json({ ok: false, error: 'missing itemId' });
    if (!payload.qty || Number(payload.qty) <= 0) return res.status(400).json({ ok: false, error: 'invalid qty' });
    if (!['buy', 'sell'].includes(payload.side)) return res.status(400).json({ ok: false, error: 'invalid side' });

    const result = await executeTrade(payload);
    return res.json(result);
  } catch (err) {
    console.error('market/trade error', err);
    return res.status(500).json({ ok: false, error: err.message || 'trade error' });
  }
});

// also expose a root for convenience
router.get('/', (req, res) => res.json({ ok: true, endpoints: ['/catalog','/snapshot','/quote','/trade'] }));

export default router;

===== ./guerre.html =====

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WorldConflict — Guerres</title>

  <!-- Project variables + global CSS (use the project's shared variables only) -->
  <link rel="stylesheet" href="variables.css">
  <link rel="stylesheet" href="guerre.css">
</head>
<body>
  <div class="shell">
    <header class="page-header">
      <div>
        <div class="title">Guerres</div>
        <div class="muted">Surveille et gère les conflits actifs</div>
      </div>

      <div class="header-right">
        <div class="mini">Mode : <strong id="modeLabel">Lecture</strong></div>
        <button id="refreshBtn" class="btn" title="Rafraîchir">⟳ Rafraîchir</button>
      </div>
    </header>

    <main class="main-grid">
      <section class="panel list-panel">
        <div class="panel-row">
          <h2>Conflits actifs</h2>
          <div class="controls">
            <input id="searchInput" placeholder="Rechercher une guerre ou un pays..." aria-label="Recherche guerre">
            <button id="declareBtn" class="btn btn-primary" title="Déclarer une guerre">Déclarer</button>
          </div>
        </div>

        <div id="warList" class="war-list">
          <div class="empty">Aucun conflit actif pour l'instant.</div>
        </div>
      </section>

      <aside class="panel detail-panel" aria-label="Détails de la guerre">
        <h3>Détails</h3>
        <div id="warDetails" class="mini">Sélectionne un conflit pour voir les détails.</div>

        <div class="action-row">
          <button id="toceaseBtn" class="btn" disabled>Proposer cessez-le-feu</button>
        </div>
      </aside>
    </main>
  </div>

  <nav class="bottom-nav" aria-label="Navigation">
    <button id="nav-chat" class="nav-btn" title="Chat">Chat</button>
    <button id="nav-lobby" class="nav-btn" title="Lobby">Lobby</button>
    <button id="nav-map" class="nav-btn" title="Carte">Carte</button>
    <button id="nav-guerre" class="nav-btn active" title="Guerres">Guerres</button>
    <button id="nav-profile" class="nav-btn" title="Profil">Profil</button>
  </nav>

  <div id="toast" class="wc-toast visually-hidden" role="status" aria-live="polite"></div>

  <script src="utils.js" defer></script>
  <script src="guerre.js" defer></script>
</body>
</html>

===== ./generate_asia.js =====

// generate_asia.js
// Usage:
//   node generate_asia.js            -> crée fichiers si absents (ne pas écraser)
//   node generate_asia.js --force    -> écrase les fichiers existants
//
// Place ce fichier à la racine du projet (~/WorldConflict) et exécute-le avec node.

const fs = require('fs');
const path = require('path');

const FORCE = process.argv.includes('--force');

function slugify(name) {
  return name
    .normalize('NFD').replace(/[\u0300-\u036f]/g, '') // enlever accents
    .toLowerCase()
    .replace(/['’"]/g, '') // virer apostrophes/marques
    .replace(/[^a-z0-9\s-]/g, '') // garder alnum espace -
    .trim()
    .replace(/\s+/g, '-');
}

// Liste complète Asie
// id = identifiant court (3 lettres ou custom), name = nom affiché
const ASIA = [
  { id: 'afg', name: 'Afghanistan' },
  { id: 'arm', name: 'Armenia' },
  { id: 'aze', name: 'Azerbaijan' },
  { id: 'bhr', name: 'Bahrain' },
  { id: 'bgd', name: 'Bangladesh' },
  { id: 'btn', name: 'Bhutan' },
  { id: 'brn', name: 'Brunei' },
  { id: 'mmr', name: 'Burma (Myanmar)' },
  { id: 'khm', name: 'Cambodia' },
  { id: 'chn', name: 'China' },
  { id: 'cyp', name: 'Cyprus' },
  { id: 'geo', name: 'Georgia' },
  { id: 'ind', name: 'India' },
  { id: 'idn', name: 'Indonesia' },
  { id: 'irn', name: 'Iran' },
  { id: 'irq', name: 'Iraq' },
  { id: 'isr', name: 'Israel' },
  { id: 'jpn', name: 'Japan' },
  { id: 'jor', name: 'Jordan' },
  { id: 'kaz', name: 'Kazakhstan' },
  { id: 'kwt', name: 'Kuwait' },
  { id: 'kgz', name: 'Kyrgyzstan' },
  { id: 'lao', name: 'Laos' },
  { id: 'lbn', name: 'Lebanon' },
  { id: 'mys', name: 'Malaysia' },
  { id: 'mdv', name: 'Maldives' },
  { id: 'mng', name: 'Mongolia' },
  { id: 'npl', name: 'Nepal' },
  { id: 'prk', name: 'North Korea' },
  { id: 'omn', name: 'Oman' },
  { id: 'pak', name: 'Pakistan' },
  { id: 'pse', name: 'Palestine' },
  { id: 'phl', name: 'Philippines' },
  { id: 'qat', name: 'Qatar' },
  { id: 'rus', name: 'Russia' },
  { id: 'sau', name: 'Saudi Arabia' },
  { id: 'sgp', name: 'Singapore' },
  { id: 'kor', name: 'South Korea' },
  { id: 'lka', name: 'Sri Lanka' },
  { id: 'syc', name: 'Syria' },
  { id: 'tjk', name: 'Tajikistan' },
  { id: 'tha', name: 'Thailand' },
  { id: 'tls', name: 'Timor-Leste (East Timor)' },
  { id: 'tur', name: 'Turkey' },
  { id: 'tkm', name: 'Turkmenistan' },
  { id: 'are', name: 'United Arab Emirates' },
  { id: 'uzb', name: 'Uzbekistan' },
  { id: 'vnm', name: 'Vietnam' },
  { id: 'yem', name: 'Yemen' }
];

const outDir = path.join(process.cwd(), 'map', 'world', 'asia');
if (!fs.existsSync(outDir)) fs.mkdirSync(outDir, { recursive: true });

const today = new Date().toISOString().slice(0, 10); // YYYY-MM-DD

let created = 0, skipped = 0, overwritten = 0;

ASIA.forEach(c => {
  const slug = slugify(c.name);
  const fileName = `${slug}.json`;
  const filePath = path.join(outDir, fileName);

  const payload = {
    id: (c.id || slug).toLowerCase(),
    name: c.name,
    continent: 'asia',
    metadata: {
      created_at: today,
      updated_at: null
    },
    government: {
      leader: null,
      ministers: [],
      system: null
    },
    population: {
      value: 0,
      growth_rate: 0
    },
    economy: {
      gdp: 0,
      resources: {}
    },
    military: {
      active: 0,
      reserve: 0,
      equipment: {}
    },
    geography: {
      area_km2: 0,
      major_cities: [],
      climate_zones: [],
      borders: []
    },
    status: {
      occupied: false,
      contested: false
    }
  };

  if (fs.existsSync(filePath)) {
    if (FORCE) {
      fs.writeFileSync(filePath, JSON.stringify(payload, null, 2), 'utf8');
      overwritten++;
      console.log(`overwritten: ${fileName}`);
    } else {
      skipped++;
      console.log(`skipped: ${fileName} (exists)`);
    }
  } else {
    fs.writeFileSync(filePath, JSON.stringify(payload, null, 2), 'utf8');
    created++;
    console.log(`created: ${fileName}`);
  }
});

console.log('\nSummary:');
console.log(`  created: ${created}`);
console.log(`  overwritten: ${overwritten}`);
console.log(`  skipped: ${skipped}`);
console.log(`Files generated in: ${outDir}`);

===== ./package.json =====

{
  "name": "worldconflict",
  "version": "1.0.0",
  "type": "module",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "Codexxu",
  "license": "ISC",
  "dependencies": {
    "@capacitor/android": "^7.4.4",
    "body-parser": "^2.2.0",
    "cors": "^2.8.5",
    "express": "^5.2.1",
    "express-session": "^1.18.2"
  }
}

===== ./dashboard.css =====

/* dashboard.css — style professionnel, cohérent avec variables.css */

.app-shell {
  min-height: 100vh;
  display: grid;
  grid-template-rows: auto 1fr auto;
  background: var(--bg);
  color: var(--text);
  position: relative;
}

/* Header */
.dc-header {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding: 14px 18px;
  max-width: 1100px;
  margin: 0 auto;
  width: 100%;
}

.icon-btn {
  width:48px;
  height:48px;
  border-radius:50%;
  background: var(--surface);
  border: 1px solid rgba(255,255,255,0.03);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow: var(--card-shadow);
}
.icon-btn:active { transform: translateY(1px); }

.icon-btn .burger {
  width:18px;
  height:2px;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  box-shadow: 0 -6px 0 0 linear-gradient(90deg, var(--accent1), var(--accent2)), 0 6px 0 0 linear-gradient(90deg, var(--accent1), var(--accent2));
  display:block;
}

.dc-title {
  text-align:center;
  flex:1;
}
.dc-title h1 {
  margin:0;
  font-size:20px;
  letter-spacing:0.6px;
}
.dc-title .small { font-size:12px; }

/* Side panels */
.side-panel {
  position: fixed;
  top: 0;
  bottom: 0;
  width: 320px;
  max-width: 86%;
  background: var(--surface);
  box-shadow: 0 20px 40px rgba(2,6,23,0.7);
  padding:16px;
  transform: translateX(-110%);
  transition: transform 260ms ease;
  z-index: 80;
  overflow-y: auto;
}
.side-panel.right { right: 0; left: auto; transform: translateX(110%); }
.side-panel.left.open { transform: translateX(0); left: 0; }
.side-panel.right.open { transform: translateX(0); right: 0; }

.panel-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:8px;
  margin-bottom:12px;
}
.panel-header h3 { margin:0; }
.close-panel {
  background:transparent;
  border:0;
  color:var(--muted);
  font-size:16px;
  cursor:pointer;
}

/* panels contents */
.panel-nav button,
.actions-list button {
  display:block;
  width:100%;
  text-align:left;
  margin:6px 0;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.03);
  background:transparent;
  color:var(--text);
  cursor:pointer;
}
.panel-foot {
  margin-top:16px;
  color:var(--muted);
}

/* Main area */
.dc-main {
  max-width:1100px;
  margin: 12px auto 80px;
  padding: 0 16px;
  width:100%;
  display:flex;
  flex-direction:column;
  gap:14px;
}

/* Hero / cards */
.hero-card {
  display:flex;
  gap:16px;
  align-items:flex-start;
}
.hero-left { flex: 1 1 60%; }
.hero-right { width:320px; max-width:35%; min-width:240px; }

.card.surface {
  padding:14px;
  border-radius:12px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.006));
  box-shadow: var(--card-shadow);
}

/* quick info */
.quick-info {
  display:flex;
  gap:10px;
  margin-top:14px;
  flex-wrap:wrap;
}
.qi-card {
  background: rgba(255,255,255,0.02);
  border-radius:10px;
  padding:10px;
  min-width:120px;
  flex: 1 1 120px;
  border: 1px solid rgba(255,255,255,0.03);
}
.qi-title { font-size:12px; color:var(--muted); }
.qi-value { font-weight:700; margin-top:6px; }

/* feed */
.card.feed { padding:14px; border-radius:12px; box-shadow: var(--card-shadow); }
.feed-list { min-height:48px; }

/* bottom nav */
.bottom-nav {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: 18px;
  display:flex;
  gap:8px;
  background: transparent;
  z-index: 90;
}
.nav-btn {
  width:64px;
  height:64px;
  border-radius:18px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:4px;
  padding:8px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.002));
  border: 1px solid rgba(255,255,255,0.04);
  color: var(--text);
  cursor:pointer;
}
.nav-btn span { font-size:11px; color:var(--muted); }
.nav-btn.active { box-shadow: 0 10px 30px rgba(79,70,229,0.12); border-radius:16px; }

/* responsive */
@media (max-width:900px) {
  .hero-card { flex-direction:column; }
  .hero-right { width:100%; max-width:100%; }
  .side-panel { width: 86%; }
  .nav-btn { width:56px; height:56px; }
}

===== ./data/users.json =====

[
  {
    "username": "Aaa",
    "email": "a@",
    "password": "891cbbd164d22323b47ef94a2d9929ded5925fde77996b1c104a346eabec41af",
    "rp": {
      "joined": false
    },
    "createdAt": "2025-11-27T16:03:44.145Z"
  },
  {
    "username": "Aaaa",
    "email": "yanisbellahsene5@gmail.com",
    "password": "487e11ab6d0c4ebd1a31d65cd922e0bcf2f9ef8fa0b91a244d6b445fc9eec670",
    "rp": {
      "joined": true,
      "country_id": "algeria",
      "country_name": "Algeria",
      "role": "leader",
      "displayName": "Yanis",
      "joinedAt": "2025-11-27T16:35:51.796Z"
    },
    "createdAt": "2025-11-27T16:35:30.436Z"
  },
  {
    "username": "Tonpseudo",
    "email": "i@gmail.com",
    "password": "c176a0b5014890767e8d15ad8b83c20b3f3a2fbc34717b7f3fb2eaeedfeb0746",
    "rp": {
      "joined": true,
      "country_id": "algeria",
      "country_name": "Algeria",
      "role": "citizen",
      "displayName": null,
      "joinedAt": "2025-11-29T08:44:10.241Z",
      "job": "journalist"
    },
    "createdAt": "2025-11-29T08:43:46.664Z"
  },
  {
    "username": "New",
    "email": "Test@gmail.com",
    "password": "487e11ab6d0c4ebd1a31d65cd922e0bcf2f9ef8fa0b91a244d6b445fc9eec670",
    "rp": {
      "joined": false
    },
    "createdAt": "2025-12-04T15:36:35.530Z"
  }
]
===== ./profile.js =====

// profile.js — page profil publique (affiche seulement le profil; settings 👉 settings.html)
(() => {
  const avatarEl = document.getElementById('avatar');
  const usernameDisplay = document.getElementById('usernameDisplay');
  const displayNameEl = document.getElementById('displayName');
  const profileUser = document.getElementById('profileUser');
  const profileEmail = document.getElementById('profileEmail');
  const rpCountry = document.getElementById('rpCountry');
  const rpRole = document.getElementById('rpRole');
  const rpDisplay = document.getElementById('rpDisplay');
  const createdAt = document.getElementById('createdAt');

  // bottom nav handlers
  document.getElementById('nav-chat')?.addEventListener('click', () => location.href = 'chat.html');
  document.getElementById('nav-lobby')?.addEventListener('click', () => location.href = 'dashboard.html');
  document.getElementById('nav-notifs')?.addEventListener('click', () => alert('Notifications à implémenter'));
  document.getElementById('nav-profile')?.addEventListener('click', () => { /* noop */ });

  // message / follow placeholders
  document.getElementById('btnMessage')?.addEventListener('click', () => alert('Ouverture du chat — fonctionnalité à implémenter'));
  document.getElementById('btnFollow')?.addEventListener('click', () => alert('Fonction suivre à implémenter'));

  // load avatar from localStorage (prototype)
  function loadAvatar() {
    try {
      const d = localStorage.getItem('wc_avatar');
      if (d) {
        avatarEl.style.backgroundImage = `url(${d})`;
        avatarEl.textContent = '';
      } else {
        avatarEl.style.backgroundImage = 'none';
        avatarEl.textContent = 'WC';
      }
    } catch (e) {
      avatarEl.textContent = 'WC';
    }
  }

  async function apiFetch(url, opts = {}) {
    if (window.WC && WC.apiFetch) return WC.apiFetch(url, opts);
    opts.credentials = opts.credentials || 'same-origin';
    opts.headers = opts.headers || {};
    if (!opts.headers['Content-Type'] && !(opts.body instanceof FormData)) opts.headers['Content-Type'] = 'application/json';
    try {
      const r = await fetch(url, opts);
      const ct = r.headers.get('content-type') || '';
      const data = ct.includes('application/json') ? await r.json() : await r.text();
      if (!r.ok) return { ok: false, status: r.status, data, error: data && data.error ? data.error : (typeof data === 'string' ? data : 'Erreur') };
      return { ok: true, status: r.status, data };
    } catch (err) {
      return { ok: false, status: 0, error: err.message || 'Network error' };
    }
  }

  async function populate() {
    const s = await apiFetch('/api/session', { method: 'GET' });
    if (!s || !s.ok || !s.data || !s.data.ok) {
      // show minimal public profile? ici on redirige si non connecté
      location.href = 'index.html';
      return;
    }
    const d = s.data;
    usernameDisplay.textContent = d.username || '—';
    displayNameEl.textContent = d.rp?.displayName || '—';
    profileUser.textContent = '@' + (d.username || '—');
    profileEmail.textContent = d.email || '—';
    rpCountry.textContent = d.rp?.country_name || d.rp?.country_id || '—';
    rpRole.textContent = d.rp?.role || '—';
    rpDisplay.textContent = d.rp?.displayName || '—';
    createdAt.textContent = d.createdAt ? new Date(d.createdAt).toLocaleDateString() : '—';
    loadAvatar();
  }

  (async () => {
    try { await populate(); } catch (e) { console.error(e); location.href = 'index.html'; }
  })();
})();

===== ./join-rp.html =====

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WorldConflict — Rejoindre le RP</title>
  <link rel="stylesheet" href="variables.css">
  <link rel="stylesheet" href="join-rp.css">
</head>
<body>
  <main class="wrap container">
    <section class="card join-card" aria-labelledby="joinTitle">
      <header class="card-header">
        <div>
          <h1 id="joinTitle">Rejoindre le RP</h1>
          <p class="muted sub">Sélectionne un pays. Le premier membre d'un pays devient automatiquement dirigeant.</p>
        </div>
        <div class="header-actions">
          <a class="btn ghost" href="dashboard.html">Retour</a>
        </div>
      </header>

      <form id="joinForm" class="form" novalidate>
        <!-- Recherche de pays (facultatif) -->
        <div class="row">
          <label for="countryFilter" class="label">Rechercher (facultatif)</label>

          <div class="search-wrap" aria-hidden="false">
            <input id="countryFilter" type="search" class="search-input"
                   placeholder="Rechercher un pays — tape pour filtrer (facultatif)"
                   aria-label="Rechercher un pays, champ facultatif" />
            <button id="countryFilterClear" class="btn ghost small clear-btn" type="button" aria-label="Effacer la recherche" title="Effacer la recherche" hidden>✕</button>
          </div>

          <div class="hint">Champ de recherche — facultatif. Tu peux aussi sélectionner directement dans la liste.</div>
        </div>

        <div class="row">
          <label for="countrySelect" class="label">Pays</label>
          <select id="countrySelect" class="select" aria-label="Liste des pays" required>
            <option value="">— Chargement —</option>
          </select>
          <small class="muted">Choisis le pays dans la liste (recherche instantanée).</small>
        </div>

        <div class="row">
          <label for="displayName" class="label">Nom d'affichage (optionnel)</label>
          <input id="displayName" class="text-input" placeholder="Pseudo affiché dans le RP" aria-label="Nom d'affichage optionnel" />
        </div>

        <div id="countryPreview" class="country-preview hidden" aria-live="polite">
          <div class="cp-left"><div id="cpFlag" class="cp-flag" aria-hidden="true">🌍</div></div>
          <div class="cp-right">
            <div class="cp-line" style="display:flex; justify-content:space-between; gap:8px; align-items:center;">
              <div id="cpName" class="cp-name">—</div>
              <div id="cpMeta" class="muted cp-meta" aria-hidden="true"></div>
            </div>
            <p id="cpDesc" class="muted cp-desc" aria-hidden="true"></p>
            <div class="cp-stats-row" aria-hidden="true">
              <span id="cpCode" class="cp-stat">Code —</span>
              <span id="cpPop" class="cp-stat">Pop —</span>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <div>
            <div id="loader" class="loader hidden" aria-hidden="true"><span class="spinner" aria-hidden="true"></span> Envoi…</div>
            <div id="msg" class="msg" role="status" aria-live="polite"></div>
          </div>
          <div class="actions-right">
            <button id="skipBtn" type="button" class="btn ghost">Plus tard</button>
            <button id="submitJoin" type="submit" class="btn primary" disabled>Rejoindre le RP</button>
          </div>
        </div>
      </form>
    </section>
  </main>

  <script src="utils.js" defer></script>
  <script src="join-rp.js" defer></script>
</body>
</html>

===== ./settings.css =====

/* settings.css — cohérence visuelle */
.container { max-width:900px; margin:18px auto; padding:0 16px; }
.settings-header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
.icon-btn { display:inline-flex; align-items:center; justify-content:center; width:44px; height:44px; border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.004)); border:1px solid rgba(255,255,255,0.03); font-size:18px; cursor:pointer; text-decoration:none; color:var(--text); }

.settings-main { display:flex; flex-direction:column; gap:12px; margin-bottom:120px; }

.panel { padding:16px; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.003)); border:1px solid rgba(255,255,255,0.03); box-shadow: var(--card-shadow); }
.profile-ctrls { display:flex; gap:16px; align-items:center; margin-bottom:12px; }
.avatar-xl { width:110px; height:110px; border-radius:14px; display:flex; align-items:center; justify-content:center; font-weight:800; color:#fff; background:linear-gradient(90deg,var(--accent1),var(--accent2)); }
.profile-ctrls-right { display:flex; gap:8px; }

.field { display:flex; flex-direction:column; gap:6px; margin-bottom:8px; }
.label { font-size:13px; color:var(--muted); }
.text-input { padding:12px 14px; border-radius:10px; background:var(--glass); border:1px solid rgba(255,255,255,0.03); color:var(--text); width:100%; }

.actions-row { display:flex; gap:10px; justify-content:flex-end; margin-top:8px; }
.btn { padding:10px 14px; border-radius:10px; cursor:pointer; border:0; font-weight:700; }
.btn-ghost { background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--text); }
.btn-primary { background: linear-gradient(90deg,var(--accent1),var(--accent2)); color:#fff; box-shadow: 0 10px 30px rgba(79,70,229,0.14); }

.bottom-nav { position:fixed; left:0; right:0; bottom:18px; display:flex; justify-content:center; gap:10px; z-index:60; pointer-events:auto; }
.nav-btn { min-width:84px; height:48px; border-radius:12px; border:1px solid rgba(255,255,255,0.03); background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.004)); color:var(--muted); padding:8px 12px; font-weight:700; cursor:pointer; }
.wc-toast { position:fixed; left:50%; transform:translateX(-50%); bottom:92px; min-width:220px; max-width:420px; padding:10px 14px; border-radius:10px; background:rgba(10,12,20,0.9); color:#fff; box-shadow:0 8px 30px rgba(2,6,23,0.6); text-align:center; z-index:200; }
.visually-hidden { display:none !important; }

===== ./map.css =====

:root{
  --bg:#0f1720;
  --panel:#0b1220;
  --muted:#9aa4b2;
  --accent:#1f8feb;
  --glass: rgba(255,255,255,0.04);
  --radius:12px;
  --gap:12px;
  --maxw:1100px;
}

html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Arial,sans-serif;background:var(--bg);color:#e6eef6}
.shell{max-width:var(--maxw);margin:18px auto;padding:18px;}
.map-header{display:flex;align-items:center;gap:14px;margin-bottom:12px}
.map-header .title{font-size:18px;font-weight:600}
.map-header .muted{color:var(--muted);font-size:13px}
.header-right{margin-left:auto;display:flex;gap:8px;align-items:center}
.mini{font-size:12px;color:var(--muted)}

/* map area */
.map-wrapper{display:grid;grid-template-columns:1fr 320px;gap:14px;min-height:72vh}
#map{width:100%;height:72vh;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,0.6);overflow:hidden}

/* side panel */
.panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px;box-shadow:0 6px 20px rgba(0,0,0,0.45)}
.panel h3{margin:0 0 8px 0;font-size:16px}
.panel .muted{color:var(--muted);font-size:13px}

.country-list{max-height:44vh;overflow:auto;margin-top:8px;border-radius:8px;padding:6px;background:var(--glass)}
.country-item{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:8px;cursor:pointer}
.country-item:hover{background:rgba(255,255,255,0.02)}
.country-name{font-weight:600}
.country-meta{font-size:12px;color:var(--muted)}

.controls{display:flex;gap:8px;margin-top:10px}
.btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:10px;color:#e6eef6;cursor:pointer}
.btn.primary{background:var(--accent);border:none;color:white}
.search{display:flex;gap:8px;margin-bottom:6px}
.search input{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}

.action-row{display:flex;gap:8px;margin-top:12px}
.action-row .btn{flex:1}

/* responsive */
@media (max-width:920px){
  .map-wrapper{grid-template-columns:1fr}
  .panel{order:2}
  #map{height:60vh}
}

/* bottom navigation sync (appearance) */
.bottom-nav{position:fixed;left:50%;transform:translateX(-50%);bottom:14px;background:rgba(6,10,17,0.85);padding:8px 12px;border-radius:14px;display:flex;gap:8px}
.bottom-nav .nav-item{border:none;background:transparent;color:var(--muted);padding:8px;border-radius:10px}
.bottom-nav .nav-item.active{background:rgba(255,255,255,0.03);color:var(--accent)}

/* simple toast */
#toast{position:fixed;right:18px;bottom:90px;background:#0b1220;padding:10px 12px;border-radius:8px;color:var(--muted);box-shadow:0 6px 18px rgba(0,0,0,0.5)}

===== ./map.js =====

/* map.js — logique complète pour map.html
   - attend que Leaflet soit chargé (Leaflet script est inclus avant ce fichier, both deferred)
   - utilise WC.apiFetch si présent sinon fallback fetch wrapper
*/

(function(){
  // ---- helpers ----
  const apiFetch = async (url, opts = {}) => {
    if (window.WC && typeof WC.apiFetch === 'function') {
      try { return await WC.apiFetch(url, opts); } catch(e){ /* fallthrough */ }
    }
    opts = Object.assign({ credentials:'same-origin' }, opts);
    opts.headers = opts.headers || {};
    if (!opts.headers['Content-Type'] && !(opts.body instanceof FormData)) opts.headers['Content-Type'] = 'application/json';
    try {
      const r = await fetch(url, opts);
      const ct = (r.headers.get('content-type') || '');
      const data = ct.includes('application/json') ? await r.json() : await r.text();
      return { ok: r.ok, status: r.status, data };
    } catch (err) { return { ok:false, status:0, error: err.message }; }
  };

  const el = id => document.getElementById(id);
  const showToast = (txt, t=2800) => {
    const toast = el('toast');
    if(!toast) return;
    toast.textContent = txt;
    toast.hidden = false;
    setTimeout(()=> toast.hidden = true, t);
  };

  // ---- DOM refs ----
  const mapEl = el('map');
  const countryListEl = el('countryList');
  const countryDetailsEl = el('countryDetails');
  const joinBtn = el('joinBtn');
  const actionsBtn = el('actionsBtn');
  const searchInput = el('searchInput');
  const searchBtn = el('searchBtn');
  const refreshBtn = el('refreshBtn');
  const zoomIn = el('zoomIn');
  const zoomOut = el('zoomOut');
  const fitAll = el('fitAll');

  // ---- state ----
  let map = null;
  let geojsonLayer = null;
  let countries = [];
  let selectedCountry = null;
  let userSession = null;

  // ---- session ----
  async function fetchSession(){
    try {
      const r = await apiFetch('/api/session', { method: 'GET' });
      if (r && r.ok && r.data) { userSession = r.data; return userSession; }
    } catch(e) { /* noop */ }
    userSession = null;
    return null;
  }

  // ---- map init ----
  function initMap(){
    // safety: Leaflet must be available
    if (typeof L === 'undefined') {
      console.error('Leaflet non chargé');
      return;
    }
    map = L.map(mapEl, { worldCopyJump:true, minZoom:2, maxZoom:8 }).setView([20, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors', maxZoom: 8
    }).addTo(map);
  }

  // ---- geo styling ----
  function styleFeature(feature){
    const owner = feature?.properties?.owner || null;
    const myCountryId = userSession?.rp?.country_id || null;
    if (!owner) return { weight:1, opacity:0.8, color:'#0b1220', fillColor:'#1f2937', fillOpacity:0.6 };
    if (owner === myCountryId) return { weight:1, opacity:0.9, color:'#071021', fillColor:'#1657a3', fillOpacity:0.75 };
    return { weight:1, opacity:0.8, color:'#071021', fillColor:'#7c3aed', fillOpacity:0.6 };
  }

  function onEachFeature(feature, layer){
    layer.on({
      click: () => selectCountry(feature, layer),
      mouseover: e => e.target.setStyle({ weight:2 }),
      mouseout: e => geojsonLayer && geojsonLayer.resetStyle(e.target)
    });
    const name = feature.properties?.name || feature.properties?.name_en || '—';
    layer.bindTooltip(name, { sticky:true });
  }

  // ---- selection ----
  async function selectCountry(feature, layer){
    selectedCountry = feature;
    renderCountryDetails(feature);
    try { const bounds = layer.getBounds(); map.fitBounds(bounds.pad(0.5), { maxZoom:5, animate:true }); } catch(e){}
    await updateActionButtons();
    // fetch members count and update details
    fetchMembersCount(feature.properties.id).then(cnt => {
      const p = feature.properties;
      countryDetailsEl.innerHTML = `<strong>${p.name || p.name_en || '—'}</strong>
        <div class="mini" style="margin-top:6px">ID: ${p.id || '—'}</div>
        <div class="mini" style="margin-top:6px">Propriétaire: ${p.owner || 'Aucun'}</div>
        <div class="mini" style="margin-top:6px">Membres: ${cnt}</div>`;
    }).catch(()=>{});
  }

  function renderCountryDetails(feature){
    const p = feature.properties || {};
    countryDetailsEl.innerHTML = `<strong>${p.name || p.name_en || '—'}</strong>
      <div class="mini" style="margin-top:6px">ID: ${p.id || '—'}</div>
      <div class="mini" style="margin-top:6px">Propriétaire: ${p.owner || 'Aucun'}</div>
      <div class="mini" style="margin-top:6px">Membres: —</div>`;
  }

  async function fetchMembersCount(countryId){
    if (!countryId) return '—';
    try {
      const r = await apiFetch(`/api/countries/${encodeURIComponent(countryId)}/members-count`, { method: 'GET' });
      if (r && r.ok && r.data) return r.data.count ?? r.data ?? '—';
    } catch(e){}
    return '—';
  }

  async function updateActionButtons(){
    await fetchSession();
    joinBtn.disabled = true;
    actionsBtn.disabled = true;
    if (!selectedCountry) return;
    const owner = selectedCountry.properties.owner || null;
    if (!owner) {
      joinBtn.disabled = false;
      actionsBtn.disabled = false;
      return;
    }
    const isLeader = userSession?.rp && userSession.rp.role === 'leader' && userSession.rp.country_id === owner;
    if (isLeader) {
      actionsBtn.disabled = false;
      joinBtn.disabled = true;
    }
  }

  // ---- load countries (GeoJSON tolerant) ----
  async function loadCountries(){
    try {
      const r = await apiFetch('/api/countries', { method: 'GET' });
      if (r && r.ok && r.data) {
        if (r.data.type === 'FeatureCollection') return r.data;
        if (Array.isArray(r.data)) {
          const features = r.data.map(c => ({
            type: 'Feature',
            properties: Object.assign({}, c.properties || c),
            geometry: c.geometry || c.geo || null
          }));
          return { type:'FeatureCollection', features };
        }
      }
    } catch(e){ console.warn('fetch /api/countries failed', e); }

    // fallback minimal sample so map works offline
    return {
      type: 'FeatureCollection',
      features: [
        { type:'Feature', properties:{ id:'FRA', name:'France', owner:null },
          geometry: { type:'Polygon', coordinates: [[[2.0,51.0],[2.5,49.0],[3.0,44.0],[0.0,43.0],[-1.5,48.0],[2.0,51.0]]] } },
        { type:'Feature', properties:{ id:'DZA', name:'Algérie', owner:null },
          geometry: { type:'Polygon', coordinates: [[[0,37],[5,36],[7,32],[3,30],[-2,32],[0,37]]] } }
      ]
    };
  }

  // ---- render on map + side list ----
  async function renderCountries(){
    const geojson = await loadCountries();
    countries = geojson.features || [];
    if (geojsonLayer) map.removeLayer(geojsonLayer);
    geojsonLayer = L.geoJSON(geojson, { style: styleFeature, onEachFeature }).addTo(map);

    // populate list
    countryListEl.innerHTML = '';
    countries.sort((a,b) => (a.properties?.name||'').localeCompare(b.properties?.name||'')).forEach(f => {
      const div = document.createElement('div');
      div.className = 'country-item';
      div.setAttribute('role','listitem');
      div.innerHTML = `<div>
          <div class="country-name">${f.properties?.name || '—'}</div>
          <div class="country-meta">ID: ${f.properties?.id || '—'}</div>
        </div>
        <div class="country-meta">${f.properties?.owner ? 'Owned' : 'Libre'}</div>`;
      div.addEventListener('click', () => {
        geojsonLayer.eachLayer(l => { if (l.feature === f) selectCountry(f, l); });
      });
      countryListEl.appendChild(div);
    });

    // fit map to all features
    try {
      const bounds = geojsonLayer.getBounds();
      if (bounds.isValid()) map.fitBounds(bounds.pad(0.2));
    } catch(e){}
  }

  // ---- actions ----
  async function joinSelectedCountry(){
    if (!selectedCountry) return;
    if (!userSession) { showToast('Connecte-toi pour rejoindre'); return; }
    const cid = selectedCountry.properties.id;
    try {
      const r = await apiFetch(`/api/countries/${encodeURIComponent(cid)}/join`, { method: 'POST' });
      if (r && r.ok) { showToast('Rejoint avec succès'); await renderCountries(); }
      else showToast('Échec de la requête');
    } catch(e){ showToast('Erreur réseau'); }
  }

  async function showActions(){
    if (!selectedCountry) return;
    await fetchSession();
    const owner = selectedCountry.properties.owner || null;
    const isLeader = userSession?.rp && userSession.rp.role === 'leader' && userSession.rp.country_id === owner;
    if (!isLeader) { alert('Aucune action disponible — requiert être leader du pays.'); return; }

    // simple modal-less action flow (prompt fallback) — swap to proper modals later
    const choice = prompt('Actions (tape: rename, invite, war):');
    if (!choice) return;
    if (choice === 'rename') {
      const name = prompt('Nouveau nom:'); if (!name) return;
      // call server endpoint (example)
      try {
        const r = await apiFetch(`/api/countries/${encodeURIComponent(owner)}/rename`, {
          method: 'POST', body: JSON.stringify({ name })
        });
        if (r && r.ok) showToast('Pays renommé');
        else showToast('Échec renommage');
      } catch(e) { showToast('Erreur réseau'); }
      await renderCountries();
    } else if (choice === 'invite') {
      const user = prompt('Pseudo à inviter:'); if (!user) return;
      // simulated, server endpoint is required
      showToast('Invitation envoyée (simulé)');
    } else if (choice === 'war') {
      const target = prompt('ID cible (ex: FRA):'); if (!target) return;
      showToast('Déclaration de guerre (simulé) contre ' + target);
    } else {
      showToast('Action inconnue');
    }
  }

  // ---- search ----
  function searchCountry(q){
    if (!q) return;
    q = q.trim().toLowerCase();
    const found = countries.find(f => (f.properties?.name || '').toLowerCase().includes(q) || (f.properties?.id || '').toLowerCase() === q);
    if (found) { geojsonLayer.eachLayer(l => { if (l.feature === found) selectCountry(found, l); }); }
    else showToast('Aucun pays trouvé');
  }

  // ---- UI wiring ----
  function wireUI(){
    searchBtn.addEventListener('click', () => searchCountry(searchInput.value));
    searchInput.addEventListener('keypress', e => { if (e.key === 'Enter') searchCountry(searchInput.value); });
    refreshBtn.addEventListener('click', async () => { await renderCountries(); showToast('Carte rafraîchie'); });
    zoomIn.addEventListener('click', () => map.zoomIn());
    zoomOut.addEventListener('click', () => map.zoomOut());
    fitAll.addEventListener('click', () => {
      try { const b = geojsonLayer.getBounds(); if (b.isValid()) map.fitBounds(b.pad(0.2)); } catch(e){}
    });
    joinBtn.addEventListener('click', joinSelectedCountry);
    actionsBtn.addEventListener('click', showActions);

    // bottom nav
    el('navChat').addEventListener('click', () => location.href = 'chat.html');
    el('navLobby').addEventListener('click', () => location.href = 'dashboard.html');
    el('navProfile').addEventListener('click', () => location.href = 'profile.html');
  }

  // ---- bootstrap ----
  (async function boot(){
    initMap();
    wireUI();
    await fetchSession();
    await renderCountries();

    // refresh periodically while page open (30s)
    setInterval(async () => {
      await renderCountries();
    }, 30000);
  })();

})();

===== ./join-rp.js =====

// join-rp.js — version améliorée : debounce search, clear button, modal confirmation,
// fallback countries, UX accessible, better error handling.

(() => {
  const countrySelect = document.getElementById('countrySelect');
  const countryFilter = document.getElementById('countryFilter');
  const filterClear = document.getElementById('countryFilterClear');
  const displayNameInput = document.getElementById('displayName');
  const submitBtn = document.getElementById('submitJoin');
  const skipBtn = document.getElementById('skipBtn');
  const loader = document.getElementById('loader');
  const msg = document.getElementById('msg');
  const preview = document.getElementById('countryPreview');

  // preview elements
  const cp = {
    flag: document.getElementById('cpFlag'),
    name: document.getElementById('cpName'),
    meta: document.getElementById('cpMeta'),
    desc: document.getElementById('cpDesc'),
    code: document.getElementById('cpCode'),
    pop: document.getElementById('cpPop'),
  };

  // confirmation modal (created dynamically to avoid modifying HTML too much)
  let modal = null;
  function ensureModal() {
    if (modal) return modal;
    modal = document.createElement('div');
    modal.className = 'modal';
    modal.innerHTML = `
      <div class="modal-box" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <h3 id="modalTitle" style="margin:0 0 8px 0">Confirmer ton choix</h3>
        <div id="modalBody" class="muted">Rejoindre ce pays ?</div>
        <div class="modal-actions">
          <button id="modalCancel" class="btn ghost small">Annuler</button>
          <button id="modalConfirm" class="btn primary">Rejoindre</button>
        </div>
      </div>`;
    document.body.appendChild(modal);

    // wire buttons
    modal.querySelector('#modalCancel').addEventListener('click', () => closeModal());
    modal.querySelector('#modalConfirm').addEventListener('click', () => {
      closeModal();
      performJoin(); // actually submit
    });

    // allow Esc to close
    document.addEventListener('keydown', (e) => {
      if (!modal.classList.contains('open')) return;
      if (e.key === 'Escape') closeModal();
    });

    return modal;
  }
  function openModal(text) {
    const m = ensureModal();
    m.querySelector('#modalBody').textContent = text || 'Rejoindre ce pays ?';
    m.classList.add('open');
    // focus confirm for keyboard users
    setTimeout(() => m.querySelector('#modalConfirm').focus(), 80);
  }
  function closeModal() {
    if (!modal) return;
    modal.classList.remove('open');
  }

  // API helper (wrap WC.apiFetch if present)
  const WC_API = window.WC && typeof window.WC.apiFetch === 'function' ? window.WC.apiFetch : null;

  async function apiFetch(url, opts) {
    if (WC_API) return WC_API(url, opts);
    opts = opts || {};
    opts.credentials = opts.credentials || 'same-origin';
    if (!opts.headers && !(opts.body instanceof FormData)) opts.headers = { 'Content-Type': 'application/json' };
    try {
      const r = await fetch(url, opts);
      const ct = r.headers.get('content-type') || '';
      let body = null;
      if (ct.includes('application/json')) body = await r.json(); else body = await r.text();
      if (!r.ok) return { ok: false, status: r.status, data: body, error: body && body.error ? body.error : (typeof body === 'string' ? body : 'Erreur') };
      return { ok: true, status: r.status, data: body };
    } catch (err) {
      return { ok: false, status: 0, error: err.message || 'Network error' };
    }
  }

  // UX helpers
  function setMsg(text = '', type = 'info') {
    if (!msg) return;
    msg.textContent = text;
    msg.classList.remove('msg-error','msg-success','msg-info');
    if (!text) return;
    msg.classList.add(type === 'success' ? 'msg-success' : type === 'error' ? 'msg-error' : 'msg-info');
  }
  function showLoader(show = true) {
    if (!loader) return;
    loader.classList.toggle('hidden', !show);
    loader.setAttribute('aria-hidden', String(!show));
  }

  function enableSubmit(enable = true) {
    if (!submitBtn) return;
    submitBtn.disabled = !enable;
    submitBtn.setAttribute('aria-disabled', String(!enable));
  }

  // Debounce utility for search
  function debounce(fn, wait = 250) {
    let t = null;
    return function (...args) {
      clearTimeout(t);
      t = setTimeout(() => fn.apply(this, args), wait);
    };
  }

  // small curated fallback if /api/countries fails (keeps UX alive)
  const FALLBACK_COUNTRIES = [
    { id: 'fr', name: 'France', continent: 'Europe', file: null, meta: { code: 'FR', pop: '67M' } },
    { id: 'us', name: 'États-Unis', continent: 'Amérique', file: null, meta: { code: 'US', pop: '331M' } },
    { id: 'alg', name: 'Algérie', continent: 'Afrique', file: null, meta: { code: 'DZ', pop: '44M' } },
    { id: 'ru', name: 'Russie', continent: 'Europe/Asie', file: null, meta: { code: 'RU', pop: '145M' } }
  ];

  let countriesList = [];
  let isSubmitting = false;

  // populate select with countries (sorted)
  function populateSelect(list) {
    countrySelect.innerHTML = '<option value="">-- Choisir un pays --</option>';
    list.sort((a,b) => (a.name||'').localeCompare(b.name||''));
    for (const c of list) {
      const opt = document.createElement('option');
      opt.value = c.id || c.id;
      opt.textContent = c.name || c.id;
      if (c.file) opt.dataset.file = c.file;
      if (c.continent) opt.dataset.continent = c.continent;
      if (c.meta) opt.dataset.meta = JSON.stringify(c.meta);
      countrySelect.appendChild(opt);
    }
  }

  function filterSelect(q) {
    q = (q || '').toLowerCase().trim();
    for (const opt of Array.from(countrySelect.options)) {
      if (!opt.value) continue;
      const txt = (opt.textContent || '').toLowerCase();
      opt.hidden = q ? !txt.includes(q) : false;
    }
    // show/ hide clear button
    if (filterClear) filterClear.hidden = !q;
  }

  function clearPreview() {
    if (!preview) return;
    preview.classList.add('hidden');
    preview.classList.remove('visible');
    cp.flag.textContent = '🌍';
    cp.name.textContent = '—';
    cp.meta.textContent = '';
    cp.desc.textContent = '';
    cp.code && (cp.code.textContent = 'Code —');
    cp.pop && (cp.pop.textContent = 'Pop —');
  }

  async function fetchCountryPreview() {
    clearPreview();
    const sel = countrySelect.selectedOptions?.[0];
    if (!sel || !sel.value) {
      enableSubmit(false);
      return;
    }
    // try to parse meta inline first
    const meta = sel.dataset.meta ? JSON.parse(sel.dataset.meta) : null;
    if (meta) {
      cp.flag.textContent = meta.flag_emoji || '🌍';
      cp.name.textContent = meta.name || sel.textContent;
      cp.meta.textContent = sel.dataset.continent || meta.region || '';
      cp.desc.textContent = meta.description || '';
      if (cp.code) cp.code.textContent = meta.code ? `Code ${meta.code}` : 'Code —';
      if (cp.pop) cp.pop.textContent = meta.pop ? `Pop ${meta.pop}` : 'Pop —';
      preview.classList.remove('hidden');
      preview.classList.add('visible');
      enableSubmit(true);
      return;
    }

    const file = sel.dataset.file;
    if (file) {
      showLoader(true);
      try {
        const r = await fetch(file, { credentials: 'same-origin' });
        if (r.ok) {
          const d = await r.json();
          cp.flag.textContent = d.flag_emoji || d.emoji || '🌍';
          cp.name.textContent = d.name || d.common || sel.textContent;
          cp.meta.textContent = d.region || d.continent || (sel.dataset.continent || '');
          cp.desc.textContent = d.description || d.summary || '';
          if (cp.code) cp.code.textContent = d.code ? `Code ${d.code}` : 'Code —';
          if (cp.pop) cp.pop.textContent = d.pop ? `Pop ${d.pop}` : 'Pop —';
          preview.classList.remove('hidden');
          preview.classList.add('visible');
        } else {
          cp.name.textContent = sel.textContent;
          preview.classList.remove('hidden');
          preview.classList.add('visible');
        }
      } catch (err) {
        cp.name.textContent = sel.textContent;
        preview.classList.remove('hidden');
        preview.classList.add('visible');
      } finally {
        showLoader(false);
      }
    } else {
      // fallback: use sel text and dataset
      cp.name.textContent = sel.textContent;
      cp.meta.textContent = sel.dataset.continent || '';
      if (cp.code) cp.code.textContent = sel.dataset.code || 'Code —';
      if (cp.pop) cp.pop.textContent = sel.dataset.pop || 'Pop —';
      preview.classList.remove('hidden');
      preview.classList.add('visible');
    }
    enableSubmit(true);
  }

  // load countries from API, fallback to local list if necessary
  async function loadCountries() {
    countrySelect.innerHTML = '<option value="">— Chargement —</option>';
    showLoader(true);
    try {
      const r = await apiFetch('/api/countries', { method: 'GET' });
      showLoader(false);
      if (!r.ok || !r.data) {
        // fallback
        countriesList = FALLBACK_COUNTRIES.slice();
        setMsg('Liste des pays indisponible — mode démo.', 'info');
        populateSelect(countriesList);
        return;
      }
      // expect r.data.countries or array
      countriesList = Array.isArray(r.data.countries) ? r.data.countries : (Array.isArray(r.data) ? r.data : []);
      if (!countriesList.length) {
        countriesList = FALLBACK_COUNTRIES.slice();
        setMsg('Aucun pays trouvé — mode démo.', 'info');
      } else {
        setMsg('', 'info');
      }
      populateSelect(countriesList);
    } catch (err) {
      showLoader(false);
      countriesList = FALLBACK_COUNTRIES.slice();
      populateSelect(countriesList);
      setMsg('Erreur réseau — liste pays en mode local.', 'info');
    }
  }

  // handle submit flow with modal confirmation
  async function formSubmitHandler(e) {
    e && e.preventDefault();
    setMsg('', 'info');

    const country_id = (countrySelect.value || '').trim();
    const country_name = countrySelect.selectedOptions?.[0]?.textContent || null;
    const displayName = (displayNameInput.value || '').trim() || null;

    if (!country_id) { setMsg('Choisis un pays.', 'error'); return; }
    // show modal confirmation
    openModal(`Confirmer : rejoindre ${country_name}${displayName ? ` — sous le nom ${displayName}` : ''} ?`);
  }

  // actual network join request (called after modal confirm)
  async function performJoin() {
    if (isSubmitting) return;
    isSubmitting = true;
    showLoader(true);
    enableSubmit(false);
    setMsg('', 'info');

    const country_id = (countrySelect.value || '').trim();
    const country_name = countrySelect.selectedOptions?.[0]?.textContent || null;
    const displayName = (displayNameInput.value || '').trim() || null;

    const origText = submitBtn.textContent;
    submitBtn.textContent = 'Envoi…';

    try {
      const r = await apiFetch('/api/user/join-rp', {
        method: 'POST',
        body: JSON.stringify({ country_id, country_name, displayName })
      });

      showLoader(false);
      isSubmitting = false;

      if (!r.ok) {
        setMsg('Erreur : ' + (r.error || (r.data && r.data.error) || 'Impossible de rejoindre.'), 'error');
        enableSubmit(true);
        submitBtn.textContent = origText;
        return;
      }

      // handle common backend contracts
      const data = r.data || {};
      const assigned = data.assigned || r.assigned;
      const next = data.next || r.next;

      if (assigned === 'leader') {
        setMsg('Tu es le premier membre — tu es maintenant dirigeant. Redirection…', 'success');
        setTimeout(() => window.location.href = 'dashboard.html', 700);
        return;
      }
      if (next === '/choose-role.html' || next === 'choose-role') {
        setMsg('Étape suivante : choisir un rôle — redirection…', 'info');
        setTimeout(() => window.location.href = '/choose-role.html', 600);
        return;
      }

      setMsg('Inscription prise en compte — redirection…', 'success');
      setTimeout(() => window.location.href = 'dashboard.html', 700);
    } catch (err) {
      console.error(err);
      showLoader(false);
      isSubmitting = false;
      setMsg('Erreur réseau — réessaie plus tard.', 'error');
      enableSubmit(true);
      submitBtn.textContent = origText;
    }
  }

  // wire up events
  countryFilter.addEventListener('input', debounce((e) => filterSelect(e.target.value), 180));
  if (filterClear) {
    filterClear.addEventListener('click', () => {
      countryFilter.value = '';
      filterSelect('');
      filterClear.hidden = true;
      countryFilter.focus();
    });
  }

  countrySelect.addEventListener('change', fetchCountryPreview);
  displayNameInput.addEventListener('input', () => {
    // no strict validation — but re-evaluate state (keeps button enabled if country chosen)
    enableSubmit(Boolean(countrySelect.value));
  });

  // form submit attaches confirmation modal
  const form = document.getElementById('joinForm');
  if (form) form.addEventListener('submit', formSubmitHandler);

  // skip button
  skipBtn.addEventListener('click', () => { window.location.href = 'dashboard.html'; });

  // on DOM ready bootstrap sequence
  (async () => {
    await loadCountries();
    clearPreview();
    enableSubmit(false);

    // session check — keep behaviour but softer: redirect only if no session
    try {
      const r = await apiFetch('/api/session', { method: 'GET' });
      if (!r.ok || !r.data || !r.data.ok) {
        // not authenticated — redirect to index/login
        window.location.href = 'index.html';
        return;
      }
      if (r.data.rp && r.data.rp.joined) {
        // already joined — redirect
        window.location.href = 'dashboard.html';
        return;
      }
    } catch (e) {
      // network issues — allow the user to continue with fallback countries
    }
  })();

  // expose performJoin for modal confirm to call
  window.__WC_performJoin = performJoin;

  // connect modal confirm action to performJoin (safer reference)
  // ensureModal was created on demand and its confirm already binds to performJoin via closure
})();

===== ./generate_oceania.js =====

// generate_oceania.js
// Usage:
//   node generate_oceania.js            -> crée fichiers si absents (ne pas écraser)
//   node generate_oceania.js --force    -> écrase les fichiers existants
//
// Place ce fichier à la racine du projet (~/WorldConflict) et exécute-le avec node.

const fs = require('fs');
const path = require('path');

const FORCE = process.argv.includes('--force');

function slugify(name) {
  return name
    .normalize('NFD').replace(/[\u0300-\u036f]/g, '') // enlever accents
    .toLowerCase()
    .replace(/['’"]/g, '') // virer apostrophes/marques
    .replace(/[^a-z0-9\s-]/g, '') // garder alnum espace -
    .trim()
    .replace(/\s+/g, '-');
}

// Liste complète Océanie
// id = identifiant court (3 lettres ou custom), name = nom affiché
const OCEANIA = [
  { id: 'aus', name: 'Australia' },
  { id: 'fji', name: 'Fiji' },
  { id: 'kir', name: 'Kiribati' },
  { id: 'mhl', name: 'Marshall Islands' },
  { id: 'fsm', name: 'Micronesia' },
  { id: 'nru', name: 'Nauru' },
  { id: 'nzl', name: 'New Zealand' },
  { id: 'plw', name: 'Palau' },
  { id: 'png', name: 'Papua New Guinea' },
  { id: 'smr', name: 'Samoa' },
  { id: 'slb', name: 'Solomon Islands' },
  { id: 'ton', name: 'Tonga' },
  { id: 'tuv', name: 'Tuvalu' },
  { id: 'vut', name: 'Vanuatu' }
];

const outDir = path.join(process.cwd(), 'map', 'world', 'oceania');
if (!fs.existsSync(outDir)) fs.mkdirSync(outDir, { recursive: true });

const today = new Date().toISOString().slice(0, 10); // YYYY-MM-DD

let created = 0, skipped = 0, overwritten = 0;

OCEANIA.forEach(c => {
  const slug = slugify(c.name);
  const fileName = `${slug}.json`;
  const filePath = path.join(outDir, fileName);

  const payload = {
    id: (c.id || slug).toLowerCase(),
    name: c.name,
    continent: 'oceania',
    metadata: {
      created_at: today,
      updated_at: null
    },
    government: {
      leader: null,
      ministers: [],
      system: null
    },
    population: {
      value: 0,
      growth_rate: 0
    },
    economy: {
      gdp: 0,
      resources: {}
    },
    military: {
      active: 0,
      reserve: 0,
      equipment: {}
    },
    geography: {
      area_km2: 0,
      major_cities: [],
      climate_zones: [],
      borders: []
    },
    status: {
      occupied: false,
      contested: false
    }
  };

  if (fs.existsSync(filePath)) {
    if (FORCE) {
      fs.writeFileSync(filePath, JSON.stringify(payload, null, 2), 'utf8');
      overwritten++;
      console.log(`overwritten: ${fileName}`);
    } else {
      skipped++;
      console.log(`skipped: ${fileName} (exists)`);
    }
  } else {
    fs.writeFileSync(filePath, JSON.stringify(payload, null, 2), 'utf8');
    created++;
    console.log(`created: ${fileName}`);
  }
});

console.log('\nSummary:');
console.log(`  created: ${created}`);
console.log(`  overwritten: ${overwritten}`);
console.log(`  skipped: ${skipped}`);
console.log(`Files generated in: ${outDir}`);

===== ./txt/WorldConflictAllCode.txt =====


===== ./variables.css =====

/* variables.css — Global design tokens and bottom-nav theme
   - Centralizes color, spacing, radius, shadow and interaction tokens
   - Designed for the project's dark theme (matches existing pages)
   - Overwrite the current variables.css with this content
*/

/* ---------------------------
   CORE THEME VARIABLES
   --------------------------- */
:root {
  /* Palette */
  --bg: #0b1020;                /* page background */
  --surface: #0f1724;           /* main panels / cards */
  --panel-bg: var(--surface);
  --text: #e6eef8;              /* primary text */
  --muted: #9aa4b2;             /* secondary text */
  --muted-contrast: rgba(230,238,248,0.72);

  /* Accents */
  --accent1: #4f46e5;           /* primary accent (violet) */
  --accent2: #06b6d4;           /* secondary accent (turquoise) */
  --on-accent: #ffffff;         /* text color on accent */

  /* Semantic colors */
  --success: #16a34a;
  --danger: #ef4444;
  --warning: #f59e0b;
  --info: #60a5fa;

  /* Glass / subtle layers */
  --glass: rgba(255,255,255,0.03);
  --glass-strong: rgba(255,255,255,0.06);

  /* Borders / strokes */
  --muted-border: rgba(255,255,255,0.04);
  --border-strong: rgba(255,255,255,0.06);

  /* Chips / small surfaces */
  --chip-bg: rgba(255,255,255,0.02);
  --chip-text: var(--text);

  /* Shadows / elevation */
  --shadow-xs: 0 2px 8px rgba(2,6,23,0.32);
  --shadow-sm: 0 6px 18px rgba(2,6,23,0.36);
  --card-elev: 0 14px 40px rgba(2,6,23,0.44);

  /* Typography & fonts */
  --font-stack: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  --text-size-base: 15px;

  /* Sizes & geometry */
  --radius: 12px;
  --radius-sm: 10px;
  --space-xs: 6px;
  --space-sm: 10px;
  --space-md: 16px;
  --space-lg: 24px;

  /* Interaction */
  --transition: 180ms cubic-bezier(.2,.9,.2,1);
}

/* ---------------------------
   BOTTOM-NAV SPECIFIC VARIABLES
   --------------------------- */
:root {
  /* container */
  --nav-bottom-offset: 18px;
  --nav-max-width: 980px;
  --nav-pill-radius: 14px;

  /* item sizing */
  --nav-item-min-width: 84px;
  --nav-item-height: 52px;
  --nav-icon-size: 18px;
  --nav-font-size: 13px;

  /* colors */
  --nav-bg: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.004));
  --nav-border: rgba(255,255,255,0.03);
  --nav-text: var(--muted);
  --nav-active-text: var(--on-accent);

  /* active style */
  --nav-active-bg: linear-gradient(90deg, var(--accent1), var(--accent2));
  --nav-active-elev: 0 14px 32px rgba(79,70,229,0.18);
  --nav-active-translate: -4px;

  /* subtle hover */
  --nav-hover-bg: rgba(255,255,255,0.02);
  --nav-hover-color: var(--accent2);

  /* focus / outline */
  --nav-focus-outline: 3px solid rgba(79,70,229,0.12);

  /* ripple */
  --nav-ripple-color: rgba(255,255,255,0.06);

  /* icon filter fallback */
  --nav-icon-filter: none;
}

/* ---------------------------
   Base reset & utilities
   --------------------------- */
* { box-sizing: border-box; }

html, body {
  height: 100%;
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-stack);
  font-size: var(--text-size-base);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  margin: 0;
  padding: 0;
}

/* basic helpers */
.hidden { display: none !important; }
.container { width: 100%; max-width: 1100px; margin: 0 auto; padding: 0 16px; }

.btn {
  padding: 10px 14px;
  border-radius: calc(var(--radius) / 1.2);
  transition: all var(--transition);
  cursor: pointer;
  font-weight: 700;
  border: 1px solid transparent;
  background: transparent;
  color: var(--text);
}

.btn-primary {
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  color: var(--on-accent);
  box-shadow: var(--shadow-sm);
  border-color: transparent;
}

/* Inline messages */
.msg { font-size: 0.95rem; padding: 8px 10px; border-radius: 8px; margin-top: 8px; }
.msg-error { background: rgba(239,68,68,0.06); color: #ffb3b3; border: 1px solid rgba(239,68,68,0.08); }
.msg-success { background: rgba(16,185,129,0.04); color: #bfffd6; border: 1px solid rgba(16,185,129,0.06); }
.msg-info { background: rgba(96,165,250,0.04); color: #dbe9ff; border: 1px solid rgba(96,165,250,0.06); }

/* Accessibility */
:focus { outline: none; }

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  :root { --transition: 1ms linear; }
}

/* ---------------------------
   Form / Input tokens
   --------------------------- */
:root {
  --input-bg: rgba(255,255,255,0.01);
  --input-border: var(--muted-border);
  --input-radius: 8px;
  --placeholder: rgba(255,255,255,0.34);
}

/* Small components tokens */
:root {
  --chip-padding: 6px 8px;
  --chip-radius: 8px;
  --badge-bg: rgba(255,255,255,0.02);
  --badge-text: var(--text);
}

/* ---------------------------
   Bottom nav styles (drop-in)
   Uses variables defined above — do not duplicate in page css
   --------------------------- */

/* Outer container — centered pill with shadow, floats above content */
.bottom-nav {
  position: fixed;
  left: 0;
  right: 0;
  bottom: var(--nav-bottom-offset);
  display: flex;
  justify-content: center;
  z-index: 999;
  pointer-events: auto;
  padding: 0 12px;
}

/* the pill that contains buttons — centers and constrains width */
.bottom-nav .nav-pill {
  width: min(calc(100% - 32px), var(--nav-max-width));
  display: flex;
  gap: 10px;
  align-items: center;
  justify-content: center;
  padding: 8px;
  border-radius: var(--nav-pill-radius);
  background: var(--nav-bg);
  border: 1px solid var(--nav-border);
  box-shadow: var(--card-elev);
  backdrop-filter: blur(6px);
}

/* each button — balanced spacing and typography */
.bottom-nav .nav-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  min-width: var(--nav-item-min-width);
  height: var(--nav-item-height);
  padding: 8px 12px;
  border-radius: calc(var(--nav-pill-radius) - 4px);
  border: 1px solid transparent;
  background: transparent;
  color: var(--nav-text);
  font-weight: 700;
  font-size: var(--nav-font-size);
  cursor: pointer;
  transition: transform var(--transition), box-shadow var(--transition), background var(--transition), color var(--transition);
  position: relative;
  overflow: hidden;
}

/* optional icon area (keeps layout predictable) */
.bottom-nav .nav-btn .nav-icon {
  width: var(--nav-icon-size);
  height: var(--nav-icon-size);
  display: inline-block;
  flex: 0 0 var(--nav-icon-size);
  transform: translateZ(0);
  filter: var(--nav-icon-filter);
}

/* label text */
.bottom-nav .nav-btn .nav-label {
  display: inline-block;
  line-height: 1;
}

/* hover/focus — subtle highlight */
.bottom-nav .nav-btn:hover,
.bottom-nav .nav-btn:focus {
  background: var(--nav-hover-bg);
  color: var(--nav-hover-color);
  transform: translateY(-2px);
  box-shadow: 0 10px 26px rgba(6,11,41,0.06);
  outline: none;
}

/* active state — visually prominent, pops out */
.bottom-nav .nav-btn.active {
  color: var(--nav-active-text);
  background: var(--nav-active-bg);
  transform: translateY(var(--nav-active-translate));
  box-shadow: var(--nav-active-elev);
  border-color: transparent;
}

/* focus-visible (keyboard users) */
.bottom-nav .nav-btn:focus-visible {
  box-shadow: var(--nav-focus-outline);
  transform: translateY(-2px);
}

/* ripple effect created with pseudo-element */
.bottom-nav .nav-btn::after {
  content: "";
  position: absolute;
  left: 50%;
  top: 50%;
  width: 8px;
  height: 8px;
  background: var(--nav-ripple-color);
  border-radius: 50%;
  transform: translate(-50%, -50%) scale(0);
  opacity: 0;
  transition: transform 420ms cubic-bezier(.2,.9,.2,1), opacity 320ms linear;
  pointer-events: none;
}
.bottom-nav .nav-btn:active::after {
  transform: translate(-50%, -50%) scale(20);
  opacity: 1;
  transition: transform 220ms cubic-bezier(.18,.8,.3,1), opacity 420ms linear;
}

/* responsive collapse: when narrow we compact spacing and allow icons-only */
@media (max-width: 640px) {
  :root {
    --nav-item-min-width: 64px;
    --nav-font-size: 12px;
    --nav-icon-size: 16px;
    --nav-item-height: 46px;
  }

  .bottom-nav .nav-pill {
    gap: 6px;
    padding: 6px;
  }

  /* per-page control: .icon-only will hide labels */
  .bottom-nav.icon-only .nav-btn .nav-label { display: none; }
}

/* utility: full-width variant (if preferring centered pill removed) */
.bottom-nav.fullwidth {
  bottom: 0;
  left: 0;
  right: 0;
  padding: 0;
}
.bottom-nav.fullwidth .nav-pill {
  width: 100%;
  border-radius: 0;
  padding: 10px;
  justify-content: space-around;
}

/* ensure bottom-nav never covers critical content on small screens */
@media (max-height: 640px) {
  body { padding-bottom: calc(var(--nav-item-height) + var(--nav-bottom-offset) + 16px); }
}

/* small niceties: accessible hidden text for icons-only */
.visually-hidden {
  position: absolute !important;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0 0 0 0);
  white-space: nowrap;
  border: 0;
}

/* ---------------------------
   END of variables.css
   --------------------------- */

===== ./register.html =====

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Créer un compte — WorldConflict</title>
  <link rel="stylesheet" href="variables.css">
  <link rel="stylesheet" href="register.css">
</head>
<body>
  <main class="register-container">
    <section class="register-box">
      <h1>Créer un compte</h1>

      <form id="registerForm" novalidate>
        <label for="username">Nom d'utilisateur</label>
        <input type="text" id="username" name="username" placeholder="Ton pseudo" required>

        <label for="email">Adresse e-mail</label>
        <input type="email" id="email" name="email" placeholder="exemple@email.com" required>

        <label for="password">Mot de passe</label>
        <div class="password-box">
          <input type="password" id="password" name="password" placeholder="Mot de passe" required>
          <button type="button" id="togglePassword" title="Afficher le mot de passe">👁️</button>
        </div>

        <label for="confirm">Confirme ton mot de passe</label>
        <input type="password" id="confirm" name="confirm" placeholder="Répète le mot de passe" required>

        <!-- Checkbox + lien bleu (ouvre rules.html si l'utilisateur veut lire) -->
        <label class="accept-terms" style="display:flex;align-items:flex-start;gap:10px;margin-top:8px;">
          <input id="acceptCheckbox" type="checkbox" />
          <span style="line-height:1.25;">
            Je confirme avoir lu la
            <a href="rules.html" id="rulesLink" class="rules-link" target="_blank" rel="noopener noreferrer"
               style="color:#00aff4;text-decoration:underline;cursor:pointer;">
              politique de confidentialité et règlements
            </a>
            et je les accepte.
          </span>
        </label>

        <button type="submit" class="btn primary" id="submitBtn" style="margin-top:12px;">Créer un compte</button>

        <p class="back-login" style="text-align:center;margin-top:12px;">Déjà un compte ?
          <a href="index.html">Se connecter</a>
        </p>
      </form>

    </section>

    <footer>
      <p style="text-align:center;color:#72767d;font-size:0.85rem;">© <span id="year"></span> WorldConflict. Tous droits réservés.</p>
    </footer>
  </main>

  <script src="register.js" defer></script>
</body>
</html>

===== ./index.html =====

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WorldConflict — Connexion</title>
  <link rel="stylesheet" href="variables.css">
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <main class="app">
    <section class="hero">
      <div class="brand">
        <!-- Simple SVG logo -->
        <svg class="logo" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <defs>
            <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0%" stop-color="#4f46e5" />
              <stop offset="100%" stop-color="#06b6d4" />
            </linearGradient>
          </defs>
          <rect rx="10" width="48" height="48" fill="url(#g)" />
          <path d="M12 16c6-6 24 0 24 0s-6 12-12 18S12 16 12 16z" fill="#0f172a" opacity="0.08"/>
          <path d="M16 20c4-4 12 0 12 0s-3 6-6 9-10-9-6-9z" fill="#fff" opacity="0.9"/>
        </svg>
        <div class="brand-text">
          <h1>WorldConflict</h1>
          <p class="tag">Serveur · Jeu · Communauté</p>
        </div>
      </div><div class="hero-illustration" aria-hidden="true">
    <div class="cards">
      <div class="card card-1"></div>
      <div class="card card-2"></div>
      <div class="card card-3"></div>
    </div>
  </div>
</section>

<section class="auth">
  <form id="loginForm" class="card form" novalidate>
    <h2>Connexion</h2>
    <p class="muted">Connecte-toi pour rejoindre ton serveur WorldConflict</p>

    <label class="field">
      <span class="label">Email ou nom d'utilisateur</span>
      <input id="userInput" name="user" type="text" inputmode="email" autocomplete="username" required />
    </label>

    <label class="field">
      <span class="label">Mot de passe</span>
      <div class="passwrap">
        <input id="passwordInput" name="password" type="password" autocomplete="current-password" required minlength="6" />
        <button type="button" id="togglePassword" aria-label="Afficher le mot de passe">👁️</button>
      </div>
    </label>

    <div class="row between">
      <label class="checkbox">
        <input type="checkbox" name="remember" /> <span>Se souvenir</span>
      </label>
      <a class="link" href="#">Mot de passe oublié ?</a>
    </div>

    <button class="btn primary" type="submit">Se connecter</button>

    <div class="sep"><span>OU</span></div>

    <button type="button" class="btn ghost" id="createAccount">Créer un compte</button>

    <p class="meta muted">En te connectant, tu acceptes notre règlement.</p>
  </form>

  <footer class="legal">
    <p>© <span id="year"></span> WorldConflict</p>
  </footer>
</section>
<script src="utils.js" defer></script>
<script src="index.js" defer></script>
</body>
</html>

===== ./market.css =====

/* market.css — refonte totale pour coller au style global du projet
   Utilise les variables définies dans index.css (accent1/2, surface, glass, card-shadow, radius).
   Responsive — 3 colonnes sur desktop, empilement sur mobile.
*/

/* layout container similaire aux autres pages */
.container {
  max-width: 980px;
  margin: 18px auto;
  padding: 0 16px;
}

/* shell fallback (présent dans market.html) */
.shell {
  width: 100%;
  max-width: 980px;
  margin: 18px auto;
  padding: 0 16px 120px; /* espace pour bottom-nav */
  box-sizing: border-box;
  color: inherit;
}

/* header */
.market-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 12px;
}

.market-header .title {
  font-size: 18px;
  font-weight: 800;
  color: var(--text, #e6eef8);
}

.market-header .muted {
  color: var(--muted);
  font-size: 13px;
}

/* page grid: left catalog, center market panel, right snapshot */
.market-wrapper {
  display: grid;
  grid-template-columns: 300px 1fr 320px;
  gap: 16px;
  align-items: start;
}

/* Panels — reuse project card style */
.panel {
  padding: 14px;
  border-radius: var(--radius, 12px);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.003));
  border: 1px solid rgba(255,255,255,0.03);
  box-shadow: var(--card-shadow);
  color: inherit;
}

/* Catalog (left) */
.catalog .search {
  display: flex;
  gap: 8px;
  margin-bottom: 10px;
}
.catalog input[type="text"],
.catalog input {
  flex: 1;
  padding: 10px 12px;
  border-radius: 10px;
  background: var(--glass);
  border: 1px solid rgba(255,255,255,0.03);
  color: inherit;
  font-size: 14px;
}

.item-list {
  max-height: calc(100vh - 260px);
  overflow: auto;
  display: grid;
  gap: 8px;
  padding-right: 6px;
}

/* item button matches global button aesthetics */
.item-list button {
  text-align: left;
  width: 100%;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.02);
  background: linear-gradient(180deg, rgba(255,255,255,0.006), rgba(255,255,255,0.002));
  color: inherit;
  cursor: pointer;
  font-weight: 700;
}
.item-list button:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(79,70,229,0.06);
}

/* center market panel */
.market-panel-inner { display: flex; flex-direction: column; gap: 12px; }

.selected-item {
  font-weight: 800;
  font-size: 15px;
  color: var(--text);
  margin-bottom: 6px;
}

/* form fields consistent with other pages */
.field { display: flex; flex-direction: column; gap: 6px; margin-bottom: 6px; }
.label { font-size: 13px; color: var(--muted); }
.text-input, input[type="number"], input[type="text"] {
  padding: 10px 12px;
  border-radius: 10px;
  background: var(--glass);
  border: 1px solid rgba(255,255,255,0.03);
  color: inherit;
  font-size: 14px;
}

/* two columns form areas */
.two-cols { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

/* quote/result area */
.quote-row { display:flex; gap: 12px; align-items:center; }
.quote-result { font-weight:800; color:var(--text); }

/* trade controls */
.trade-controls { margin-top: 8px; display: flex; flex-direction: column; gap: 8px; }
.trade-controls .two-cols { grid-template-columns: 1fr 1fr; }

/* button variants reusing global style */
.btn {
  padding: 10px 14px;
  border-radius: 10px;
  cursor: pointer;
  border: 0;
  font-weight: 800;
}
.btn-ghost { background: transparent; border: 1px solid rgba(255,255,255,0.04); color: inherit; }
.btn-primary {
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  color: #fff;
  box-shadow: 0 10px 30px rgba(79,70,229,0.14);
}
.btn-success {
  background: linear-gradient(90deg, #059669, #10b981);
  color: #fff;
  box-shadow: 0 8px 24px rgba(5,102,93,0.12);
}
.btn-danger {
  background: linear-gradient(90deg, #ef4444, #dc2626);
  color: #fff;
}

/* price breakdown panel */
#priceBreakdown { padding: 10px; border-radius: 10px; background: rgba(255,255,255,0.01); border: 1px solid rgba(255,255,255,0.02); }
#breakdownPre { white-space: pre-wrap; font-size: 13px; color: var(--muted); }

/* trades (right) */
.trades-panel .trade-list { display:grid; gap:8px; max-height: calc(100vh - 270px); overflow:auto; padding-right:6px; }
.trade-item {
  padding: 10px;
  border-radius: 10px;
  background: linear-gradient(180deg, rgba(255,255,255,0.006), rgba(255,255,255,0.002));
  border: 1px solid rgba(255,255,255,0.02);
  font-size: 14px;
}
.trade-item .muted { color: var(--muted); font-size: 12px; margin-top: 6px; }

/* small utilities */
.muted { color: var(--muted); font-size: 13px; }
.mini { font-size: 12px; color: var(--muted); }

/* visually-hidden reuse */
.visually-hidden { display: none !important; }

/* bottom-nav — match profile/settings style exactly */
.bottom-nav {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 18px;
  display: flex;
  justify-content: center;
  gap: 10px;
  z-index: 60;
  pointer-events: auto;
}
.nav-btn {
  min-width: 84px;
  height: 48px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.03);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.004));
  color: var(--muted);
  padding: 8px 12px;
  font-weight: 700;
  cursor: pointer;
}
.nav-btn.active {
  color: #fff;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  transform: translateY(-3px);
  box-shadow: 0 14px 32px rgba(79,70,229,0.18);
}

/* responsive */
@media (max-width: 980px) {
  .market-wrapper { grid-template-columns: 1fr; }
  .catalog { order: 2; }
  .market-panel { order: 1; }
  .trades-panel { order: 3; }
  .item-list { max-height: 220px; }
  .two-cols { grid-template-columns: 1fr; }
}

/* small screens final tweaks */
@media (max-width: 420px) {
  .selected-item { font-size: 14px; }
  .market-header { padding: 6px 0; }
}

===== ./profile.html =====

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WorldConflict — Profil</title>

  <link rel="stylesheet" href="variables.css">
  <link rel="stylesheet" href="profile.css">
</head>
<body>
  <div class="pc-shell container">

    <!-- top-left settings button -->
    <header class="pc-header">
      <a id="btnSettings" class="icon-btn" href="settings.html" title="Paramètres (⚙️)">⚙️</a>
      <div class="pc-title">Profil</div>
      <div></div>
    </header>

    <main class="pc-main">
      <section class="card profile-card">
        <div class="profile-top">
          <div id="avatar" class="avatar avatar-xl" aria-hidden="true">WC</div>
          <div class="profile-meta">
            <h1 id="usernameDisplay">—</h1>
            <div id="displayName" class="muted">—</div>
            <div class="profile-actions">
              <button id="btnMessage" class="btn btn-ghost small">Message</button>
              <button id="btnFollow" class="btn btn-ghost small">Suivre</button>
            </div>
          </div>
        </div>

        <div class="profile-body">
          <dl class="profile-grid">
            <div><dt>Utilisateur</dt><dd id="profileUser">—</dd></div>
            <div><dt>E-mail</dt><dd id="profileEmail">—</dd></div>
            <div><dt>Pays RP</dt><dd id="rpCountry">—</dd></div>
            <div><dt>Rôle RP</dt><dd id="rpRole">—</dd></div>
            <div><dt>Nom RP</dt><dd id="rpDisplay">—</dd></div>
            <div><dt>Inscription</dt><dd id="createdAt">—</dd></div>
          </dl>
        </div>
      </section>
    </main>

    <!-- bottom nav (identique style à dashboard) -->
    <nav class="bottom-nav" aria-label="Navigation">
      <button id="nav-chat" class="nav-btn" title="Chat">Chat</button>
      <button id="nav-lobby" class="nav-btn" title="Lobby">Lobby</button>
      <button id="nav-notifs" class="nav-btn" title="Notifications">Notif</button>
      <button id="nav-profile" class="nav-btn active" title="Profil">Profil</button>
    </nav>

  </div>

  <script src="utils.js" defer></script>
  <script src="profile.js" defer></script>
</body>
</html>

===== ./rules.html =====

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WorldConflict — Règlement</title>
  <link rel="stylesheet" href="variables.css">
  <link rel="stylesheet" href="rules.css">
</head>
<body>
  <main class="wrap container">
    <header class="header" role="banner">
      <div class="brand">
        <svg class="logo" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
          <defs>
            <linearGradient id="g2" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0%" stop-color="#4f46e5" />
              <stop offset="100%" stop-color="#06b6d4" />
            </linearGradient>
          </defs>
          <rect rx="10" width="48" height="48" fill="url(#g2)" />
          <path d="M12 16c6-6 24 0 24 0s-6 12-12 18S12 16 12 16z" fill="#0f172a" opacity="0.06"/>
          <path d="M16 20c4-4 12 0 12 0s-3 6-6 9-10-9-6-9z" fill="#fff" opacity="0.9"/>
        </svg>

        <div class="brand-text">
          <h1>WorldConflict</h1>
          <p class="muted">Règlement officiel — informations et bonnes pratiques</p>
        </div>
      </div>

      <nav class="header-actions" aria-label="Actions">
        <a class="link back" href="index.html">← Retour</a>
        <button id="printBtn" class="btn btn-small" title="Imprimer la page">Imprimer</button>
      </nav>
    </header>

    <div class="layout">
      <aside class="toc" aria-labelledby="tocTitle">
        <div class="toc-head">
          <h2 id="tocTitle">Sommaire</h2>
          <input id="rulesSearch" class="toc-search" type="search" placeholder="Rechercher dans le règlement…" aria-label="Rechercher le règlement">
        </div>
        <nav id="tocList" class="toc-list" role="navigation" aria-label="Table des matières"></nav>
        <div class="toc-foot muted">© <span id="year"></span> WorldConflict</div>
      </aside>

      <article class="card rules content" id="rulesContent">
        <h2>Règlement — Conditions et comportements</h2>
        <p class="lead muted">Lis attentivement : ces règles encadrent le fonctionnement et la sécurité de la communauté. Cette page est informative — aucune action d'acceptation n'est requise ici.</p>

        <section class="section" id="respect">
          <h3>1. Respect et comportement</h3>
          <p>La communauté repose sur le respect mutuel. Comportements proscrits :</p>
          <ul>
            <li>Insultes, harcèlement, menaces ou attaques personnelles.</li>
            <li>Discours haineux, racisme, sexisme ou discriminations.</li>
            <li>Spam, trolling, doxxing ou perturbation volontaire du RP.</li>
          </ul>
        </section>

        <section class="section" id="chat-content">
          <h3>2. Chat et contenu</h3>
          <p>Consignes relatives aux messages et aux contenus partagés :</p>
          <ul>
            <li>Ne publie pas de contenu NSFW, violent ou choquant dans les espaces publics.</li>
            <li>Ne partage pas d’informations personnelles tierces sans consentement.</li>
            <li>Respecte le thème et les règles propres à chaque canal RP.</li>
          </ul>
        </section>

        <section class="section" id="game-fairplay">
          <h3>3. Jeu et fair-play</h3>
          <ul>
            <li>Toute triche, exploitation de bug, macro ou hack peut conduire à un bannissement immédiat.</li>
            <li>Respecte les décisions des administrateurs et des instances RP compétentes.</li>
            <li>Les litiges de jeu sont gérés par l’équipe selon les règles du serveur.</li>
          </ul>
        </section>

        <section class="section" id="sanctions">
          <h3>4. Sanctions</h3>
          <p>Processus général : avertissement → suspension temporaire → bannissement définitif selon la gravité et la répétition.</p>
          <ul>
            <li>Les modérateurs appliquent les sanctions après examen.</li>
            <li>Les décisions peuvent être révisées en cas d’appel ou d’éléments nouveaux.</li>
          </ul>
        </section>

        <section class="section" id="security">
          <h3>5. Sécurité & confidentialité</h3>
          <ul>
            <li>Utilise un mot de passe fort et ne le partage jamais.</li>
            <li>Active la double authentification si proposée.</li>
            <li>Signale immédiatement tout comportement suspect ou vulnérabilité aux modérateurs.</li>
          </ul>
        </section>

        <section class="section" id="moderation-appeal">
          <h3>6. Contestation & procédure</h3>
          <p>Si tu souhaites contester une décision :</p>
          <ul>
            <li>Contacte un administrateur en fournissant les éléments pertinents (captures, logs).</li>
            <li>La procédure d’appel peut prendre du temps : sois patient et factuel.</li>
          </ul>
        </section>

        <section class="section" id="legal">
          <h3>7. Données & conformité</h3>
          <p>Respect de la confidentialité :</p>
          <ul>
            <li>Les demandes de suppression ou d’export de données seront traitées conformément à la législation applicable.</li>
            <li>Ne partage pas de contenus protégés par le droit d’auteur sans autorisation.</li>
          </ul>
        </section>

        <div class="meta muted" style="margin-top:18px;">
          <p>Document maintenu par l’équipe WorldConflict. Dernière mise à jour : <time datetime="">—</time></p>
        </div>
      </article>
    </div>
  </main>

  <script src="rules.js" defer></script>
</body>
</html>

===== ./chat.css =====

/* chat.css — version améliorée finale */

/* tokens */
:root{
  --nav-height: 72px;
  --panel-radius: 12px;
  --sidebar-width: 260px;
  --sidebar-min: 200px;
  --right-width: 320px;
  --glass-2: rgba(255,255,255,0.02);
  --muted: rgba(255,255,255,0.55);
  --accent1: #4f46e5;
  --accent2: #06b6d4;
  --bg: #071025;
  --text: #e6eef8;
  --glass: rgba(255,255,255,0.02);
  --font-stack: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  --toast-bg: rgba(0,0,0,0.6);
}

/* base */
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:var(--font-stack);background:linear-gradient(180deg,var(--bg),#050612);color:var(--text);-webkit-font-smoothing:antialiased}
.app-shell{min-height:100vh;display:flex;flex-direction:column}

/* header */
.wc-header.minimalist{display:flex;align-items:center;justify-content:center;padding:14px 20px;max-width:1200px;margin:0 auto;position:relative}
.header-actions{position:absolute;right:18px;top:12px;display:flex;gap:8px;align-items:center}
.round-btn{width:40px;height:40px;border-radius:999px;display:inline-flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.004));border:1px solid rgba(255,255,255,0.04);box-shadow:0 8px 20px rgba(2,6,23,0.55);cursor:pointer}
.round-btn svg{width:18px;height:18px}
.round-btn:focus{outline:3px solid rgba(79,70,229,0.12);outline-offset:3px}

/* grid */
.chat-container{
  max-width:1200px;
  width:100%;
  margin:14px auto calc(var(--nav-height) + 28px);
  padding:0 16px;
  display:grid;
  grid-template-columns: clamp(var(--sidebar-min), var(--sidebar-width), 320px) 1fr minmax(220px, var(--right-width));
  gap:16px;
  align-items:start;
  min-height: calc(100vh - var(--nav-height) - 56px);
}

/* panel */
.panel{background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.003));border-radius:var(--panel-radius);padding:12px;border:1px solid var(--glass-2);box-shadow:0 10px 30px rgba(3,7,18,0.5);min-width:0}

/* sidebar */
.sidebar{display:flex;flex-direction:column;gap:8px;padding:8px;min-height:320px;min-width:0;position:sticky;top:calc(var(--nav-height) + 12px)}
.sidebar-top{display:flex;align-items:center;justify-content:space-between;padding:4px 6px}
.sidebar-title{font-weight:700;font-size:11px;letter-spacing:1px;color:var(--muted)}
.sidebar-actions .btn.tiny{padding:6px 8px;font-size:13px}

/* channel list */
.channel-nav-wrap{display:flex;flex-direction:column;gap:6px;overflow:auto;max-height:calc(100vh - 240px);padding-right:6px}
.cat-title{font-size:11px;color:var(--muted);padding:6px 4px;margin-top:6px}
.channel-nav{list-style:none;padding:6px 4px;margin:0;display:flex;flex-direction:column;gap:6px}
.channel-nav.horizontal{flex-direction:row;align-items:center;overflow:auto}
.channel-nav li{margin:0;padding:0}
.channel-btn{display:flex;align-items:center;gap:8px;padding:8px;border-radius:10px;cursor:pointer;background:transparent;color:var(--muted);border:1px solid transparent;transition:background .12s ease,transform .08s ease,color .12s;width:100%;text-align:left;min-width:0}
.channel-btn:hover{background:rgba(255,255,255,0.008);color:var(--text);transform:translateY(-2px)}
.channel-btn:focus{outline:3px solid rgba(79,70,229,0.12);outline-offset:3px}
.channel-btn.active{background:linear-gradient(90deg,rgba(79,70,229,0.10),rgba(6,182,212,0.03));color:#fff;border-color:rgba(79,70,229,0.10)}
.ch-icon{width:28px;height:28px;display:inline-flex;align-items:center;justify-content:center;border-radius:8px;font-size:14px;flex:0 0 auto}
.ch-label{font-weight:600;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

/* messages */
.messages-panel{display:flex;flex-direction:column;gap:8px;min-width:0}
.messages-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.messages-header-actions{display:flex;align-items:center;gap:12px}
.channel-header{margin:0;font-size:16px}
.voice-controls{display:flex;gap:8px;align-items:center}
.messages{min-height:420px;max-height:calc(100vh - 480px);overflow:auto;padding:18px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.003),rgba(255,255,255,0.001));border:1px solid rgba(255,255,255,0.02);scroll-behavior:smooth;display:flex;flex-direction:column;gap:8px;}

/* msg bubble */
.msg{margin-bottom:12px;max-width:78%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.008);border:1px solid rgba(255,255,255,0.01);word-break:break-word}
.msg.me{margin-left:auto;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;border:none;box-shadow:0 8px 22px rgba(79,70,229,0.12)}
.msg .who{font-weight:700;margin-bottom:6px;font-size:13px;display:flex;align-items:center;gap:8px}
.msg .text{white-space:pre-wrap;line-height:1.4;font-size:14px}
.msg .time{font-size:11px;color:var(--muted);margin-left:8px;font-weight:600;opacity:0.9}

/* send form */
.send-form{display:flex;gap:10px;align-items:end;margin-top:12px;min-height:54px}
.send-form .text-input{flex:1;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:var(--glass);resize:vertical;min-height:44px;max-height:160px;overflow:auto;font-family:var(--font-stack);color:var(--text)}
.send-form textarea.text-input{width:100%;height:auto;line-height:1.4}
.btn.primary{padding:10px 12px;border-radius:8px}

/* right */
.members{list-style:none;padding:0;margin:6px 0 0 0}
.members li{padding:8px 10px;border-radius:8px;margin-bottom:6px;background:rgba(255,255,255,0.006);font-size:13px;display:flex;align-items:center;justify-content:space-between}

/* overlay */
.members-overlay{position:fixed;right:20px;top:84px;width:320px;max-height:70vh;display:none;flex-direction:column;background:linear-gradient(180deg,#071025,#041019);border-radius:12px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 20px 50px rgba(2,6,23,0.75);z-index:120;overflow:auto}
.members-overlay[aria-hidden="false"]{display:flex}
.overlay-header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid rgba(255,255,255,0.02)}
.overlay-body{padding:12px;display:flex;flex-direction:column;gap:8px}
.members-list{list-style:none;padding:0;margin:0;max-height:40vh;overflow:auto}
.member-item{padding:6px 8px;border-radius:8px;margin-bottom:6px;background:rgba(255,255,255,0.004);display:flex;justify-content:space-between}

/* toast */
.wc-toast{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:92px;
  z-index:999;
  min-width:220px;
  max-width:80%;
  background:var(--toast-bg);
  color:#fff;
  padding:10px 14px;
  border-radius:10px;
  box-shadow:0 8px 30px rgba(0,0,0,0.6);
  display:none;
  align-items:center;
  justify-content:center;
  font-size:14px;
}

/* helper */
.muted{color:var(--muted)} .small{font-size:12px}

/* responsive */
@media (max-width:1000px){
  .chat-container{grid-template-columns:1fr;gap:10px}
  .sidebar{flex-direction:row;height:auto;gap:8px;align-items:center;padding:8px;overflow:auto;position:relative;top:0}
  .channel-nav{flex-direction:row;gap:6px}
  .members-overlay{right:8px;left:8px;bottom:92px;top:auto;width:auto;max-width:none}
}

/* focus */
.channel-btn:focus,.round-btn:focus,.btn:focus,input:focus,textarea:focus{outline:3px solid rgba(79,70,229,0.12);outline-offset:3px}

/* scrollbar tweak */
.messages::-webkit-scrollbar, .channel-nav-wrap::-webkit-scrollbar { height:8px; width:8px }
.messages::-webkit-scrollbar-thumb, .channel-nav-wrap::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.04); border-radius:8px }

===== ./generate_south_america.js =====

// generate_south_america.js
// Usage:
//   node generate_south_america.js            -> crée fichiers si absents (ne pas écraser)
//   node generate_south_america.js --force    -> écrase les fichiers existants
//
// Place ce fichier à la racine du projet (~/WorldConflict) et exécute-le avec node.

const fs = require('fs');
const path = require('path');

const FORCE = process.argv.includes('--force');

function slugify(name) {
  return name
    .normalize('NFD').replace(/[\u0300-\u036f]/g, '') // enlever accents
    .toLowerCase()
    .replace(/['’"]/g, '') // virer apostrophes/marques
    .replace(/[^a-z0-9\s-]/g, '') // garder alnum espace -
    .trim()
    .replace(/\s+/g, '-');
}

// Liste complète Amérique du Sud
// id = identifiant court (3 lettres ou custom), name = nom affiché
const SOUTH_AMERICA = [
  { id: 'arg', name: 'Argentina' },
  { id: 'bol', name: 'Bolivia' },
  { id: 'bra', name: 'Brazil' },
  { id: 'chl', name: 'Chile' },
  { id: 'col', name: 'Colombia' },
  { id: 'ecu', name: 'Ecuador' },
  { id: 'guy', name: 'Guyana' },
  { id: 'pry', name: 'Paraguay' },
  { id: 'per', name: 'Peru' },
  { id: 'sur', name: 'Suriname' },
  { id: 'ury', name: 'Uruguay' },
  { id: 'ven', name: 'Venezuela' }
];

const outDir = path.join(process.cwd(), 'map', 'world', 'south_america');
if (!fs.existsSync(outDir)) fs.mkdirSync(outDir, { recursive: true });

const today = new Date().toISOString().slice(0, 10); // YYYY-MM-DD

let created = 0, skipped = 0, overwritten = 0;

SOUTH_AMERICA.forEach(c => {
  const slug = slugify(c.name);
  const fileName = `${slug}.json`;
  const filePath = path.join(outDir, fileName);

  const payload = {
    id: (c.id || slug).toLowerCase(),
    name: c.name,
    continent: 'south_america',
    metadata: {
      created_at: today,
      updated_at: null
    },
    government: {
      leader: null,
      ministers: [],
      system: null
    },
    population: {
      value: 0,
      growth_rate: 0
    },
    economy: {
      gdp: 0,
      resources: {}
    },
    military: {
      active: 0,
      reserve: 0,
      equipment: {}
    },
    geography: {
      area_km2: 0,
      major_cities: [],
      climate_zones: [],
      borders: []
    },
    status: {
      occupied: false,
      contested: false
    }
  };

  if (fs.existsSync(filePath)) {
    if (FORCE) {
      fs.writeFileSync(filePath, JSON.stringify(payload, null, 2), 'utf8');
      overwritten++;
      console.log(`overwritten: ${fileName}`);
    } else {
      skipped++;
      console.log(`skipped: ${fileName} (exists)`);
    }
  } else {
    fs.writeFileSync(filePath, JSON.stringify(payload, null, 2), 'utf8');
    created++;
    console.log(`created: ${fileName}`);
  }
});

console.log('\nSummary:');
console.log(`  created: ${created}`);
console.log(`  overwritten: ${overwritten}`);
console.log(`  skipped: ${skipped}`);
console.log(`Files generated in: ${outDir}`);

===== ./chat.js =====

// chat.js — version améliorée (auto-resize textarea, toasts, ARIA fixes)

(() => {
  // DOM
  const channelSearch = document.getElementById('channelSearch');
  const channelNavText = document.getElementById('channelNavText');
  const channelNavVoice = document.getElementById('channelNavVoice');
  const createChannelBtn = document.getElementById('createChannelBtn');

  const currentChannelName = document.getElementById('currentChannelName');
  const currentChannelInfo = document.getElementById('currentChannelInfo');
  const messagesEl = document.getElementById('messages');
  const sendForm = document.getElementById('sendForm');
  const msgInput = document.getElementById('msgInput');
  const membersList = document.getElementById('membersList');
  const rightInfo = document.getElementById('rightInfo');

  const membersBtn = document.getElementById('membersBtn');
  const membersOverlay = document.getElementById('membersOverlay');
  const overlayActive = document.getElementById('overlayActive');
  const overlayInactive = document.getElementById('overlayInactive');
  const closeMembers = document.getElementById('closeMembers');
  const voiceControlsEl = document.getElementById('voiceControls');

  const navChat = document.getElementById('navChat');
  const navDashboard = document.getElementById('navDashboard');
  const navNotifs = document.getElementById('navNotifs');
  const navProfile = document.getElementById('navProfile');
  const leaveChannelBtn = document.getElementById('leaveChannelBtn');

  const toastEl = document.getElementById('wcToast');

  // state
  const LS_PREFIX = 'wc_chat_final_v2_';
  let channels = [];
  let current = null;
  let session = null;

  const DEFAULT_CHANNELS = [
    { id: 'global', name: '# global', type: 'text', topic: 'Salon global' },
    { id: 'general', name: '# général', type: 'text', topic: 'Discussions générales' },
    { id: 'diplomatie', name: '# diplomatie', type: 'text', topic: 'Affaires étrangères' },
    { id: 'vc-lobby', name: 'Lobby vocal', type: 'voice', topic: 'Canal vocal' },
    { id: 'vc-ops', name: 'Opérations (vocal)', type: 'voice', topic: 'Vocal — Opérations' }
  ];

  // storage helpers
  const lsKey = k => LS_PREFIX + k;
  function loadChannels() {
    try {
      const raw = localStorage.getItem(lsKey('channels'));
      channels = raw ? JSON.parse(raw) : DEFAULT_CHANNELS.slice();
      if (!Array.isArray(channels)) channels = DEFAULT_CHANNELS.slice();
    } catch {
      channels = DEFAULT_CHANNELS.slice();
    }
  }
  function saveChannels() { localStorage.setItem(lsKey('channels'), JSON.stringify(channels)); }

  function loadMessages(chId) {
    try {
      const raw = localStorage.getItem(lsKey('messages_' + chId));
      return raw ? JSON.parse(raw) : [];
    } catch { return []; }
  }
  function saveMessages(chId, msgs) { localStorage.setItem(lsKey('messages_' + chId), JSON.stringify(msgs)); }
  function addMessage(chId, msg) {
    const msgs = loadMessages(chId);
    msgs.push(msg);
    saveMessages(chId, msgs);
  }

  // voice simulation keys
  function voiceKey(chId) { return lsKey('voice_' + chId); }
  function muteKey(chId) { return lsKey('mute_' + chId); }
  function isVoiceConnected(chId) { return !!localStorage.getItem(voiceKey(chId)); }
  function setVoiceConnected(chId, val) {
    if (val) localStorage.setItem(voiceKey(chId), JSON.stringify({ ts: Date.now() }));
    else localStorage.removeItem(voiceKey(chId));
  }
  function isMuted(chId) { try { const v = JSON.parse(localStorage.getItem(muteKey(chId))); return !!v?.muted; } catch { return false; } }
  function setMuted(chId, muted) { localStorage.setItem(muteKey(chId), JSON.stringify({ muted: !!muted })); }

  // session fetch
  async function fetchSession() {
    try {
      if (window.WC && typeof WC.apiFetch === 'function') {
        const r = await WC.apiFetch('/api/session', { method: 'GET' });
        if (r && r.ok && r.data) return r.data;
      }
      const r2 = await fetch('/api/session', { credentials: 'same-origin' });
      return await r2.json();
    } catch (e) {
      console.error('session fetch failed', e);
      return null;
    }
  }

  // toast (replacement for alert)
  let toastTimer = null;
  function showToast(text, duration = 2800) {
    if (!toastEl) { console.log('[toast]', text); return; }
    toastEl.textContent = text;
    toastEl.style.display = 'flex';
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => {
      toastEl.style.display = 'none';
    }, duration);
  }

  // render sidebar
  function renderSidebar(filter = '') {
    channelNavText.innerHTML = '';
    channelNavVoice.innerHTML = '';
    const q = (filter || '').toLowerCase().trim();

    const textNodes = channels.filter(c => c.type === 'text' && (!q || searchable(c).includes(q))).map(makeChannelListItem);
    const voiceNodes = channels.filter(c => c.type === 'voice' && (!q || searchable(c).includes(q))).map(makeChannelListItem);

    if (textNodes.length) textNodes.forEach(n => channelNavText.appendChild(n));
    else channelNavText.innerHTML = '<li class="muted small">Aucun salon textuel</li>';

    if (voiceNodes.length) voiceNodes.forEach(n => channelNavVoice.appendChild(n));
    else channelNavVoice.innerHTML = '<li class="muted small">Aucun salon vocal</li>';
  }

  function searchable(c) { return (c.name + ' ' + (c.topic || '') + ' ' + (c.id || '')).toLowerCase(); }

  function makeChannelListItem(c) {
    const li = document.createElement('li');
    const btn = document.createElement('button');
    btn.className = 'channel-btn' + (current === c.id ? ' active' : '');
    btn.type = 'button';
    btn.dataset.id = c.id;
    btn.setAttribute('aria-label', `${c.name} — ${c.topic || ''}`);
    btn.setAttribute('role', 'button');

    const iconSVG = c.type === 'voice'
      ? '<span class="ch-icon" aria-hidden="true"><svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3v10a3 3 0 0 0 6 0V3h-6zM3 9v2a7 7 0 0 0 7 7h0a7 7 0 0 0 7-7V9" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg></span>'
      : '<span class="ch-icon" aria-hidden="true"><svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true"><path d="M4 6h16M4 12h10M4 18h16" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></span>';

    const connectedDot = (c.type === 'voice' && isVoiceConnected(c.id)) ? '<span class="voice-dot" aria-hidden="true"></span>' : '';
    btn.innerHTML = `${iconSVG}<span class="ch-label">${escapeHtml(c.name)}</span>${connectedDot}`;
    btn.addEventListener('click', () => openChannel(c.id));
    li.appendChild(btn);
    return li;
  }

  // render messages
  function renderMessages(autoScroll = true) {
    messagesEl.innerHTML = '';
    if (!current) return;
    const msgs = loadMessages(current);
    if (!msgs.length) {
      const info = document.createElement('div'); info.className = 'muted'; info.textContent = 'Aucun message — commence la discussion.'; messagesEl.appendChild(info); return;
    }
    for (const m of msgs) {
      const el = document.createElement('article');
      const me = session && (m.user === session.username);
      el.className = 'msg' + (me ? ' me' : '');
      const d = safeDate(m.ts);
      const ts = d ? d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '';
      el.innerHTML = `<div class="who">${escapeHtml(m.userDisplay || m.user)} <span class="time">${ts}</span></div><div class="text">${escapeHtml(m.text)}</div>`;
      messagesEl.appendChild(el);
    }
    if (autoScroll) messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  // open channel
  function openChannel(id) {
    current = id;
    const ch = channels.find(c => c.id === id) || { name: id, type: 'text', topic: '' };
    currentChannelName.textContent = ch.name || id;
    currentChannelInfo.textContent = ch.topic || '—';
    localStorage.setItem(lsKey('last_channel'), current);
    renderSidebar(channelSearch.value || '');
    renderMessages();
    renderMembersList();
    updateVoiceControls(ch);
    // restore focus to message input
    setTimeout(() => msgInput?.focus(), 120);
    // update active class more robustly
    document.querySelectorAll('.channel-btn').forEach(b => {
      if (b.dataset.id === id) b.classList.add('active'); else b.classList.remove('active');
    });
  }

  // members list
  function renderMembersList() {
    membersList.innerHTML = '';
    if (!current) return;
    const msgs = loadMessages(current);
    const lastTs = {};
    const s = new Set();
    msgs.forEach(m => { s.add(m.user); lastTs[m.user] = Math.max(lastTs[m.user] || 0, new Date(m.ts).getTime()); });
    if (session && session.username) { s.add(session.username); lastTs[session.username] = Math.max(lastTs[session.username] || 0, Date.now()); }
    if (!s.size) { membersList.innerHTML = '<li class="muted">—</li>'; return; }
    const arr = Array.from(s);
    arr.forEach(u => {
      const last = lastTs[u] || 0;
      const active = (Date.now() - last) < (1000 * 60 * 60);
      const li = document.createElement('li');
      li.innerHTML = `<span>${escapeHtml(u)}</span><span class="small">${active ? 'actif' : 'inactif'}</span>`;
      membersList.appendChild(li);
    });
  }

  // members overlay
  function populateMembersOverlay() {
    overlayActive.innerHTML = '';
    overlayInactive.innerHTML = '';
    const users = {};
    channels.forEach(ch => {
      const msgs = loadMessages(ch.id);
      msgs.forEach(m => { const t = new Date(m.ts).getTime(); users[m.user] = Math.max(users[m.user] || 0, t); });
    });
    if (session && session.username) users[session.username] = Math.max(users[session.username] || 0, Date.now());
    const now = Date.now();
    const active = [], inactive = [];
    Object.keys(users).forEach(u => ((now - users[u]) < (1000 * 60 * 60) ? active.push({u,t:users[u]}) : inactive.push({u,t:users[u]})));
    active.sort((a,b) => b.t - a.t); inactive.sort((a,b) => b.t - a.t);
    if (!active.length) overlayActive.innerHTML = '<li class="muted">Aucun membre actif</li>';
    else active.forEach(x => overlayActive.appendChild(memberLi(x.u)));
    if (!inactive.length) overlayInactive.innerHTML = '<li class="muted">Aucun membre inactif</li>';
    else inactive.forEach(x => overlayInactive.appendChild(memberLi(x.u)));
  }
  function memberLi(u) { const li = document.createElement('li'); li.className = 'member-item'; li.textContent = u; return li; }

  // voice controls
  function updateVoiceControls(ch) {
    voiceControlsEl.innerHTML = '';
    if (!ch || ch.type !== 'voice') {
      voiceControlsEl.setAttribute('aria-hidden', 'true'); return;
    }
    voiceControlsEl.setAttribute('aria-hidden', 'false');
    const joined = isVoiceConnected(ch.id);
    const muted = isMuted(ch.id);

    const joinBtn = document.createElement('button');
    joinBtn.className = 'btn ghost small';
    joinBtn.textContent = joined ? 'Quitter vocal' : 'Rejoindre vocal';
    joinBtn.setAttribute('aria-pressed', String(joined));
    joinBtn.addEventListener('click', () => {
      setVoiceConnected(ch.id, !joined);
      const sysText = !joined ? `${session.username} a rejoint le canal vocal.` : `${session.username} a quitté le canal vocal.`;
      addMessage(ch.id, { id: 'sys-' + Date.now(), user: 'system', userDisplay: 'System', text: sysText, ts: new Date().toISOString() });
      renderSidebar(channelSearch.value || '');
      updateVoiceControls(ch);
      renderMessages();
      renderMembersList();
      showToast(!joined ? 'Connecté au vocal' : 'Déconnecté du vocal');
    });

    const muteBtn = document.createElement('button');
    muteBtn.className = 'btn ghost small';
    muteBtn.textContent = muted ? 'Muet' : 'Activer muet';
    muteBtn.setAttribute('aria-pressed', String(muted));
    muteBtn.addEventListener('click', () => {
      setMuted(ch.id, !muted);
      updateVoiceControls(ch);
      showToast(!muted ? 'Micro mis en sourdine' : 'Micro réactivé');
    });

    voiceControlsEl.appendChild(joinBtn);
    voiceControlsEl.appendChild(muteBtn);
  }

  // send message handlers
  sendForm?.addEventListener('submit', (e) => { e.preventDefault(); sendMessage(); });
  msgInput?.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
  });

  function sendMessage() {
    const txt = (msgInput.value || '').trim();
    if (!txt || !current) return showToast('Message vide ou salon non sélectionné', 1800);
    const user = session?.username || 'anonyme';
    const display = session?.rp?.displayName || session?.username || user;
    const msg = { id: Date.now() + '-' + Math.random().toString(36).slice(2,8), user, userDisplay: display, text: txt, ts: new Date().toISOString() };
    addMessage(current, msg);
    msgInput.value = '';
    autoResizeTextarea();
    renderMessages();
    renderSidebar(channelSearch.value || '');
    renderMembersList();
    showToast('Message envoyé', 900);
  }

  // create channel flow (no alerts)
  createChannelBtn?.addEventListener('click', () => {
    const name = prompt('Nom du salon (ex: diplomatie) — sans # :');
    if (!name) { showToast('Création annulée', 900); return; }
    const id = slugify(name);
    if (!id) return showToast('Nom invalide', 1400);
    if (channels.find(c => c.id === id)) return showToast('Ce salon existe déjà', 1400);
    const voice = confirm('Créer un canal vocal ? OK = vocal, Annuler = textuel.');
    const ch = { id, name: voice ? name.trim() : ('# ' + name.trim()), type: voice ? 'voice' : 'text', topic: voice ? 'Canal vocal' : 'Nouveau salon' };
    channels.push(ch); saveChannels();
    renderSidebar(channelSearch.value || '');
    openChannel(id);
    showToast(`Salon créé : ${ch.name}`, 1600);
  });

  // search debounce
  function debounce(fn, wait = 200) { let t = null; return (...args) => { clearTimeout(t); t = setTimeout(() => fn.apply(this, args), wait); }; }
  channelSearch?.addEventListener('input', debounce(e => renderSidebar(e.target.value || ''), 150));

  // leave channel
  leaveChannelBtn?.addEventListener('click', () => {
    if (!current) return;
    if (current === 'global') return showToast('Impossible de quitter le salon global', 1200);
    openChannel('global');
    showToast('Tu as quitté le salon', 1000);
  });

  // nav
  navChat?.addEventListener('click', () => setNavActive('chat'));
  navDashboard?.addEventListener('click', () => { setNavActive('dashboard'); window.location.href = 'dashboard.html'; });
  navNotifs?.addEventListener('click', () => setNavActive('notifs'));
  navProfile?.addEventListener('click', () => { setNavActive('profile'); window.location.href = 'profile.html'; });
  function setNavActive(k) {
    [navChat, navDashboard, navNotifs, navProfile].forEach(n => n?.classList?.remove('active'));
    if (k === 'chat') navChat?.classList?.add('active');
    if (k === 'dashboard') navDashboard?.classList?.add('active');
    if (k === 'notifs') navNotifs?.classList?.add('active');
    if (k === 'profile') navProfile?.classList?.add('active');
  }

  // members overlay toggle
  membersBtn?.addEventListener('click', () => {
    const opened = membersOverlay.getAttribute('aria-hidden') === 'false';
    if (opened) closeMembersOverlay(); else openMembersOverlay();
  });
  closeMembers?.addEventListener('click', closeMembersOverlay);
  function openMembersOverlay() {
    membersOverlay.setAttribute('aria-hidden', 'false');
    membersBtn.setAttribute('aria-expanded', 'true');
    membersBtn.setAttribute('aria-pressed', 'true');
    populateMembersOverlay();
    // put focus on close for keyboard users
    setTimeout(() => closeMembers?.focus(), 60);
  }
  function closeMembersOverlay() {
    membersOverlay.setAttribute('aria-hidden', 'true');
    membersBtn.setAttribute('aria-expanded', 'false');
    membersBtn.setAttribute('aria-pressed', 'false');
    membersBtn?.focus();
  }

  // utilities
  function escapeHtml(s) { return String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
  function safeDate(iso) { try { return iso ? new Date(iso) : null; } catch { return null; } }
  function slugify(s) { if (!s) return ''; return s.toString().toLowerCase().trim().replace(/\s+/g,'-').replace(/[^a-z0-9\-]/g,'').replace(/\-+/g,'-'); }

  // auto-resize textarea
  function autoResizeTextarea() {
    if (!msgInput) return;
    msgInput.style.height = 'auto';
    const sh = Math.min(msgInput.scrollHeight, 280);
    msgInput.style.height = (sh) + 'px';
  }
  msgInput?.addEventListener('input', autoResizeTextarea);

  // init
  (async () => {
    loadChannels();
    session = await fetchSession();
    if (!session || !session.ok) {
      showToast('Tu dois être connecté pour accéder au chat.', 2000);
      setTimeout(() => window.location.href = 'index.html', 800);
      return;
    }
    document.getElementById('headerSub').textContent = `${session.username} — connecté`;

    const last = localStorage.getItem(lsKey('last_channel'));
    const initial = last && channels.find(c => c.id === last) ? last : (channels[0] && channels[0].id) || 'global';

    // ensure welcome system message
    if (!loadMessages('global')?.length) {
      addMessage('global', { id: 'sys-1', user: 'system', userDisplay: 'WorldConflict', text: 'Bienvenue sur WorldConflict — respecte les règles.', ts: new Date().toISOString() });
    }

    renderSidebar();
    openChannel(initial);
    setNavActive('chat');

    // escape to close overlay
    window.addEventListener('keydown', e => { if (e.key === 'Escape') closeMembersOverlay(); });
    // persist last channel
    window.addEventListener('beforeunload', () => { if (current) localStorage.setItem(lsKey('last_channel'), current); });
  })();

})();

===== ./notifications.css =====

/* notifications.css — professional notifications page (matches variables.css) */

.container { max-width:980px; margin:18px auto; padding:0 16px; }

.notif-header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
.notif-header h1 { margin:0; font-size:20px; font-weight:800; }
.notif-header .muted { color:var(--muted); margin-top:6px; font-size:13px; }

.notif-actions { display:flex; gap:8px; align-items:center; }
.btn { padding:8px 12px; border-radius:10px; font-weight:700; cursor:pointer; border:0; }
.btn-ghost { background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--text); }
.small { padding:6px 8px; font-size:13px; }

.notif-main { background: linear-gradient(180deg, rgba(255,255,255,0.006), rgba(255,255,255,0.002)); border:1px solid rgba(255,255,255,0.03); border-radius:12px; padding:12px; box-shadow: var(--card-shadow); }

.notif-tabs { display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap; }
.tab { padding:8px 12px; border-radius:10px; background:transparent; border:1px solid rgba(255,255,255,0.02); color:var(--muted); cursor:pointer; font-weight:700; }
.tab.active { background: linear-gradient(90deg, var(--accent1), var(--accent2)); color:#fff; transform:translateY(-2px); box-shadow: 0 12px 26px rgba(79,70,229,0.12); }

.notif-list { display:flex; flex-direction:column; gap:8px; min-height:160px; padding:6px; max-height:60vh; overflow:auto; }

.notif-item { display:flex; gap:12px; align-items:flex-start; padding:10px; border-radius:10px; background: rgba(255,255,255,0.008); border:1px solid rgba(255,255,255,0.02); transition: background .12s, transform .08s; }
.notif-item.unread { border-left:4px solid var(--accent1); background: linear-gradient(90deg, rgba(79,70,229,0.03), rgba(6,182,212,0.01)); }
.notif-item:hover { transform: translateY(-2px); }

.notif-avatar { width:44px; height:44px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-weight:800; color:#fff; background:linear-gradient(90deg,var(--accent1),var(--accent2)); flex:0 0 44px; }
.notif-body { flex:1; min-width:0; }
.notif-title { font-weight:800; font-size:14px; margin:0 0 6px 0; }
.notif-text { margin:0; color:var(--muted); font-size:13px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.notif-meta { margin-top:6px; font-size:12px; color:var(--muted); display:flex; gap:8px; align-items:center; }

.notif-controls { display:flex; gap:8px; align-items:center; margin-left:8px; }
.icon-btn { border-radius:8px; padding:6px 8px; background:transparent; border:1px solid rgba(255,255,255,0.02); cursor:pointer; color:var(--muted); }

.load-row { margin-top:12px; display:flex; justify-content:center; }

.wc-toast { position:fixed; left:50%; transform:translateX(-50%); bottom:92px; min-width:220px; max-width:420px; padding:10px 14px; border-radius:10px; background:rgba(10,12,20,0.96); color:#fff; box-shadow:0 8px 30px rgba(2,6,23,0.6); text-align:center; z-index:200; }
.visually-hidden { display:none !important; }

@media (max-width:700px) {
  .notif-header { flex-direction:column; align-items:flex-start; gap:8px; }
  .notif-actions { width:100%; justify-content:flex-start; }
  .notif-item { flex-direction:row; }
  .notif-text { white-space:normal; }
}

===== ./notifications.html =====

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WorldConflict — Notifications</title>

  <link rel="stylesheet" href="variables.css">
  <link rel="stylesheet" href="notifications.css">
</head>
<body>
  <div class="notif-shell container">

    <header class="notif-header">
      <div>
        <h1>Notifications</h1>
        <p class="muted">Toutes tes alertes récentes — RP &amp; système.</p>
      </div>
      <div class="notif-actions">
        <button id="btnMarkAllRead" class="btn btn-ghost small">Marquer tout lu</button>
        <button id="btnClear" class="btn btn-ghost small">Tout supprimer</button>
      </div>
    </header>

    <main class="notif-main">
      <nav class="notif-tabs" role="tablist" aria-label="Filtres de notifications">
        <button role="tab" aria-selected="true" data-filter="all" class="tab active">Toutes</button>
        <button role="tab" data-filter="rp" class="tab">RP</button>
        <button role="tab" data-filter="hrp" class="tab">HRP</button>
        <button role="tab" data-filter="mentions" class="tab">Mentions</button>
        <button role="tab" data-filter="system" class="tab">Système</button>
      </nav>

      <section id="notifList" class="notif-list" aria-live="polite" aria-busy="false">
        <!-- notifications injected here -->
      </section>

      <div class="load-row">
        <button id="btnLoadMore" class="btn btn-ghost">Charger plus</button>
      </div>
    </main>

    <nav class="bottom-nav" aria-label="Navigation">
      <button id="nav-chat" class="nav-btn" title="Chat">Chat</button>
      <button id="nav-lobby" class="nav-btn" title="Lobby">Lobby</button>
      <button id="nav-notifs" class="nav-btn active" title="Notifications">Notif</button>
      <button id="nav-profile" class="nav-btn" title="Profil">Profil</button>
    </nav>

    <div id="toast" class="wc-toast visually-hidden" role="status" aria-live="polite"></div>
  </div>

  <script src="utils.js" defer></script>
  <script src="notifications.js" defer></script>
</body>
</html>

===== ./guerre.js =====

// guerre.js — front pour la page Guerres
// - utilise WC.apiFetch (utils.js) si présent
// - fallback: lecture statique /war/state.json et simulation locale pour tests
(function () {
  'use strict';

  // --- Config / state ---
  const API = {
    listWars: '/api/war/list',        // optional endpoint (server)
    declare: '/api/war/declare',      // optional endpoint (server)
    tick: '/api/war/tick',            // optional endpoint (server)
    stateJson: '/war/state.json'      // fallback static file
  };

  const qs = (s, ctx = document) => ctx.querySelector(s);
  const qsa = (s, ctx = document) => Array.from(ctx.querySelectorAll(s));

  let countries = [];       // { id, name, file, continent }
  let countryById = {};     // map id -> name
  let wars = [];            // current wars (from server or local fallback)
  let clientOnlyWars = [];  // wars created locally when API missing

  // utilities (use WC if available)
  const apiFetch = (window.WC && typeof window.WC.apiFetch === 'function') ? window.WC.apiFetch : async (u, o) => {
    try {
      const r = await fetch(u, o);
      const ct = r.headers.get && r.headers.get('content-type') || '';
      const data = (ct.includes('application/json')) ? await r.json() : await r.text();
      if (!r.ok) return { ok: false, status: r.status, data, error: data && data.error ? data.error : `HTTP ${r.status}` };
      return { ok: true, status: r.status, data };
    } catch (err) {
      return { ok: false, status: 0, error: err && err.message ? err.message : 'Network error' };
    }
  };

  const showMsg = (elOrId, text, type = 'info', timeout = 3000) => {
    if (window.WC && typeof window.WC.showMessage === 'function') {
      try { window.WC.showMessage(elOrId || 'toast', text, type, timeout); return; } catch (e) { /* fallback */ }
    }
    const t = document.getElementById('toast');
    if (t) {
      t.textContent = text;
      t.classList.remove('visually-hidden');
      setTimeout(() => { t.classList.add('visually-hidden'); t.textContent = ''; }, timeout);
      return;
    }
    console.log(`[${type}] ${text}`);
  };

  // --- DOM refs ---
  const refs = {};
  function cacheRefs() {
    refs.warList = qs('#warList');
    refs.warDetails = qs('#warDetails');
    refs.declareBtn = qs('#declareBtn');
    refs.refreshBtn = qs('#refreshBtn');
    refs.searchInput = qs('#searchInput');
    refs.toceaseBtn = qs('#toceaseBtn');
  }

  // --- Fetch data ---
  async function loadCountries() {
    // prefer /api/countries
    try {
      const r = await apiFetch('/api/countries', { method: 'GET' });
      if (r && r.ok && r.data && Array.isArray(r.data.countries || r.data)) {
        countries = r.data.countries || r.data;
      } else if (r && r.ok && Array.isArray(r.data)) {
        countries = r.data;
      } else {
        // fallback: try static index generated by server (the server exposes a route /api/countries normally)
        countries = [];
      }
    } catch (e) {
      countries = [];
    }
    // build lookup
    countryById = {};
    for (const c of countries) countryById[c.id] = c.name || c.id;
  }

  async function loadWars() {
    // try API endpoint first
    try {
      const r = await apiFetch(API.listWars, { method: 'GET' });
      if (r && r.ok && r.data && Array.isArray(r.data.wars)) {
        wars = r.data.wars;
        mergeClientWars();
        renderWars();
        return;
      }
    } catch (e) { /* ignore and fallback */ }

    // fallback: try static /war/state.json (served as static asset by your server)
    try {
      const r2 = await fetch(API.stateJson, { cache: 'no-store' });
      if (r2.ok) {
        const payload = await r2.json();
        wars = Array.isArray(payload.wars) ? payload.wars : (payload && payload.wars) || [];
        mergeClientWars();
        renderWars();
        return;
      }
    } catch (e) {
      // final fallback: use clientOnlyWars (empty initially)
      wars = [];
      mergeClientWars();
      renderWars();
    }
  }

  function mergeClientWars() {
    // if the server does not persist client-only wars, keep those visible
    if (clientOnlyWars.length) {
      // avoid duplicating by id
      const existingIds = new Set((wars || []).map(w => w.id));
      for (const cw of clientOnlyWars) {
        if (!existingIds.has(cw.id)) wars.push(cw);
      }
    }
  }

  // --- Render ---
  function renderWars(filter = '') {
    if (!refs.warList) return;
    refs.warList.innerHTML = '';
    const list = (wars || []).filter(w => {
      if (!filter) return true;
      const q = filter.trim().toLowerCase();
      if (w.id && w.id.toLowerCase().includes(q)) return true;
      const names = [...(w.attackers || []), ...(w.defenders || [])].map(id => (countryById[id] || id).toLowerCase());
      return names.some(n => n.includes(q));
    });

    if (!list.length) {
      const el = document.createElement('div');
      el.className = 'empty';
      el.textContent = 'Aucun conflit actif pour l\'instant.';
      refs.warList.appendChild(el);
      return;
    }

    for (const war of list) {
      const item = document.createElement('div');
      item.className = 'war-item';
      item.dataset.warId = war.id;

      const left = document.createElement('div');
      left.className = 'war-meta';

      const attackers = document.createElement('div');
      for (const a of war.attackers || []) {
        const p = document.createElement('div');
        p.className = 'country-pill';
        p.textContent = countryById[a] || a;
        attackers.appendChild(p);
      }

      const vs = document.createElement('div');
      vs.style.fontWeight = 700;
      vs.style.margin = '0 8px';
      vs.textContent = 'VS';

      const defenders = document.createElement('div');
      for (const d of war.defenders || []) {
        const p = document.createElement('div');
        p.className = 'country-pill';
        p.textContent = countryById[d] || d;
        defenders.appendChild(p);
      }

      left.appendChild(attackers);
      left.appendChild(vs);
      left.appendChild(defenders);

      const right = document.createElement('div');
      right.style.display = 'flex';
      right.style.flexDirection = 'column';
      right.style.alignItems = 'flex-end';

      const status = document.createElement('div');
      status.className = `status-badge ${war.status === 'active' ? 'status-active' : 'status-ended'}`;
      status.textContent = war.status === 'active' ? 'Actif' : 'Terminé';

      const meta = document.createElement('div');
      meta.className = 'war-details';
      meta.textContent = `Intensité: ${formatPct(war.intensity || 0)} • Déclaré: ${niceDate(war.startedAt)}`;

      right.appendChild(status);
      right.appendChild(meta);

      item.appendChild(left);
      item.appendChild(right);

      item.addEventListener('click', () => selectWar(war.id));

      refs.warList.appendChild(item);
    }
  }

  function selectWar(warId) {
    const war = (wars || []).find(w => w.id === warId);
    if (!war) return;
    renderWarDetails(war);
    // mark selected in list
    qsa('.war-item').forEach(el => el.classList.toggle('selected', el.dataset.warId === warId));
  }

  function renderWarDetails(war) {
    if (!refs.warDetails) return;
    refs.warDetails.innerHTML = '';

    const title = document.createElement('div');
    title.style.fontWeight = 700;
    title.style.marginBottom = '8px';
    title.textContent = `Conflit — ${war.id}`;

    const sides = document.createElement('div');
    sides.style.display = 'flex';
    sides.style.gap = '8px';
    for (const a of war.attackers || []) {
      const p = document.createElement('div');
      p.className = 'country-pill';
      p.textContent = countryById[a] || a;
      sides.appendChild(p);
    }
    const vs = document.createElement('div'); vs.textContent = 'VS'; vs.style.alignSelf = 'center'; vs.style.fontWeight = 700; sides.appendChild(vs);
    for (const d of war.defenders || []) {
      const p = document.createElement('div');
      p.className = 'country-pill';
      p.textContent = countryById[d] || d;
      sides.appendChild(p);
    }

    const body = document.createElement('div');
    body.className = 'war-details';
    const casualties = JSON.stringify(war.casualties || {});
    body.innerHTML = `
      <div>Statut: <strong>${war.status}</strong></div>
      <div>Intensité: <strong>${formatPct(war.intensity || 0)}</strong></div>
      <div>Pertes: <pre style="display:inline;background:transparent;border:none;padding:0;margin:0">${casualties}</pre></div>
      <div>Début: ${niceDate(war.startedAt)}</div>
      ${war.endedAt ? `<div>Fin: ${niceDate(war.endedAt)}</div>` : ''}
    `;

    refs.warDetails.appendChild(title);
    refs.warDetails.appendChild(sides);
    refs.warDetails.appendChild(body);

    // enable ceasefire button
    if (refs.toceaseBtn) {
      refs.toceaseBtn.disabled = war.status !== 'active';
      refs.toceaseBtn.onclick = () => proposeCeasefire(war.id);
    }
  }

  // --- Declare modal & flow ---
  function openDeclareModal() {
    // modal container
    const overlay = document.createElement('div');
    overlay.className = 'modal-overlay';
    const panel = document.createElement('div');
    panel.className = 'panel';
    panel.style.maxWidth = '520px';
    panel.style.margin = '40px auto';
    panel.innerHTML = `
      <h3>Déclarer une guerre</h3>
      <div style="display:flex;gap:8px;margin-top:8px;">
        <label style="flex:1">
          <div class="mini">Attaquant</div>
          <select id="declAtt" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ef"></select>
        </label>
        <label style="flex:1">
          <div class="mini">Défenseur</div>
          <select id="declDef" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ef"></select>
        </label>
      </div>
      <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end;">
        <button id="declCancel" class="btn">Annuler</button>
        <button id="declConfirm" class="btn btn-primary">Confirmer</button>
      </div>
    `;

    overlay.appendChild(panel);
    document.body.appendChild(overlay);

    // populate selects
    const selA = overlay.querySelector('#declAtt');
    const selD = overlay.querySelector('#declDef');

    // fallback if no countries loaded
    if (!countries.length) {
      const opt = document.createElement('option');
      opt.value = 'unknown';
      opt.textContent = '— Aucun pays disponible —';
      selA.appendChild(opt.cloneNode(true));
      selD.appendChild(opt.cloneNode(true));
    } else {
      for (const c of countries) {
        const a = document.createElement('option');
        a.value = c.id;
        a.textContent = c.name || c.id;
        selA.appendChild(a);

        const b = a.cloneNode(true);
        selD.appendChild(b);
      }
    }

    // handlers
    overlay.querySelector('#declCancel').addEventListener('click', () => { document.body.removeChild(overlay); });
    overlay.querySelector('#declConfirm').addEventListener('click', async () => {
      const attacker = selA.value;
      const defender = selD.value;
      if (!attacker || !defender || attacker === defender) {
        showMsg(null, 'Choisis deux pays différents.', 'error');
        return;
      }
      const btn = overlay.querySelector('#declConfirm');
      if (window.WC && typeof window.WC.setBtnLoading === 'function') window.WC.setBtnLoading(btn, true, 'Déclaration…');
      try {
        const r = await apiFetch(API.declare, { method: 'POST', body: { attacker, defender } });
        if (r && r.ok) {
          showMsg(null, 'Guerre déclarée (API).', 'success');
          // try to refresh from server
          await loadWars();
        } else {
          // server endpoint missing or failed -> create client-only war
          const localWar = createLocalWar(attacker, defender);
          clientOnlyWars.push(localWar);
          wars.push(localWar);
          renderWars(refs.searchInput?.value || '');
          showMsg(null, 'Guerre simulée localement (pas d’endpoint serveur).', 'info');
        }
      } catch (e) {
        const localWar = createLocalWar(attacker, defender);
        clientOnlyWars.push(localWar);
        wars.push(localWar);
        renderWars(refs.searchInput?.value || '');
        showMsg(null, 'Guerre simulée localement (erreur réseau).', 'info');
      } finally {
        if (window.WC && typeof window.WC.setBtnLoading === 'function') window.WC.setBtnLoading(btn, false);
        // close modal
        if (document.body.contains(overlay)) document.body.removeChild(overlay);
      }
    });
  }

  function createLocalWar(attacker, defender) {
    const id = `war_${attacker}_${defender}_${Date.now()}`;
    return {
      id,
      attackers: [attacker],
      defenders: [defender],
      status: 'active',
      startedAt: new Date().toISOString(),
      endedAt: null,
      intensity: 0.12,
      casualties: {},
      economyImpact: {}
    };
  }

  // propose ceasefire (client-side + try server)
  async function proposeCeasefire(warId) {
    // try server endpoint POST /api/war/end (not implemented on server yet)
    try {
      const r = await apiFetch(`/api/war/end`, { method: 'POST', body: { warId } });
      if (r && r.ok) {
        showMsg(null, 'Cessez-le-feu enregistré (API).', 'success');
        await loadWars();
        return;
      }
    } catch (e) { /* ignore */ }

    // fallback: end locally (client-only wars or merge in-memory)
    const w = wars.find(x => x.id === warId);
    if (w) {
      w.status = 'ended';
      w.endedAt = new Date().toISOString();
      renderWars(refs.searchInput?.value || '');
      renderWarDetails(w);
      showMsg(null, 'Cessez-le-feu appliqué localement.', 'info');
    } else {
      showMsg(null, 'Conflit introuvable.', 'error');
    }
  }

  // --- Tick simulation (local) ---
  // This is used when server does not provide a tick endpoint.
  function clientTickOnce() {
    for (const war of wars) {
      if (war.status !== 'active') continue;
      // simple intensity growth
      war.intensity = clampNum((war.intensity || 0) + (Math.random() * 0.04 + 0.01), 0, 1);
      // casualties per side (small)
      const sides = [...(war.attackers || []), ...(war.defenders || [])];
      for (const s of sides) {
        const prev = (war.casualties && war.casualties[s]) ? war.casualties[s] : 0;
        const add = Math.floor((Math.random() * 200) + Math.max(1, (war.intensity || 0) * 100));
        war.casualties = war.casualties || {};
        war.casualties[s] = prev + add;
      }
      // auto-end if intensity too high
      if ((war.intensity || 0) >= 0.95) {
        war.status = 'ended';
        war.endedAt = new Date().toISOString();
      }
    }
    renderWars(refs.searchInput?.value || '');
    // if a war is currently selected, update details
    const sel = qs('.war-item.selected');
    if (sel) {
      const wid = sel.dataset.warId;
      const w = wars.find(x => x.id === wid);
      if (w) renderWarDetails(w);
    }
  }

  // --- Helpers ---
  function niceDate(iso) {
    if (!iso) return '—';
    try {
      const d = new Date(iso);
      return d.toLocaleString();
    } catch (e) { return iso; }
  }
  function formatPct(v) {
    return `${Math.round((v || 0) * 100)}%`;
  }
  function clampNum(v, a, b) { return Math.max(a, Math.min(b, v)); }

  // --- Wire UI events ---
  function wire() {
    if (refs.declareBtn) refs.declareBtn.addEventListener('click', openDeclareModal);
    if (refs.refreshBtn) refs.refreshBtn.addEventListener('click', async () => {
      // try server tick first
      try {
        const r = await apiFetch(API.tick, { method: 'POST' });
        if (r && r.ok) {
          showMsg(null, 'Tick appliqué (API).', 'success');
          await loadWars();
          return;
        }
      } catch (e) { /* fall through to local tick */ }

      // fallback local tick:
      clientTickOnce();
      showMsg(null, 'Tick appliqué localement.', 'info');
    });

    if (refs.searchInput) {
      refs.searchInput.addEventListener('input', (e) => {
        renderWars(e.target.value || '');
      });
    }
  }

  // --- Init ---
  async function init() {
    cacheRefs();
    await loadCountries();
    await loadWars();
    wire();
  }

  // run
  document.addEventListener('DOMContentLoaded', init);
})();
